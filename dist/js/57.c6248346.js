"use strict";(self["webpackChunkbosfdr"]=self["webpackChunkbosfdr"]||[]).push([[57,674],{1057:function(e,t,a){a.r(t),a.d(t,{default:function(){return Se}});var n={};a.r(n);var o=a(6768),s=a(4232);const i={class:"residency-review"},r={class:"dashboard-container"},l={class:"container-fluid p-4"},c={class:"row mb-4"},d={class:"col-12"},u={class:"d-flex justify-content-between align-items-center flex-wrap"},m={class:"d-flex gap-2"},h=["disabled"],f={class:"row mb-4"},g={class:"col-xl-3 col-md-6 mb-4"},k={class:"card border-left-warning shadow h-100 py-2"},p={class:"card-body"},v={class:"row no-gutters align-items-center"},y={class:"col mr-2"},L={class:"h5 mb-0 font-weight-bold text-gray-800"},w={key:0,class:"text-center py-5"},b={key:1,class:"alert alert-danger",role:"alert"},C={key:2,class:"card shadow mb-4"},D={class:"card-body"},_={key:0,class:"text-center py-4"},R={key:1,class:"table-responsive"},E={class:"table table-bordered",width:"100%",cellspacing:"0"},A={class:"d-flex align-items-center"},j={class:"ms-3"},x={class:"fw-bold"},M={class:"text-muted small"},S={class:"text-muted small"},I={class:"small"},$={class:"badge bg-info"},T=["onClick","disabled"];function F(e,t,a,n,F,P){const U=(0,o.g2)("AdminHeader"),z=(0,o.g2)("AdminSidebar"),V=(0,o.g2)("DocumentReviewModal");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(U,{userName:e.adminData?.first_name||"Admin",showUserDropdown:e.showUserDropdown,sidebarCollapsed:e.sidebarCollapsed,activeMenu:e.activeMenu,onSidebarToggle:e.handleSidebarToggle,onUserDropdownToggle:e.handleUserDropdownToggle,onMenuAction:e.handleMenuAction,onLogout:e.handleLogout},null,8,["userName","showUserDropdown","sidebarCollapsed","activeMenu","onSidebarToggle","onUserDropdownToggle","onMenuAction","onLogout"]),(0,o.Lk)("div",{class:(0,s.C4)(["mobile-overlay",{active:!e.sidebarCollapsed&&e.isMobile}]),onClick:t[0]||(t[0]=(...t)=>e.closeMobileSidebar&&e.closeMobileSidebar(...t))},null,2),(0,o.Lk)("div",r,[(0,o.bF)(z,{collapsed:e.sidebarCollapsed,activeMenu:e.activeMenu,onMenuChange:e.handleMenuChange,onLogout:e.handleLogout,onToggleSidebar:e.handleSidebarToggle},null,8,["collapsed","activeMenu","onMenuChange","onLogout","onToggleSidebar"]),(0,o.Lk)("main",{class:(0,s.C4)(["main-content",{"sidebar-collapsed":e.sidebarCollapsed}])},[(0,o.Lk)("div",l,[(0,o.Lk)("div",c,[(0,o.Lk)("div",d,[(0,o.Lk)("div",u,[t[3]||(t[3]=(0,o.Lk)("div",null,[(0,o.Lk)("h1",{class:"h3 mb-0 text-gray-800"},"Residency Verification"),(0,o.Lk)("p",{class:"text-muted"},"Review and approve client residency documents")],-1)),(0,o.Lk)("div",m,[(0,o.Lk)("button",{class:"btn btn-outline-success btn-sm",onClick:t[1]||(t[1]=(...e)=>P.loadPendingVerifications&&P.loadPendingVerifications(...e)),disabled:F.loading},[(0,o.Lk)("i",{class:(0,s.C4)(["fas fa-sync-alt me-1",{"fa-spin":F.loading}])},null,2),t[2]||(t[2]=(0,o.eW)(" Refresh "))],8,h)])])])]),(0,o.Lk)("div",f,[(0,o.Lk)("div",g,[(0,o.Lk)("div",k,[(0,o.Lk)("div",p,[(0,o.Lk)("div",v,[(0,o.Lk)("div",y,[t[4]||(t[4]=(0,o.Lk)("div",{class:"text-xs font-weight-bold text-warning text-uppercase mb-1"}," Pending Review ",-1)),(0,o.Lk)("div",L,(0,s.v_)(F.pendingCount),1)]),t[5]||(t[5]=(0,o.Lk)("div",{class:"col-auto"},[(0,o.Lk)("i",{class:"fas fa-clock fa-2x text-gray-300"})],-1))])])])])]),F.loading?((0,o.uX)(),(0,o.CE)("div",w,t[6]||(t[6]=[(0,o.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,o.Lk)("span",{class:"sr-only"},"Loading...")],-1),(0,o.Lk)("p",{class:"mt-2 text-muted"},"Loading pending verifications...",-1)]))):F.error?((0,o.uX)(),(0,o.CE)("div",b,[t[7]||(t[7]=(0,o.Lk)("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),(0,o.eW)(" "+(0,s.v_)(F.error),1)])):((0,o.uX)(),(0,o.CE)("div",C,[t[11]||(t[11]=(0,o.Lk)("div",{class:"card-header py-3"},[(0,o.Lk)("h6",{class:"m-0 font-weight-bold text-primary"},"Pending Residency Verifications")],-1)),(0,o.Lk)("div",D,[0===F.pendingVerifications.length?((0,o.uX)(),(0,o.CE)("div",_,t[8]||(t[8]=[(0,o.Lk)("i",{class:"fas fa-check-circle fa-3x text-success mb-3"},null,-1),(0,o.Lk)("h5",{class:"text-muted"},"No Pending Verifications",-1),(0,o.Lk)("p",{class:"text-muted"},"All residency documents have been reviewed.",-1)]))):((0,o.uX)(),(0,o.CE)("div",R,[(0,o.Lk)("table",E,[t[10]||(t[10]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Client"),(0,o.Lk)("th",null,"Registration Date"),(0,o.Lk)("th",null,"Documents"),(0,o.Lk)("th",null,"Status"),(0,o.Lk)("th",null,"Actions")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(F.pendingVerifications,(e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.account_id},[(0,o.Lk)("td",null,[(0,o.Lk)("div",A,[(0,o.Lk)("div",j,[(0,o.Lk)("div",x,(0,s.v_)(P.getFullName(e)),1),(0,o.Lk)("div",M,(0,s.v_)(e.username),1),(0,o.Lk)("div",S,(0,s.v_)(e.email),1)])])]),(0,o.Lk)("td",null,[(0,o.Lk)("div",I,(0,s.v_)(P.formatDate(e.registration_date)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("span",$,(0,s.v_)(e.document_count)+" documents",1)]),(0,o.Lk)("td",null,[(0,o.Lk)("span",{class:(0,s.C4)(["badge",P.getStatusBadgeClass(e.account_status)])},(0,s.v_)(P.formatStatus(e.account_status)),3)]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"btn btn-primary btn-sm me-2",onClick:t=>P.reviewDocuments(e),disabled:F.loading},t[9]||(t[9]=[(0,o.Lk)("i",{class:"fas fa-eye me-1"},null,-1),(0,o.eW)(" Review ")]),8,T)])])))),128))])])]))])]))])],2)]),F.showReviewModal?((0,o.uX)(),(0,o.Wv)(V,{key:0,client:F.selectedClient,documents:F.clientDocuments,onClose:P.closeReviewModal,onApprove:P.handleApprove,onReject:P.handleReject},null,8,["client","documents","onClose","onApprove","onReject"])):(0,o.Q3)("",!0)])}var P=a(3237),U=a(2944),z=a(5130);const V={class:"modal-header"},O={class:"modal-body"},N={class:"client-info-card mb-4"},X={class:"row"},B={class:"col-md-6"},W={class:"info-item"},J={class:"info-item"},Q={class:"info-item"},q={class:"col-md-6"},Z={class:"info-item"},K={class:"info-item"},G={class:"info-item"},H={class:"documents-section"},Y={class:"section-title"},ee={key:0,class:"no-documents"},te={key:1,class:"documents-grid"},ae=["onClick"],ne={class:"document-header"},oe={class:"document-icon"},se={class:"document-type"},ie={class:"document-info"},re={class:"document-name"},le={class:"document-meta"},ce={class:"file-size"},de={class:"upload-date"},ue={class:"document-actions"},me=["onClick"],he={class:"modal-footer"},fe={class:"action-buttons"},ge=["disabled"],ke=["disabled"],pe={class:"modal-header"},ve={class:"modal-body"},ye={class:"form-group"},Le={key:0,class:"invalid-feedback"},we={class:"modal-footer"},be=["disabled"];function Ce(e,t,a,n,i,r){const l=(0,o.g2)("DocumentViewer");return(0,o.uX)(),(0,o.CE)("div",{class:"modal-overlay",onClick:t[11]||(t[11]=(...e)=>r.handleOverlayClick&&r.handleOverlayClick(...e))},[(0,o.Lk)("div",{class:"modal-container",onClick:t[4]||(t[4]=(0,z.D$)((()=>{}),["stop"]))},[(0,o.Lk)("div",V,[t[13]||(t[13]=(0,o.Lk)("h3",{class:"modal-title"},[(0,o.Lk)("i",{class:"fas fa-file-alt me-2"}),(0,o.eW)(" Review Residency Documents ")],-1)),(0,o.Lk)("button",{class:"btn-close",onClick:t[0]||(t[0]=t=>e.$emit("close")),"aria-label":"Close"},t[12]||(t[12]=[(0,o.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,o.Lk)("div",O,[(0,o.Lk)("div",N,[t[20]||(t[20]=(0,o.Lk)("h5",{class:"card-title"},[(0,o.Lk)("i",{class:"fas fa-user me-2"}),(0,o.eW)(" Client Information ")],-1)),(0,o.Lk)("div",X,[(0,o.Lk)("div",B,[(0,o.Lk)("div",W,[t[14]||(t[14]=(0,o.Lk)("label",null,"Full Name:",-1)),(0,o.Lk)("span",null,(0,s.v_)(r.getFullName(a.client)),1)]),(0,o.Lk)("div",J,[t[15]||(t[15]=(0,o.Lk)("label",null,"Username:",-1)),(0,o.Lk)("span",null,(0,s.v_)(a.client.username),1)]),(0,o.Lk)("div",Q,[t[16]||(t[16]=(0,o.Lk)("label",null,"Email:",-1)),(0,o.Lk)("span",null,(0,s.v_)(a.client.email||"Not provided"),1)])]),(0,o.Lk)("div",q,[(0,o.Lk)("div",Z,[t[17]||(t[17]=(0,o.Lk)("label",null,"Phone:",-1)),(0,o.Lk)("span",null,(0,s.v_)(a.client.phone_number||"Not provided"),1)]),(0,o.Lk)("div",K,[t[18]||(t[18]=(0,o.Lk)("label",null,"Address:",-1)),(0,o.Lk)("span",null,(0,s.v_)(r.getAddress(a.client)),1)]),(0,o.Lk)("div",G,[t[19]||(t[19]=(0,o.Lk)("label",null,"Registration Date:",-1)),(0,o.Lk)("span",null,(0,s.v_)(r.formatDate(a.client.registration_date)),1)])])])]),(0,o.Lk)("div",H,[(0,o.Lk)("h5",Y,[t[21]||(t[21]=(0,o.Lk)("i",{class:"fas fa-folder-open me-2"},null,-1)),(0,o.eW)(" Uploaded Documents ("+(0,s.v_)(a.documents.length)+") ",1)]),0===a.documents.length?((0,o.uX)(),(0,o.CE)("div",ee,t[22]||(t[22]=[(0,o.Lk)("i",{class:"fas fa-file-excel fa-3x text-muted mb-3"},null,-1),(0,o.Lk)("p",{class:"text-muted"},"No documents uploaded",-1)]))):((0,o.uX)(),(0,o.CE)("div",te,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.documents,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"document-card",onClick:t=>r.viewDocument(e)},[(0,o.Lk)("div",ne,[(0,o.Lk)("div",oe,[(0,o.Lk)("i",{class:(0,s.C4)(r.getDocumentIcon(e.document_type))},null,2)]),(0,o.Lk)("div",se,(0,s.v_)(r.formatDocumentType(e.document_type)),1)]),(0,o.Lk)("div",ie,[(0,o.Lk)("div",re,(0,s.v_)(e.document_name),1),(0,o.Lk)("div",le,[(0,o.Lk)("span",ce,(0,s.v_)(r.formatFileSize(e.file_size)),1),(0,o.Lk)("span",de,(0,s.v_)(r.formatDate(e.created_at)),1)])]),(0,o.Lk)("div",ue,[(0,o.Lk)("button",{class:"btn btn-sm btn-outline-primary",onClick:(0,z.D$)((t=>r.viewDocument(e)),["stop"])},t[23]||(t[23]=[(0,o.Lk)("i",{class:"fas fa-eye"},null,-1),(0,o.eW)(" View ")]),8,me)])],8,ae)))),128))]))])]),(0,o.Lk)("div",he,[(0,o.Lk)("div",fe,[(0,o.Lk)("button",{class:"btn btn-success me-2",onClick:t[1]||(t[1]=(...e)=>r.handleApprove&&r.handleApprove(...e)),disabled:0===a.documents.length},t[24]||(t[24]=[(0,o.Lk)("i",{class:"fas fa-check me-1"},null,-1),(0,o.eW)(" Approve Verification ")]),8,ge),(0,o.Lk)("button",{class:"btn btn-danger me-2",onClick:t[2]||(t[2]=e=>i.showRejectModal=!0),disabled:0===a.documents.length},t[25]||(t[25]=[(0,o.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,o.eW)(" Reject Verification ")]),8,ke),(0,o.Lk)("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=t=>e.$emit("close"))},t[26]||(t[26]=[(0,o.Lk)("i",{class:"fas fa-arrow-left me-1"},null,-1),(0,o.eW)(" Back to List ")]))])])]),i.showDocumentViewer?((0,o.uX)(),(0,o.Wv)(l,{key:0,document:i.selectedDocument,onClose:r.closeDocumentViewer},null,8,["document","onClose"])):(0,o.Q3)("",!0),i.showRejectModal?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"modal-overlay",onClick:t[10]||(t[10]=e=>i.showRejectModal=!1)},[(0,o.Lk)("div",{class:"modal-container small",onClick:t[9]||(t[9]=(0,z.D$)((()=>{}),["stop"]))},[(0,o.Lk)("div",pe,[t[28]||(t[28]=(0,o.Lk)("h4",{class:"modal-title"},"Reject Verification",-1)),(0,o.Lk)("button",{class:"btn-close",onClick:t[5]||(t[5]=e=>i.showRejectModal=!1)},t[27]||(t[27]=[(0,o.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,o.Lk)("div",ve,[(0,o.Lk)("div",ye,[t[29]||(t[29]=(0,o.Lk)("label",{for:"rejectionReason"},"Reason for Rejection:",-1)),(0,o.bo)((0,o.Lk)("textarea",{id:"rejectionReason","onUpdate:modelValue":t[6]||(t[6]=e=>i.rejectionReason=e),class:(0,s.C4)(["form-control",{"is-invalid":i.rejectionError}]),rows:"4",placeholder:"Please provide a detailed reason for rejecting this verification..."},null,2),[[z.Jo,i.rejectionReason]]),i.rejectionError?((0,o.uX)(),(0,o.CE)("div",Le,(0,s.v_)(i.rejectionError),1)):(0,o.Q3)("",!0),t[30]||(t[30]=(0,o.Lk)("small",{class:"form-text text-muted"}," Minimum 10 characters required. This will be sent to the client. ",-1))])]),(0,o.Lk)("div",we,[(0,o.Lk)("button",{class:"btn btn-danger",onClick:t[7]||(t[7]=(...e)=>r.handleReject&&r.handleReject(...e)),disabled:i.rejectionReason.length<10},t[31]||(t[31]=[(0,o.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,o.eW)(" Confirm Rejection ")]),8,be),(0,o.Lk)("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=e=>i.showRejectModal=!1)}," Cancel ")])])])):(0,o.Q3)("",!0)])}var De=a(7145),_e={name:"DocumentReviewModal",components:{DocumentViewer:De.A},props:{client:{type:Object,required:!0},documents:{type:Array,required:!0}},data(){return{showDocumentViewer:!1,selectedDocument:null,showRejectModal:!1,rejectionReason:"",rejectionError:null}},methods:{handleOverlayClick(){this.$emit("close")},getFullName(e){const t=[e.first_name,e.middle_name,e.last_name].filter(Boolean);return t.join(" ")||e.username},getAddress(e){const t=[e.barangay,e.city_municipality,e.province].filter(Boolean);return t.join(", ")||"Not provided"},formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},formatDocumentType(e){const t={utility_bill:"Utility Bill",barangay_certificate:"Barangay Certificate",valid_id:"Valid ID",lease_contract:"Lease Contract",other:"Other Document"};return t[e]||e},getDocumentIcon(e){const t={utility_bill:"fas fa-file-invoice text-warning",barangay_certificate:"fas fa-certificate text-success",valid_id:"fas fa-id-card text-info",lease_contract:"fas fa-file-contract text-primary",other:"fas fa-file text-secondary"};return t[e]||"fas fa-file text-secondary"},formatFileSize(e){if(!e)return"Unknown size";const t=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+t[a]},viewDocument(e){this.selectedDocument=e,this.showDocumentViewer=!0},closeDocumentViewer(){this.showDocumentViewer=!1,this.selectedDocument=null},handleApprove(){confirm("Are you sure you want to approve this residency verification? This will activate the client account.")&&this.$emit("approve",this.client.account_id)},handleReject(){this.rejectionError=null,this.rejectionReason.length<10?this.rejectionError="Rejection reason must be at least 10 characters long":confirm("Are you sure you want to reject this residency verification? The client will need to upload new documents.")&&(this.$emit("reject",{accountId:this.client.account_id,reason:this.rejectionReason}),this.showRejectModal=!1,this.rejectionReason="")}}},Re=a(1241);const Ee=(0,Re.A)(_e,[["render",Ce],["__scopeId","data-v-fb9ceb0e"]]);var Ae=Ee,je=(a(4114),a(2674)),xe=(P.A,U.A,{name:"ResidencyReview",components:{AdminHeader:P.A,AdminSidebar:U.A,DocumentReviewModal:Ae},mixins:[n.adminDashboard],data(){return{pendingVerifications:[],pendingCount:0,loading:!1,error:null,showReviewModal:!1,selectedClient:null,clientDocuments:[]}},async mounted(){await this.loadPendingVerifications()},methods:{async loadPendingVerifications(){this.loading=!0,this.error=null;try{const e=await this.$http.get("/api/residency/pending",{headers:{Authorization:`Bearer ${this.$store.getters.getToken}`}});e.data.success?(this.pendingVerifications=e.data.data,this.pendingCount=e.data.data.length):this.error=e.data.message||"Failed to load pending verifications"}catch(e){console.error("Error loading pending verifications:",e),this.error=e.response?.data?.message||"Failed to load pending verifications"}finally{this.loading=!1}},async reviewDocuments(e){this.loading=!0;try{const t=await this.$http.get(`/api/residency/documents/${e.account_id}`,{headers:{Authorization:`Bearer ${this.$store.getters.getToken}`}});t.data.success?(this.selectedClient=e,this.clientDocuments=t.data.data,this.showReviewModal=!0):this.error=t.data.message||"Failed to load client documents"}catch(t){console.error("Error loading client documents:",t),this.error=t.response?.data?.message||"Failed to load client documents"}finally{this.loading=!1}},closeReviewModal(){this.showReviewModal=!1,this.selectedClient=null,this.clientDocuments=[]},async handleApprove(e){try{const t=await this.$http.post("/api/residency/approve",{account_id:e},{headers:{Authorization:`Bearer ${this.$store.getters.getToken}`}});t.data.success?(this.$toast.success("Residency verification approved successfully"),this.closeReviewModal(),await this.loadPendingVerifications()):this.$toast.error(t.data.message||"Failed to approve verification")}catch(t){console.error("Error approving verification:",t),this.$toast.error(t.response?.data?.message||"Failed to approve verification")}},async handleReject(e){try{const t=await this.$http.post("/api/residency/reject",{account_id:e.accountId,rejection_reason:e.reason},{headers:{Authorization:`Bearer ${this.$store.getters.getToken}`}});t.data.success?(this.$toast.success("Residency verification rejected"),this.closeReviewModal(),await this.loadPendingVerifications()):this.$toast.error(t.data.message||"Failed to reject verification")}catch(t){console.error("Error rejecting verification:",t),this.$toast.error(t.response?.data?.message||"Failed to reject verification")}},getFullName(e){const t=[e.first_name,e.middle_name,e.last_name].filter(Boolean);return t.join(" ")||e.username},formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},formatStatus(e){const t={pending_residency_verification:"Pending Review",residency_rejected:"Rejected"};return t[e]||e},getStatusBadgeClass(e){const t={pending_residency_verification:"bg-warning",residency_rejected:"bg-danger"};return t[e]||"bg-secondary"}}});const Me=(0,Re.A)(xe,[["render",F],["__scopeId","data-v-11d34c2c"]]);var Se=Me},2674:function(e,t,a){a.r(t);a(8111),a(3579),a(4979);var n=a(4300);class o{async registerAccount(e){try{const t=await n["default"].post("/admin/auth/register-account",e);return t.data}catch(t){throw this.handleError(t)}}async completeRegistration(e,t){try{const a=await n["default"].post(`/admin/auth/complete-registration/${e}`,t);return a.data}catch(a){throw this.handleError(a)}}async verifyEmail(e,t){try{const a=await n["default"].post("/admin/auth/verify-email",{email:e,otp:t});return a.data}catch(a){throw this.handleError(a)}}async resendVerificationEmail(e){try{const t=await n["default"].post("/admin/auth/resend-verification",{email:e});return t.data}catch(t){throw this.handleError(t)}}async login(e){try{const t=await n["default"].post("/admin/auth/login",e);return t.data.success&&t.data.data.token&&(localStorage.setItem("adminToken",t.data.data.token),localStorage.setItem("adminData",JSON.stringify(t.data.data.admin))),t.data}catch(t){throw this.handleError(t)}}async getProfile(){try{const e=await n["default"].get("/admin/auth/profile");return e.data.success&&e.data.data&&localStorage.setItem("adminData",JSON.stringify(e.data.data)),e.data}catch(e){throw this.handleError(e)}}async updateProfile(e){try{const t=await n["default"].put("/admin/auth/profile",e);return t.data.success&&t.data.data&&localStorage.setItem("adminData",JSON.stringify(t.data.data)),t.data}catch(t){throw this.handleError(t)}}async changePassword(e){try{const t=await n["default"].put("/admin/auth/change-password",e);return t.data}catch(t){throw this.handleError(t)}}async sendPasswordReset(e){try{const t=await n["default"].post("/admin/auth/forgot-password",{email:e});return t.data}catch(t){throw this.handleError(t)}}async resetPassword(e,t){try{const a=await n["default"].post("/admin/auth/reset-password",{token:e,newPassword:t});return a.data}catch(a){throw this.handleError(a)}}async getDashboardStats(){try{const e=await n["default"].get("/admin/dashboard/stats");return e.data}catch(e){throw this.handleError(e)}}async getRecentActivity(e=10){try{const t=await n["default"].get(`/admin/dashboard/activity?limit=${e}`);return t.data}catch(t){throw this.handleError(t)}}async getNotifications(e=20){try{const t=await n["default"].get(`/admin/notifications?limit=${e}`);return t.data}catch(t){throw this.handleError(t)}}async markNotificationAsRead(e){try{const t=await n["default"].put(`/admin/notifications/${e}/read`);return t.data}catch(t){throw this.handleError(t)}}async markAllNotificationsAsRead(){try{const e=await n["default"].put("/admin/notifications/read-all");return e.data}catch(e){throw this.handleError(e)}}async logout(){try{await n["default"].post("/admin/auth/logout")}catch(e){console.error("Logout API error:",e)}finally{this.clearAuthData()}}clearAuthData(){localStorage.removeItem("adminToken"),localStorage.removeItem("adminData")}isLoggedIn(){const e=localStorage.getItem("adminToken");return!!e}isAuthenticated(){const e=localStorage.getItem("adminToken"),t=this.getAdminData();if(!e||!t)return!1;try{const t=e.split(".");if(3!==t.length)return!1;const a=JSON.parse(atob(t[1])),n=Math.floor(Date.now()/1e3);return a.exp&&a.exp<n?(this.clearAuthData(),!1):"admin"===a.type||(this.clearAuthData(),!1)}catch(a){return console.error("Token validation error:",a),this.clearAuthData(),!1}}hasRole(e){const t=this.getAdminData();return!(!t||!this.isAuthenticated())&&("admin"===t.role||t.role===e)}hasAnyRole(e){return Array.isArray(e)?e.some((e=>this.hasRole(e))):this.hasRole(e)}getAdminData(){const e=localStorage.getItem("adminData");return e?JSON.parse(e):null}getToken(){return localStorage.getItem("adminToken")}async sendOTP(e,t="registration",a=""){try{const o=await n["default"].post("/otp/send",{email:e,purpose:t,firstName:a});return o.data}catch(o){throw this.handleError(o)}}async verifyOTP(e,t,a="registration"){try{const o=await n["default"].post("/otp/verify",{email:e,otp:t,purpose:a});return o.data}catch(o){throw this.handleError(o)}}async resendOTP(e,t="registration",a=""){try{const o=await n["default"].post("/otp/resend",{email:e,purpose:t,firstName:a});return o.data}catch(o){throw this.handleError(o)}}initializeAuth(){this.getToken()}handleError(e){if(e.response){const t=e.response.data?.message||"An error occurred",a=e.response.data?.errors||[];return new Error(JSON.stringify({message:t,errors:a,status:e.response.status}))}return e.request?new Error(JSON.stringify({message:"Network error. Please check your connection.",errors:[],status:0})):new Error(JSON.stringify({message:e.message||"An unexpected error occurred",errors:[],status:0}))}parseError(e){try{return JSON.parse(e.message)}catch{return{message:e.message,errors:[],status:0}}}}t["default"]=new o},7145:function(e,t,a){a.d(t,{A:function(){return M}});var n=a(6768),o=a(5130),s=a(4232);const i={class:"viewer-header"},r={class:"document-info"},l={class:"document-title"},c={class:"document-meta"},d={class:"filename"},u={class:"file-size"},m={class:"upload-date"},h={class:"viewer-controls"},f=["disabled"],g={key:1,class:"zoom-level me-2"},k=["disabled"],p={class:"viewer-content",ref:"viewerContent"},v={key:0,class:"loading-state"},y={key:1,class:"error-state"},L={class:"text-muted"},w={key:2,class:"image-viewer"},b=["src","alt"],C={key:3,class:"pdf-viewer"},D=["src"],_={key:4,class:"unsupported-file"};function R(e,t,a,R,E,A){return(0,n.uX)(),(0,n.CE)("div",{class:"document-viewer-overlay",onClick:t[11]||(t[11]=(...e)=>A.handleOverlayClick&&A.handleOverlayClick(...e))},[(0,n.Lk)("div",{class:"document-viewer-container",onClick:t[10]||(t[10]=(0,o.D$)((()=>{}),["stop"]))},[(0,n.Lk)("div",i,[(0,n.Lk)("div",r,[(0,n.Lk)("h4",l,[(0,n.Lk)("i",{class:(0,s.C4)([A.getDocumentIcon(a.document.document_type),"me-2"])},null,2),(0,n.eW)(" "+(0,s.v_)(A.formatDocumentType(a.document.document_type)),1)]),(0,n.Lk)("div",c,[(0,n.Lk)("span",d,(0,s.v_)(a.document.document_name),1),(0,n.Lk)("span",u,(0,s.v_)(A.formatFileSize(a.document.file_size)),1),(0,n.Lk)("span",m,"Uploaded: "+(0,s.v_)(A.formatDate(a.document.created_at)),1)])]),(0,n.Lk)("div",h,[E.canZoom?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-outline-secondary btn-sm me-2",onClick:t[0]||(t[0]=(...e)=>A.zoomOut&&A.zoomOut(...e)),disabled:E.zoomLevel<=.5},t[12]||(t[12]=[(0,n.Lk)("i",{class:"fas fa-search-minus"},null,-1)]),8,f)):(0,n.Q3)("",!0),E.canZoom?((0,n.uX)(),(0,n.CE)("span",g,(0,s.v_)(Math.round(100*E.zoomLevel))+"%",1)):(0,n.Q3)("",!0),E.canZoom?((0,n.uX)(),(0,n.CE)("button",{key:2,class:"btn btn-outline-secondary btn-sm me-2",onClick:t[1]||(t[1]=(...e)=>A.zoomIn&&A.zoomIn(...e)),disabled:E.zoomLevel>=3},t[13]||(t[13]=[(0,n.Lk)("i",{class:"fas fa-search-plus"},null,-1)]),8,k)):(0,n.Q3)("",!0),(0,n.Lk)("button",{class:"btn btn-outline-primary btn-sm me-2",onClick:t[2]||(t[2]=(...e)=>A.downloadDocument&&A.downloadDocument(...e))},t[14]||(t[14]=[(0,n.Lk)("i",{class:"fas fa-download me-1"},null,-1),(0,n.eW)(" Download ")])),(0,n.Lk)("button",{class:"btn btn-outline-secondary btn-sm",onClick:t[3]||(t[3]=t=>e.$emit("close"))},t[15]||(t[15]=[(0,n.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,n.eW)(" Close ")]))])]),(0,n.Lk)("div",p,[E.loading?((0,n.uX)(),(0,n.CE)("div",v,t[16]||(t[16]=[(0,n.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,n.Lk)("span",{class:"sr-only"},"Loading...")],-1),(0,n.Lk)("p",{class:"mt-2"},"Loading document...",-1)]))):E.error?((0,n.uX)(),(0,n.CE)("div",y,[t[18]||(t[18]=(0,n.Lk)("i",{class:"fas fa-exclamation-triangle fa-3x text-danger mb-3"},null,-1)),t[19]||(t[19]=(0,n.Lk)("h5",null,"Unable to Load Document",-1)),(0,n.Lk)("p",L,(0,s.v_)(E.error),1),(0,n.Lk)("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...e)=>A.loadDocument&&A.loadDocument(...e))},t[17]||(t[17]=[(0,n.Lk)("i",{class:"fas fa-redo me-1"},null,-1),(0,n.eW)(" Try Again ")]))])):A.isImage?((0,n.uX)(),(0,n.CE)("div",w,[(0,n.Lk)("img",{src:E.documentUrl,alt:a.document.document_name,style:(0,s.Tr)({transform:`scale(${E.zoomLevel})`}),class:"document-image",onLoad:t[5]||(t[5]=(...e)=>A.onImageLoad&&A.onImageLoad(...e)),onError:t[6]||(t[6]=(...e)=>A.onImageError&&A.onImageError(...e))},null,44,b)])):A.isPDF?((0,n.uX)(),(0,n.CE)("div",C,[(0,n.Lk)("iframe",{src:E.documentUrl,class:"pdf-frame",onLoad:t[7]||(t[7]=(...e)=>A.onPDFLoad&&A.onPDFLoad(...e)),onError:t[8]||(t[8]=(...e)=>A.onPDFError&&A.onPDFError(...e))},null,40,D)])):((0,n.uX)(),(0,n.CE)("div",_,[t[21]||(t[21]=(0,n.Lk)("i",{class:"fas fa-file fa-3x text-muted mb-3"},null,-1)),t[22]||(t[22]=(0,n.Lk)("h5",null,"Preview Not Available",-1)),t[23]||(t[23]=(0,n.Lk)("p",{class:"text-muted"},[(0,n.eW)(" This file type cannot be previewed in the browser. "),(0,n.Lk)("br"),(0,n.eW)(" Please download the file to view its contents. ")],-1)),(0,n.Lk)("button",{class:"btn btn-primary",onClick:t[9]||(t[9]=(...e)=>A.downloadDocument&&A.downloadDocument(...e))},t[20]||(t[20]=[(0,n.Lk)("i",{class:"fas fa-download me-1"},null,-1),(0,n.eW)(" Download File ")]))]))],512)])])}var E=a(4300),A={name:"DocumentViewer",props:{document:{type:Object,required:!0}},data(){return{loading:!0,error:null,documentUrl:null,zoomLevel:1,canZoom:!1}},computed:{isImage(){const e=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];return e.includes(this.document.mime_type?.toLowerCase())},isPDF(){return"application/pdf"===this.document.mime_type?.toLowerCase()}},async mounted(){await this.loadDocument()},methods:{async loadDocument(){this.loading=!0,this.error=null;try{const e=await E["default"].get(`/residency/documents/${this.document.id}/file`,{responseType:"blob"}),t=new Blob([e.data],{type:this.document.mime_type});this.documentUrl=URL.createObjectURL(t),this.canZoom=this.isImage}catch(e){console.error("Error loading document:",e),this.error=e.response?.data?.message||"Failed to load document"}finally{this.loading=!1}},async downloadDocument(){try{const e=await E["default"].get(`/residency/documents/${this.document.id}/file`,{responseType:"blob"}),t=new Blob([e.data],{type:this.document.mime_type}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=this.document.document_name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}catch(e){console.error("Error downloading document:",e),alert("Failed to download document")}},handleOverlayClick(){this.$emit("close")},zoomIn(){this.zoomLevel<3&&(this.zoomLevel+=.25)},zoomOut(){this.zoomLevel>.5&&(this.zoomLevel-=.25)},onImageLoad(){this.loading=!1},onImageError(){this.error="Failed to load image",this.loading=!1},onPDFLoad(){this.loading=!1},onPDFError(){this.error="Failed to load PDF",this.loading=!1},formatDocumentType(e){const t={utility_bill:"Utility Bill",barangay_certificate:"Barangay Certificate",valid_id:"Valid ID",lease_contract:"Lease Contract",other:"Other Document"};return t[e]||e},getDocumentIcon(e){const t={utility_bill:"fas fa-file-invoice text-warning",barangay_certificate:"fas fa-certificate text-success",valid_id:"fas fa-id-card text-info",lease_contract:"fas fa-file-contract text-primary",other:"fas fa-file text-secondary"};return t[e]||"fas fa-file text-secondary"},formatFileSize(e){if(!e)return"Unknown size";const t=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+t[a]},formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},beforeUnmount(){this.documentUrl&&URL.revokeObjectURL(this.documentUrl)}},j=a(1241);const x=(0,j.A)(A,[["render",R],["__scopeId","data-v-03960ff5"]]);var M=x}}]);