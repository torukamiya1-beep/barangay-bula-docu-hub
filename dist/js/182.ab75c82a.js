"use strict";(self["webpackChunkbosfdr"]=self["webpackChunkbosfdr"]||[]).push([[182,674],{1182:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ke}});var i=a(6768),s=a(4232),n=a(5130);const o={class:"admin-residency-verification"},r={class:"dashboard-container"},l={class:"container-fluid p-4"},c={class:"row mb-4"},d={class:"col-12"},u={class:"d-flex justify-content-between align-items-center flex-wrap"},h={class:"d-flex gap-2"},m=["disabled"],g={class:"row mb-4"},f={class:"col-md-3 col-sm-6 mb-3"},p={class:"card bg-warning text-white"},k={class:"card-body"},b={class:"d-flex justify-content-between"},v={class:"mb-0"},L={class:"col-md-3 col-sm-6 mb-3"},y={class:"card bg-success text-white"},w={class:"card-body"},M={class:"d-flex justify-content-between"},C={class:"mb-0"},_={class:"col-md-3 col-sm-6 mb-3"},j={class:"card bg-danger text-white"},E={class:"card-body"},D={class:"d-flex justify-content-between"},A={class:"mb-0"},x={class:"col-md-3 col-sm-6 mb-3"},S={class:"card bg-info text-white"},V={class:"card-body"},R={class:"d-flex justify-content-between"},P={class:"mb-0"},T={class:"row"},F={class:"col-12"},N={class:"card"},I={class:"card-body"},$={key:0,class:"text-center py-4"},W={key:1,class:"text-center py-4"},X={key:2,class:"table-responsive"},O={class:"table table-hover"},U={class:"text-muted"},J={class:"text-muted"},z={class:"text-muted"},B={class:"badge bg-info"},q={class:"text-muted"},K={class:"btn-group-vertical btn-group-sm",role:"group"},Q=["onClick","disabled"],G=["onClick","disabled"],H=["onClick","disabled"],Y={key:3,class:"d-flex justify-content-between align-items-center mt-3"},Z={class:"text-muted"},ee={class:"pagination pagination-sm mb-0"},te=["disabled"],ae=["onClick"],ie=["disabled"],se={class:"modal fade",id:"documentModal",tabindex:"-1",ref:"documentModal"},ne={class:"modal-dialog modal-lg"},oe={class:"modal-content"},re={class:"modal-header"},le={class:"modal-title"},ce={class:"modal-body"},de={key:0,class:"text-center py-4"},ue={key:1,class:"text-center py-4"},he={key:2},me={class:"row"},ge={class:"card"},fe={class:"card-body"},pe={class:"card-title"},ke={class:"card-text"},be=["onClick"],ve={class:"modal-footer"},Le=["disabled"],ye=["disabled"],we={class:"modal fade",id:"rejectModal",tabindex:"-1",ref:"rejectModal"},Me={class:"modal-dialog"},Ce={class:"modal-content"},_e={class:"modal-body"},je={class:"mb-3"},Ee={key:0,class:"invalid-feedback"},De={class:"modal-footer"},Ae=["disabled"],xe={key:0,class:"spinner-border spinner-border-sm me-2"},Se={key:1,class:"fas fa-times me-1"},Ve={key:0,class:"toast-container position-fixed top-0 end-0 p-3"},Re={class:"toast show",role:"alert"},Pe={class:"toast-header bg-success text-white"},Te={class:"toast-body"},Fe={key:1,class:"toast-container position-fixed top-0 end-0 p-3"},Ne={class:"toast show",role:"alert"},Ie={class:"toast-header bg-danger text-white"},$e={class:"toast-body"};function We(e,t,a,We,Xe,Oe){const Ue=(0,i.g2)("AdminHeader"),Je=(0,i.g2)("AdminSidebar");return(0,i.uX)(),(0,i.CE)("div",o,[(0,i.bF)(Ue,{userName:e.adminData?.first_name||"Admin",showUserDropdown:e.showUserDropdown,sidebarCollapsed:e.sidebarCollapsed,activeMenu:e.activeMenu,onSidebarToggle:e.handleSidebarToggle,onUserDropdownToggle:e.handleUserDropdownToggle,onMenuAction:e.handleMenuAction,onLogout:e.handleLogout},null,8,["userName","showUserDropdown","sidebarCollapsed","activeMenu","onSidebarToggle","onUserDropdownToggle","onMenuAction","onLogout"]),(0,i.Lk)("div",{class:(0,s.C4)(["mobile-overlay",{active:!e.sidebarCollapsed&&e.isMobile}]),onClick:t[0]||(t[0]=(...t)=>e.closeMobileSidebar&&e.closeMobileSidebar(...t))},null,2),(0,i.Lk)("div",r,[(0,i.bF)(Je,{collapsed:e.sidebarCollapsed,activeMenu:e.activeMenu,onMenuChange:e.handleMenuChange,onLogout:e.handleLogout,onToggleSidebar:e.handleSidebarToggle},null,8,["collapsed","activeMenu","onMenuChange","onLogout","onToggleSidebar"]),(0,i.Lk)("main",{class:(0,s.C4)(["main-content",{"sidebar-collapsed":e.sidebarCollapsed}])},[(0,i.Lk)("div",l,[(0,i.Lk)("div",c,[(0,i.Lk)("div",d,[(0,i.Lk)("div",u,[t[11]||(t[11]=(0,i.Lk)("div",null,[(0,i.Lk)("h2",{class:"mb-1"},[(0,i.Lk)("i",{class:"fas fa-home me-2 text-primary"}),(0,i.eW)(" Residency Verification ")]),(0,i.Lk)("p",{class:"text-muted mb-0"},"Review and approve resident verification requests")],-1)),(0,i.Lk)("div",h,[(0,i.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:t[1]||(t[1]=(...t)=>e.loadPendingVerifications&&e.loadPendingVerifications(...t)),disabled:e.loading},[(0,i.Lk)("i",{class:(0,s.C4)(["fas fa-sync-alt me-1",{"fa-spin":e.loading}])},null,2),t[10]||(t[10]=(0,i.eW)(" Refresh "))],8,m)])])])]),(0,i.Lk)("div",g,[(0,i.Lk)("div",f,[(0,i.Lk)("div",p,[(0,i.Lk)("div",k,[(0,i.Lk)("div",b,[(0,i.Lk)("div",null,[(0,i.Lk)("h4",v,(0,s.v_)(e.statistics.pending),1),t[12]||(t[12]=(0,i.Lk)("p",{class:"mb-0"},"Pending Review",-1))]),t[13]||(t[13]=(0,i.Lk)("div",{class:"align-self-center"},[(0,i.Lk)("i",{class:"fas fa-clock fa-2x"})],-1))])])])]),(0,i.Lk)("div",L,[(0,i.Lk)("div",y,[(0,i.Lk)("div",w,[(0,i.Lk)("div",M,[(0,i.Lk)("div",null,[(0,i.Lk)("h4",C,(0,s.v_)(e.statistics.approved),1),t[14]||(t[14]=(0,i.Lk)("p",{class:"mb-0"},"Approved Today",-1))]),t[15]||(t[15]=(0,i.Lk)("div",{class:"align-self-center"},[(0,i.Lk)("i",{class:"fas fa-check-circle fa-2x"})],-1))])])])]),(0,i.Lk)("div",_,[(0,i.Lk)("div",j,[(0,i.Lk)("div",E,[(0,i.Lk)("div",D,[(0,i.Lk)("div",null,[(0,i.Lk)("h4",A,(0,s.v_)(e.statistics.rejected),1),t[16]||(t[16]=(0,i.Lk)("p",{class:"mb-0"},"Rejected Today",-1))]),t[17]||(t[17]=(0,i.Lk)("div",{class:"align-self-center"},[(0,i.Lk)("i",{class:"fas fa-times-circle fa-2x"})],-1))])])])]),(0,i.Lk)("div",x,[(0,i.Lk)("div",S,[(0,i.Lk)("div",V,[(0,i.Lk)("div",R,[(0,i.Lk)("div",null,[(0,i.Lk)("h4",P,(0,s.v_)(e.statistics.total),1),t[18]||(t[18]=(0,i.Lk)("p",{class:"mb-0"},"Total Requests",-1))]),t[19]||(t[19]=(0,i.Lk)("div",{class:"align-self-center"},[(0,i.Lk)("i",{class:"fas fa-users fa-2x"})],-1))])])])])]),(0,i.Lk)("div",T,[(0,i.Lk)("div",F,[(0,i.Lk)("div",N,[t[33]||(t[33]=(0,i.Lk)("div",{class:"card-header"},[(0,i.Lk)("h5",{class:"mb-0"},[(0,i.Lk)("i",{class:"fas fa-list me-2"}),(0,i.eW)(" Pending Residency Verifications ")])],-1)),(0,i.Lk)("div",I,[e.loading?((0,i.uX)(),(0,i.CE)("div",$,t[20]||(t[20]=[(0,i.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,i.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,i.Lk)("p",{class:"mt-2 text-muted"},"Loading pending verifications...",-1)]))):0===e.pendingVerifications.length?((0,i.uX)(),(0,i.CE)("div",W,t[21]||(t[21]=[(0,i.Lk)("i",{class:"fas fa-inbox fa-3x text-muted mb-3"},null,-1),(0,i.Lk)("h5",{class:"text-muted"},"No Pending Verifications",-1),(0,i.Lk)("p",{class:"text-muted"},"All residency verification requests have been processed.",-1)]))):((0,i.uX)(),(0,i.CE)("div",X,[(0,i.Lk)("table",O,[t[32]||(t[32]=(0,i.Lk)("thead",{class:"table-light"},[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"Applicant"),(0,i.Lk)("th",null,"Contact"),(0,i.Lk)("th",null,"Address"),(0,i.Lk)("th",null,"Registration Date"),(0,i.Lk)("th",null,"Documents"),(0,i.Lk)("th",null,"Actions")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.pendingVerifications,(a=>((0,i.uX)(),(0,i.CE)("tr",{key:a.account_id},[(0,i.Lk)("td",null,[(0,i.Lk)("div",null,[(0,i.Lk)("strong",null,(0,s.v_)(e.getFullName(a)),1),t[22]||(t[22]=(0,i.Lk)("br",null,null,-1)),(0,i.Lk)("small",U,"@"+(0,s.v_)(a.username),1)])]),(0,i.Lk)("td",null,[(0,i.Lk)("div",null,[t[23]||(t[23]=(0,i.Lk)("i",{class:"fas fa-envelope me-1"},null,-1)),(0,i.eW)((0,s.v_)(a.email),1),t[24]||(t[24]=(0,i.Lk)("br",null,null,-1)),t[25]||(t[25]=(0,i.Lk)("i",{class:"fas fa-phone me-1"},null,-1)),(0,i.eW)((0,s.v_)(a.phone_number||"N/A"),1)])]),(0,i.Lk)("td",null,[(0,i.Lk)("div",null,[(0,i.eW)((0,s.v_)(a.barangay),1),t[26]||(t[26]=(0,i.Lk)("br",null,null,-1)),(0,i.Lk)("small",J,(0,s.v_)(a.city_municipality)+", "+(0,s.v_)(a.province),1)])]),(0,i.Lk)("td",null,[(0,i.Lk)("div",null,[(0,i.eW)((0,s.v_)(e.formatDate(a.registration_date)),1),t[27]||(t[27]=(0,i.Lk)("br",null,null,-1)),(0,i.Lk)("small",z,(0,s.v_)(e.getTimeAgo(a.registration_date)),1)])]),(0,i.Lk)("td",null,[(0,i.Lk)("div",null,[(0,i.Lk)("span",B,(0,s.v_)(a.document_count)+" files",1),t[28]||(t[28]=(0,i.Lk)("br",null,null,-1)),(0,i.Lk)("small",q," Last upload: "+(0,s.v_)(e.formatDate(a.latest_document_upload)),1)])]),(0,i.Lk)("td",null,[(0,i.Lk)("div",K,[(0,i.Lk)("button",{class:"btn btn-outline-primary",onClick:t=>e.viewDocuments(a),disabled:e.actionLoading},t[29]||(t[29]=[(0,i.Lk)("i",{class:"fas fa-eye me-1"},null,-1),(0,i.eW)(" View Documents ")]),8,Q),(0,i.Lk)("button",{class:"btn btn-outline-success",onClick:t=>e.approveVerification(a),disabled:e.actionLoading},t[30]||(t[30]=[(0,i.Lk)("i",{class:"fas fa-check me-1"},null,-1),(0,i.eW)(" Approve ")]),8,G),(0,i.Lk)("button",{class:"btn btn-outline-danger",onClick:t=>e.showRejectModal(a),disabled:e.actionLoading},t[31]||(t[31]=[(0,i.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,i.eW)(" Reject ")]),8,H)])])])))),128))])])])),e.pagination&&e.pagination.totalPages>1?((0,i.uX)(),(0,i.CE)("div",Y,[(0,i.Lk)("div",null,[(0,i.Lk)("small",Z," Showing "+(0,s.v_)((e.pagination.page-1)*e.pagination.limit+1)+" to "+(0,s.v_)(Math.min(e.pagination.page*e.pagination.limit,e.pagination.total))+" of "+(0,s.v_)(e.pagination.total)+" entries ",1)]),(0,i.Lk)("nav",null,[(0,i.Lk)("ul",ee,[(0,i.Lk)("li",{class:(0,s.C4)(["page-item",{disabled:e.pagination.page<=1}])},[(0,i.Lk)("button",{class:"page-link",onClick:t[2]||(t[2]=t=>e.changePage(e.pagination.page-1)),disabled:e.pagination.page<=1}," Previous ",8,te)],2),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.getPageNumbers(),(t=>((0,i.uX)(),(0,i.CE)("li",{key:t,class:(0,s.C4)(["page-item",{active:t===e.pagination.page}])},[(0,i.Lk)("button",{class:"page-link",onClick:a=>e.changePage(t)},(0,s.v_)(t),9,ae)],2)))),128)),(0,i.Lk)("li",{class:(0,s.C4)(["page-item",{disabled:e.pagination.page>=e.pagination.totalPages}])},[(0,i.Lk)("button",{class:"page-link",onClick:t[3]||(t[3]=t=>e.changePage(e.pagination.page+1)),disabled:e.pagination.page>=e.pagination.totalPages}," Next ",8,ie)],2)])])])):(0,i.Q3)("",!0)])])])])])],2)]),(0,i.Lk)("div",se,[(0,i.Lk)("div",ne,[(0,i.Lk)("div",oe,[(0,i.Lk)("div",re,[(0,i.Lk)("h5",le,[t[34]||(t[34]=(0,i.Lk)("i",{class:"fas fa-file-alt me-2"},null,-1)),(0,i.eW)(" Residency Documents - "+(0,s.v_)(e.selectedVerification?.first_name)+" "+(0,s.v_)(e.selectedVerification?.last_name),1)]),t[35]||(t[35]=(0,i.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),(0,i.Lk)("div",ce,[e.loadingDocuments?((0,i.uX)(),(0,i.CE)("div",de,t[36]||(t[36]=[(0,i.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,i.Lk)("span",{class:"visually-hidden"},"Loading documents...")],-1)]))):0===e.documents.length?((0,i.uX)(),(0,i.CE)("div",ue,t[37]||(t[37]=[(0,i.Lk)("i",{class:"fas fa-file-slash fa-3x text-muted mb-3"},null,-1),(0,i.Lk)("p",{class:"text-muted"},"No documents found for this verification request.",-1)]))):((0,i.uX)(),(0,i.CE)("div",he,[(0,i.Lk)("div",me,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.documents,(a=>((0,i.uX)(),(0,i.CE)("div",{key:a.id,class:"col-md-6 mb-3"},[(0,i.Lk)("div",ge,[(0,i.Lk)("div",fe,[(0,i.Lk)("h6",pe,[t[38]||(t[38]=(0,i.Lk)("i",{class:"fas fa-file me-2"},null,-1)),(0,i.eW)(" "+(0,s.v_)(e.getDocumentTypeLabel(a.document_type)),1)]),(0,i.Lk)("p",ke,[t[39]||(t[39]=(0,i.Lk)("strong",null,"File:",-1)),(0,i.eW)(" "+(0,s.v_)(a.document_name),1),t[40]||(t[40]=(0,i.Lk)("br",null,null,-1)),t[41]||(t[41]=(0,i.Lk)("strong",null,"Size:",-1)),(0,i.eW)(" "+(0,s.v_)(e.formatFileSize(a.file_size)),1),t[42]||(t[42]=(0,i.Lk)("br",null,null,-1)),t[43]||(t[43]=(0,i.Lk)("strong",null,"Uploaded:",-1)),(0,i.eW)(" "+(0,s.v_)(e.formatDate(a.created_at)),1)]),(0,i.Lk)("button",{class:"btn btn-primary btn-sm",onClick:t=>e.viewDocument(a)},t[44]||(t[44]=[(0,i.Lk)("i",{class:"fas fa-eye me-1"},null,-1),(0,i.eW)(" View Document ")]),8,be)])])])))),128))])]))]),(0,i.Lk)("div",ve,[t[47]||(t[47]=(0,i.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1)),(0,i.Lk)("button",{type:"button",class:"btn btn-success",onClick:t[4]||(t[4]=(...t)=>e.approveFromModal&&e.approveFromModal(...t)),disabled:e.actionLoading},t[45]||(t[45]=[(0,i.Lk)("i",{class:"fas fa-check me-1"},null,-1),(0,i.eW)(" Approve Verification ")]),8,Le),(0,i.Lk)("button",{type:"button",class:"btn btn-danger",onClick:t[5]||(t[5]=(...t)=>e.showRejectModalFromDocuments&&e.showRejectModalFromDocuments(...t)),disabled:e.actionLoading},t[46]||(t[46]=[(0,i.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,i.eW)(" Reject Verification ")]),8,ye)])])])],512),(0,i.Lk)("div",we,[(0,i.Lk)("div",Me,[(0,i.Lk)("div",Ce,[t[52]||(t[52]=(0,i.Lk)("div",{class:"modal-header"},[(0,i.Lk)("h5",{class:"modal-title"},[(0,i.Lk)("i",{class:"fas fa-times-circle me-2 text-danger"}),(0,i.eW)(" Reject Residency Verification ")]),(0,i.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),(0,i.Lk)("div",_e,[(0,i.Lk)("p",null,[t[48]||(t[48]=(0,i.eW)(" You are about to reject the residency verification for: ")),(0,i.Lk)("strong",null,(0,s.v_)(e.selectedVerification?.first_name)+" "+(0,s.v_)(e.selectedVerification?.last_name),1)]),(0,i.Lk)("div",je,[t[49]||(t[49]=(0,i.Lk)("label",{for:"rejectionReason",class:"form-label"},[(0,i.eW)(" Reason for Rejection "),(0,i.Lk)("span",{class:"text-danger"},"*")],-1)),(0,i.bo)((0,i.Lk)("textarea",{id:"rejectionReason",class:(0,s.C4)(["form-control",{"is-invalid":e.rejectionError}]),"onUpdate:modelValue":t[6]||(t[6]=t=>e.rejectionReason=t),rows:"4",placeholder:"Please provide a clear reason for rejecting this verification request...",required:""},null,2),[[n.Jo,e.rejectionReason]]),e.rejectionError?((0,i.uX)(),(0,i.CE)("div",Ee,(0,s.v_)(e.rejectionError),1)):(0,i.Q3)("",!0),t[50]||(t[50]=(0,i.Lk)("div",{class:"form-text"}," This reason will be sent to the applicant. Please be clear and helpful. ",-1))])]),(0,i.Lk)("div",De,[t[51]||(t[51]=(0,i.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),(0,i.Lk)("button",{type:"button",class:"btn btn-danger",onClick:t[7]||(t[7]=(...t)=>e.confirmRejectVerification&&e.confirmRejectVerification(...t)),disabled:e.actionLoading||!e.rejectionReason.trim()},[e.actionLoading?((0,i.uX)(),(0,i.CE)("span",xe)):((0,i.uX)(),(0,i.CE)("i",Se)),(0,i.eW)(" "+(0,s.v_)(e.actionLoading?"Rejecting...":"Reject Verification"),1)],8,Ae)])])])],512),e.successMessage?((0,i.uX)(),(0,i.CE)("div",Ve,[(0,i.Lk)("div",Re,[(0,i.Lk)("div",Pe,[t[53]||(t[53]=(0,i.Lk)("i",{class:"fas fa-check-circle me-2"},null,-1)),t[54]||(t[54]=(0,i.Lk)("strong",{class:"me-auto"},"Success",-1)),(0,i.Lk)("button",{type:"button",class:"btn-close btn-close-white",onClick:t[8]||(t[8]=t=>e.successMessage="")})]),(0,i.Lk)("div",Te,(0,s.v_)(e.successMessage),1)])])):(0,i.Q3)("",!0),e.errorMessage?((0,i.uX)(),(0,i.CE)("div",Fe,[(0,i.Lk)("div",Ne,[(0,i.Lk)("div",Ie,[t[55]||(t[55]=(0,i.Lk)("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),t[56]||(t[56]=(0,i.Lk)("strong",{class:"me-auto"},"Error",-1)),(0,i.Lk)("button",{type:"button",class:"btn-close btn-close-white",onClick:t[9]||(t[9]=t=>e.errorMessage="")})]),(0,i.Lk)("div",$e,(0,s.v_)(e.errorMessage),1)])])):(0,i.Q3)("",!0)])}a(4114);var Xe=a(3237),Oe=a(2944),Ue=a(2674),Je=a(8077),ze={name:"AdminResidencyVerification",components:{AdminHeader:Xe.A,AdminSidebar:Oe.A},data(){return{adminData:null,sidebarCollapsed:!1,showUserDropdown:!1,activeMenu:"residency-verification",isMobile:!1,loading:!1,actionLoading:!1,loadingDocuments:!1,pendingVerifications:[],documents:[],selectedVerification:null,pagination:{page:1,limit:10,total:0,totalPages:0},statistics:{pending:0,approved:0,rejected:0,total:0},rejectionReason:"",rejectionError:"",successMessage:"",errorMessage:""}},async mounted(){this.checkMobile(),window.addEventListener("resize",this.checkMobile);try{this.adminData=await Ue["default"].getCurrentAdmin(),await this.loadPendingVerifications(),await this.loadStatistics()}catch(e){console.error("Failed to initialize admin residency verification:",e),this.errorMessage="Failed to load admin data"}},beforeUnmount(){window.removeEventListener("resize",this.checkMobile)},methods:{checkMobile(){this.isMobile=window.innerWidth<768,this.isMobile||(this.sidebarCollapsed=!1)},handleSidebarToggle(){this.sidebarCollapsed=!this.sidebarCollapsed},closeMobileSidebar(){this.isMobile&&(this.sidebarCollapsed=!0)},handleUserDropdownToggle(){this.showUserDropdown=!this.showUserDropdown},handleMenuChange(e){this.activeMenu=e,this.showUserDropdown=!1},handleMenuAction(e){"profile"===e?this.$router.push("/admin/profile"):"settings"===e&&this.$router.push("/admin/settings"),this.showUserDropdown=!1},async handleLogout(){try{await Ue["default"].logout(),this.$router.push("/admin/login")}catch(e){console.error("Logout failed:",e)}},async loadPendingVerifications(e=1){this.loading=!0,this.clearMessages();try{const t=await this.fetchPendingVerifications(e);if(!t.success)throw new Error(t.message||"Failed to load pending verifications");this.pendingVerifications=t.data,this.pagination=t.pagination}catch(t){console.error("Failed to load pending verifications:",t),this.errorMessage=t.message||"Failed to load pending verifications"}finally{this.loading=!1}},async loadStatistics(){try{this.statistics={pending:this.pendingVerifications.length,approved:0,rejected:0,total:this.pagination.total||this.pendingVerifications.length}}catch(e){console.error("Failed to load statistics:",e)}},async fetchPendingVerifications(e=1,t=10){const a=await fetch(`/api/residency/pending?page=${e}&limit=${t}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`,"Content-Type":"application/json"}}),i=await a.json();if(!a.ok)throw new Error(i.message||"Failed to fetch pending verifications");return i},async fetchAccountDocuments(e){const t=await fetch(`/api/residency/documents/${e}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`,"Content-Type":"application/json"}}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to fetch documents");return a},async approveVerificationAPI(e){const t=await fetch("/api/residency/approve",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`,"Content-Type":"application/json"},body:JSON.stringify({account_id:e})}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to approve verification");return a},async rejectVerificationAPI(e,t){const a=await fetch("/api/residency/reject",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`,"Content-Type":"application/json"},body:JSON.stringify({account_id:e,rejection_reason:t})}),i=await a.json();if(!a.ok)throw new Error(i.message||"Failed to reject verification");return i},async viewDocuments(e){this.selectedVerification=e,this.loadingDocuments=!0,this.documents=[];const t=new Je.aF(this.$refs.documentModal);t.show();try{const t=await this.fetchAccountDocuments(e.account_id);if(!t.success)throw new Error(t.message||"Failed to load documents");this.documents=t.data}catch(a){console.error("Failed to load documents:",a),this.errorMessage=a.message||"Failed to load documents"}finally{this.loadingDocuments=!1}},async approveVerification(e){if(confirm(`Are you sure you want to approve the residency verification for ${e.first_name} ${e.last_name}?`)){this.actionLoading=!0,this.clearMessages();try{const t=await this.approveVerificationAPI(e.account_id);if(!t.success)throw new Error(t.message||"Failed to approve verification");this.successMessage=`Residency verification approved for ${e.first_name} ${e.last_name}`,await this.loadPendingVerifications(this.pagination.page),await this.loadStatistics()}catch(t){console.error("Failed to approve verification:",t),this.errorMessage=t.message||"Failed to approve verification"}finally{this.actionLoading=!1}}},showRejectModal(e){this.selectedVerification=e,this.rejectionReason="",this.rejectionError="";const t=new Je.aF(this.$refs.rejectModal);t.show()},async confirmRejectVerification(){if(this.rejectionReason.trim())if(this.rejectionReason.trim().length<10)this.rejectionError="Rejection reason must be at least 10 characters";else{this.actionLoading=!0,this.rejectionError="",this.clearMessages();try{const e=await this.rejectVerificationAPI(this.selectedVerification.account_id,this.rejectionReason.trim());if(!e.success)throw new Error(e.message||"Failed to reject verification");{this.successMessage=`Residency verification rejected for ${this.selectedVerification.first_name} ${this.selectedVerification.last_name}`;const e=Je.aF.getInstance(this.$refs.rejectModal);e.hide(),await this.loadPendingVerifications(this.pagination.page),await this.loadStatistics()}}catch(e){console.error("Failed to reject verification:",e),this.errorMessage=e.message||"Failed to reject verification"}finally{this.actionLoading=!1}}else this.rejectionError="Rejection reason is required"},approveFromModal(){const e=Je.aF.getInstance(this.$refs.documentModal);e.hide(),this.approveVerification(this.selectedVerification)},showRejectModalFromDocuments(){const e=Je.aF.getInstance(this.$refs.documentModal);e.hide(),setTimeout((()=>{this.showRejectModal(this.selectedVerification)}),300)},viewDocument(e){alert(`Viewing document: ${e.document_name}\nThis feature would open the document file.`)},changePage(e){e>=1&&e<=this.pagination.totalPages&&e!==this.pagination.page&&this.loadPendingVerifications(e)},getPageNumbers(){const e=[],t=this.pagination.totalPages,a=this.pagination.page;let i=Math.max(1,a-2),s=Math.min(t,i+4);s-i<4&&(i=Math.max(1,s-4));for(let n=i;n<=s;n++)e.push(n);return e},getFullName(e){const t=[e.first_name,e.middle_name,e.last_name].filter(Boolean);return t.join(" ")},formatDate(e){if(!e)return"N/A";try{const t=new Date(e);return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Invalid Date"}},getTimeAgo(e){if(!e)return"N/A";try{const t=new Date(e),a=new Date,i=Math.floor((a-t)/1e3);return i<60?"Just now":i<3600?`${Math.floor(i/60)} minutes ago`:i<86400?`${Math.floor(i/3600)} hours ago`:i<2592e3?`${Math.floor(i/86400)} days ago`:this.formatDate(e)}catch(t){return"N/A"}},getDocumentTypeLabel(e){const t={utility_bill:"Utility Bill",barangay_certificate:"Barangay Certificate",valid_id:"Valid ID",lease_contract:"Lease Contract",other:"Other Document"};return t[e]||e},formatFileSize(e){if(!e)return"N/A";const t=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+t[a]},clearMessages(){this.successMessage="",this.errorMessage=""}}},Be=a(1241);const qe=(0,Be.A)(ze,[["render",We],["__scopeId","data-v-f6bbeb4c"]]);var Ke=qe},2674:function(e,t,a){a.r(t);a(8111),a(3579),a(4979);var i=a(4300);class s{async registerAccount(e){try{const t=await i["default"].post("/admin/auth/register-account",e);return t.data}catch(t){throw this.handleError(t)}}async completeRegistration(e,t){try{const a=await i["default"].post(`/admin/auth/complete-registration/${e}`,t);return a.data}catch(a){throw this.handleError(a)}}async verifyEmail(e,t){try{const a=await i["default"].post("/admin/auth/verify-email",{email:e,otp:t});return a.data}catch(a){throw this.handleError(a)}}async resendVerificationEmail(e){try{const t=await i["default"].post("/admin/auth/resend-verification",{email:e});return t.data}catch(t){throw this.handleError(t)}}async login(e){try{const t=await i["default"].post("/admin/auth/login",e);return t.data.success&&t.data.data.token&&(localStorage.setItem("adminToken",t.data.data.token),localStorage.setItem("adminData",JSON.stringify(t.data.data.admin))),t.data}catch(t){throw this.handleError(t)}}async getProfile(){try{const e=await i["default"].get("/admin/auth/profile");return e.data.success&&e.data.data&&localStorage.setItem("adminData",JSON.stringify(e.data.data)),e.data}catch(e){throw this.handleError(e)}}async updateProfile(e){try{const t=await i["default"].put("/admin/auth/profile",e);return t.data.success&&t.data.data&&localStorage.setItem("adminData",JSON.stringify(t.data.data)),t.data}catch(t){throw this.handleError(t)}}async changePassword(e){try{const t=await i["default"].put("/admin/auth/change-password",e);return t.data}catch(t){throw this.handleError(t)}}async sendPasswordReset(e){try{const t=await i["default"].post("/admin/auth/forgot-password",{email:e});return t.data}catch(t){throw this.handleError(t)}}async resetPassword(e,t){try{const a=await i["default"].post("/admin/auth/reset-password",{token:e,newPassword:t});return a.data}catch(a){throw this.handleError(a)}}async getDashboardStats(){try{const e=await i["default"].get("/admin/dashboard/stats");return e.data}catch(e){throw this.handleError(e)}}async getRecentActivity(e=10){try{const t=await i["default"].get(`/admin/dashboard/activity?limit=${e}`);return t.data}catch(t){throw this.handleError(t)}}async getNotifications(e=20){try{const t=await i["default"].get(`/admin/notifications?limit=${e}`);return t.data}catch(t){throw this.handleError(t)}}async markNotificationAsRead(e){try{const t=await i["default"].put(`/admin/notifications/${e}/read`);return t.data}catch(t){throw this.handleError(t)}}async markAllNotificationsAsRead(){try{const e=await i["default"].put("/admin/notifications/read-all");return e.data}catch(e){throw this.handleError(e)}}async logout(){try{await i["default"].post("/admin/auth/logout")}catch(e){console.error("Logout API error:",e)}finally{this.clearAuthData()}}clearAuthData(){localStorage.removeItem("adminToken"),localStorage.removeItem("adminData")}isLoggedIn(){const e=localStorage.getItem("adminToken");return!!e}isAuthenticated(){const e=localStorage.getItem("adminToken"),t=this.getAdminData();if(!e||!t)return!1;try{const t=e.split(".");if(3!==t.length)return!1;const a=JSON.parse(atob(t[1])),i=Math.floor(Date.now()/1e3);return a.exp&&a.exp<i?(this.clearAuthData(),!1):"admin"===a.type||(this.clearAuthData(),!1)}catch(a){return console.error("Token validation error:",a),this.clearAuthData(),!1}}hasRole(e){const t=this.getAdminData();return!(!t||!this.isAuthenticated())&&("admin"===t.role||t.role===e)}hasAnyRole(e){return Array.isArray(e)?e.some((e=>this.hasRole(e))):this.hasRole(e)}getAdminData(){const e=localStorage.getItem("adminData");return e?JSON.parse(e):null}getToken(){return localStorage.getItem("adminToken")}async sendOTP(e,t="registration",a=""){try{const s=await i["default"].post("/otp/send",{email:e,purpose:t,firstName:a});return s.data}catch(s){throw this.handleError(s)}}async verifyOTP(e,t,a="registration"){try{const s=await i["default"].post("/otp/verify",{email:e,otp:t,purpose:a});return s.data}catch(s){throw this.handleError(s)}}async resendOTP(e,t="registration",a=""){try{const s=await i["default"].post("/otp/resend",{email:e,purpose:t,firstName:a});return s.data}catch(s){throw this.handleError(s)}}initializeAuth(){this.getToken()}handleError(e){if(e.response){const t=e.response.data?.message||"An error occurred",a=e.response.data?.errors||[];return new Error(JSON.stringify({message:t,errors:a,status:e.response.status}))}return e.request?new Error(JSON.stringify({message:"Network error. Please check your connection.",errors:[],status:0})):new Error(JSON.stringify({message:e.message||"An unexpected error occurred",errors:[],status:0}))}parseError(e){try{return JSON.parse(e.message)}catch{return{message:e.message,errors:[],status:0}}}}t["default"]=new s}}]);