"use strict";(self["webpackChunkbosfdr"]=self["webpackChunkbosfdr"]||[]).push([[599,603],{1939:function(e,t,s){s(8111),s(7588);var a=s(4300);class n{async getDocumentTypes(){try{const e=await a["default"].get("/client/document-requests/document-types");return e.data}catch(e){throw console.error("Error fetching document types:",e),e}}async getPurposeCategories(){try{const e=await a["default"].get("/client/document-requests/purpose-categories");return e.data}catch(e){throw console.error("Error fetching purpose categories:",e),e}}async getPaymentMethods(){try{const e=await a["default"].get("/client/document-requests/payment-methods");return e.data}catch(e){throw console.error("Error fetching payment methods:",e),e}}async submitRequest(e){try{const t=await a["default"].post("/client/document-requests",e);return t.data}catch(t){throw console.error("Error submitting request:",t),t}}async getMyRequests(e={}){try{const t=new URLSearchParams;Object.keys(e).forEach((s=>{null!==e[s]&&void 0!==e[s]&&""!==e[s]&&t.append(s,e[s])}));const s=await a["default"].get(`/client/document-requests?${t.toString()}`);return s.data}catch(t){throw console.error("Error fetching requests:",t),t}}async getRequestDetails(e){try{const t=await a["default"].get(`/client/document-requests/${e}`);return t.data}catch(t){throw console.error("Error fetching request details:",t),t}}async updateRequest(e,t){try{const s=await a["default"].put(`/client/document-requests/${e}`,t);return s.data}catch(s){throw console.error("Error updating request:",s),s}}async cancelRequest(e,t){try{const s=await a["default"].put(`/client/document-requests/${e}/cancel`,{reason:t});return s.data}catch(s){throw console.error("Error cancelling request:",s),s}}async getRequestHistory(e){try{const t=await a["default"].get(`/client/document-requests/${e}/history`);return t.data}catch(t){throw console.error("Error fetching request history:",t),t}}async processPayment(e,t){try{const s=await a["default"].post(`/client/document-requests/${e}/payment`,t);return s.data}catch(s){throw console.error("Error processing payment:",s),s}}async getPaymentStatus(e){try{const t=await a["default"].get(`/client/document-requests/${e}/payment/status`);return t.data}catch(t){throw console.error("Error fetching payment status:",t),t}}async calculateFees(e){try{const t=await a["default"].post("/client/document-requests/calculate-cedula-tax",e);return t.data}catch(t){throw console.error("Error calculating fees:",t),t}}async getDashboardStats(){return{success:!0,data:{total_requests:0,pending_requests:0,completed_requests:0,recent_activity:[]},message:"Dashboard stats placeholder"}}async getRecentActivity(e=10){try{return{success:!0,data:[],message:"Recent activity placeholder"}}catch(t){throw console.error("Error fetching recent activity:",t),t}}async uploadDocuments(e,t){try{const s=new FormData;t.forEach((({type:e,file:t})=>{s.append(e,t)}));const n=await a["default"].post(`/client/document-requests/${e}/documents`,s,{headers:{"Content-Type":"multipart/form-data"}});return n.data}catch(s){throw console.error("Error uploading documents:",s),s}}async getDocuments(e){try{const t=await a["default"].get(`/client/document-requests/${e}/documents`);return t.data}catch(t){throw console.error("Error fetching documents:",t),t}}async deleteDocument(e,t){try{const s=await a["default"].delete(`/client/document-requests/${e}/documents/${t}`);return s.data}catch(s){throw console.error("Error deleting document:",s),s}}async fetchVerificationImageBlob(e,t,s){try{const n=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token");if(!n)throw new Error("Please log in to view images");console.log("🔗 Fetching verification image:",{requestId:e,imageType:t,filename:s,hasToken:!!n});const r=await a["default"].get(`/client/document-requests/${e}/verification-image/${t}/${s}`,{responseType:"blob"});return console.log("✅ Image fetched successfully:",{filename:s,size:r.data.size,type:r.data.type}),r.data}catch(n){throw console.error(`❌ Error fetching ${t} verification image:`,{status:n.response?.status,statusText:n.response?.statusText,data:n.response?.data,filename:s,imageType:t,requestId:e,message:n.message}),404===n.response?.status?new Error(`Image not found: ${s}`):401===n.response?.status?new Error("Please log in to view images"):403===n.response?.status?new Error("Access denied to this image"):500===n.response?.status||n.response?.status>=500?new Error("Server error - please contact support"):"NETWORK_ERROR"===n.code||n.message.includes("Network Error")?new Error("Network error - check your connection"):n.message.includes("log in")?new Error(n.message):new Error(n.response?.data?.message||n.message||"Failed to load image")}}async getVerificationImageObjectUrl(e,t,s){try{const a=await this.fetchVerificationImageBlob(e,t,s);return URL.createObjectURL(a)}catch(a){throw console.error(`Error creating object URL for ${t} image:`,a),a}}}t.A=new n},2599:function(e,t,s){s(4114),s(8111),s(116),s(7588);var a=s(4300);class n{async getPaymentConfig(){try{const e=await a["default"].get("/payments/config");return e.data}catch(e){throw console.error("Failed to get payment config:",e),e}}async initiatePayment(e){try{const t=await a["default"].post("/payments/initiate",e);return t.data}catch(t){throw console.error("Failed to initiate payment:",t),t}}async getPaymentStatus(e){try{const t=await a["default"].get(`/payments/status/${e}`);return t.data}catch(t){throw console.error("Failed to get payment status:",t),t}}async getPaymentVerificationQueue(){try{const e=await a["default"].get("/admin/documents/payment-verification-queue");return e.data}catch(e){throw console.error("Failed to get payment verification queue:",e),e}}async verifyInPersonPayment(e,t){try{const s=await a["default"].post(`/admin/documents/requests/${e}/verify-payment`,t);return s.data}catch(s){throw console.error("Failed to verify in-person payment:",s),s}}redirectToPayMongo(e){if(!e)throw new Error("Invalid checkout URL");window.location.href=e}formatAmount(e){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(e)}getPaymentMethodDisplayName(e){const t={CASH:"Cash Payment",ONLINE_PAYMENT_GROUP:"Online Payment",PAYMONGO_CARD:"Credit/Debit Card",PAYMONGO_GCASH:"GCash",PAYMONGO_GRABPAY:"GrabPay",PAYMONGO_PAYMAYA:"Maya (PayMaya)",PAYMONGO_BANK:"Bank Transfer"};return t[e]||e}groupPaymentMethods(e){if(!Array.isArray(e))return[];const t=[],s=[];e.forEach((e=>{this.isOnlinePaymentMethod(e.method_code)?s.push(e):t.push(e)}));const a=[];return t.forEach((e=>{a.push({id:e.id,method_name:e.method_name,method_code:e.method_code,description:e.description,is_online:e.is_online,is_active:e.is_active,processing_fee_percentage:e.processing_fee_percentage,processing_fee_fixed:e.processing_fee_fixed,group_type:"individual"})})),s.length>0&&a.push({id:"ONLINE_PAYMENT_GROUP",method_name:"Online Payment",method_code:"ONLINE_PAYMENT_GROUP",description:"Pay securely online using credit/debit card, GCash, GrabPay, Maya, or bank transfer",is_online:!0,is_active:!0,processing_fee_percentage:s[0]?.processing_fee_percentage||0,processing_fee_fixed:s[0]?.processing_fee_fixed||0,group_type:"group",grouped_methods:s}),a}getActualPaymentMethodId(e,t){if("ONLINE_PAYMENT_GROUP"===e){const e=["PAYMONGO_CARD","PAYMONGO_GCASH","PAYMONGO_GRABPAY","PAYMONGO_PAYMAYA","PAYMONGO_BANK"];for(const a of e){const e=t.find((e=>e.method_code===a&&e.is_active));if(e)return e.id}const s=t.find((e=>this.isOnlinePaymentMethod(e.method_code)&&e.is_active));return s?s.id:null}return parseInt(e)}isOnlinePaymentMethod(e){return e&&e.startsWith("PAYMONGO_")}getPaymentStatusDisplay(e){const t={pending:{text:"Pending",color:"warning",icon:"clock"},succeeded:{text:"Paid",color:"success",icon:"check-circle"},failed:{text:"Failed",color:"danger",icon:"x-circle"},cancelled:{text:"Cancelled",color:"secondary",icon:"x"}};return t[e]||{text:e,color:"secondary",icon:"help-circle"}}calculateProcessingFee(e,t=0,s=0){const a=e*t/100;return a+s}calculateTotalAmount(e,t=0,s=0){const a=this.calculateProcessingFee(e,t,s),n=e+a;return{baseAmount:e,processingFee:a,totalAmount:n,formattedBase:this.formatAmount(e),formattedFee:this.formatAmount(a),formattedTotal:this.formatAmount(n)}}validatePaymentData(e){const t=[];return e.request_id||t.push("Request ID is required"),e.payment_method_id||t.push("Payment method is required"),e.customer_email&&!this.isValidEmail(e.customer_email)&&t.push("Invalid email format"),{isValid:0===t.length,errors:t}}isValidEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)}getErrorMessage(e){return e.response?.data?.message?e.response.data.message:400===e.response?.status?"Invalid payment information. Please check your details and try again.":401===e.response?.status?"You need to be logged in to make a payment.":404===e.response?.status?"Payment service not found. Please contact support.":e.response?.status>=500?"Payment service is temporarily unavailable. Please try again later.":e.message||"An unexpected error occurred during payment processing."}}t["default"]=new n},9603:function(e,t,s){s.r(t),s.d(t,{default:function(){return ce}});var a=s(6768),n=s(5130),r=s(4232);const o={class:"my-requests-page"},i={class:"page-header"},c={class:"header-content"},l={class:"header-actions"},u={class:"page-content"},d={class:"filters-section"},p={class:"filters-container"},m={class:"search-box"},h={class:"filter-group"},g={class:"filter-group"},y={key:0,class:"loading-container"},f={key:1,class:"error-container"},_={class:"error-content"},k={key:2,class:"empty-state"},q={class:"empty-content"},P={key:3,class:"requests-container"},w={class:"table-controls"},v={class:"entries-selector"},b={class:"table-info"},L={class:"table-wrapper"},R={class:"requests-table"},C=["onClick"],A={class:"col-id"},E={class:"request-id"},T={class:"col-type"},x={class:"document-type"},F={class:"col-purpose"},N={class:"col-status"},S={class:"status-container"},I={key:0,class:"rejection-reason"},M={class:"text-muted"},D={class:"col-date"},O={class:"col-amount"},$={class:"amount"},Y={class:"col-progress"},U={class:"progress-container"},B={class:"progress-bar"},G={class:"progress-text"},j={class:"col-actions"},X={class:"action-buttons"},Q=["onClick"],V=["onClick"],W=["onClick"],z={key:0,class:"pagination"},H=["disabled"],K={class:"page-numbers"},J=["onClick"],Z=["disabled"];function ee(e,t,s,ee,te,se){return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",i,[(0,a.Lk)("div",c,[t[14]||(t[14]=(0,a.Lk)("div",{class:"header-main"},[(0,a.Lk)("h1",{class:"page-title"},[(0,a.Lk)("i",{class:"fas fa-file-alt"}),(0,a.eW)(" My Document Requests ")]),(0,a.Lk)("p",{class:"page-description"}," Track and manage your document requests ")],-1)),(0,a.Lk)("div",l,[(0,a.Lk)("button",{class:"back-btn",onClick:t[0]||(t[0]=(...e)=>se.goBack&&se.goBack(...e))},t[13]||(t[13]=[(0,a.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,a.eW)(" Back to Dashboard ")]))])])]),(0,a.Lk)("div",u,[(0,a.Lk)("div",d,[(0,a.Lk)("div",p,[(0,a.Lk)("div",m,[t[15]||(t[15]=(0,a.Lk)("i",{class:"fas fa-search"},null,-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>te.searchQuery=e),type:"text",placeholder:"Search requests...",onInput:t[2]||(t[2]=(...e)=>se.handleSearch&&se.handleSearch(...e))},null,544),[[n.Jo,te.searchQuery]])]),(0,a.Lk)("div",h,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>te.typeFilter=e),onChange:t[4]||(t[4]=(...e)=>se.applyFilters&&se.applyFilters(...e))},t[16]||(t[16]=[(0,a.Lk)("option",{value:""},"All Types",-1),(0,a.Lk)("option",{value:"Barangay Clearance"},"Barangay Clearance",-1),(0,a.Lk)("option",{value:"Cedula"},"Cedula",-1)]),544),[[n.u1,te.typeFilter]])]),(0,a.Lk)("div",g,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>te.sortBy=e),onChange:t[6]||(t[6]=(...e)=>se.applyFilters&&se.applyFilters(...e))},t[17]||(t[17]=[(0,a.Lk)("option",{value:"created_at_desc"},"Newest First",-1),(0,a.Lk)("option",{value:"created_at_asc"},"Oldest First",-1),(0,a.Lk)("option",{value:"status"},"By Status",-1),(0,a.Lk)("option",{value:"type"},"By Type",-1)]),544),[[n.u1,te.sortBy]])])])]),te.loading?((0,a.uX)(),(0,a.CE)("div",y,t[18]||(t[18]=[(0,a.Lk)("div",{class:"loading-spinner"},[(0,a.Lk)("i",{class:"fas fa-spinner fa-spin"})],-1),(0,a.Lk)("p",null,"Loading your requests...",-1)]))):te.error?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("div",_,[t[20]||(t[20]=(0,a.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[21]||(t[21]=(0,a.Lk)("h3",null,"Unable to Load Requests",-1)),(0,a.Lk)("p",null,(0,r.v_)(te.error),1),(0,a.Lk)("button",{class:"retry-btn",onClick:t[7]||(t[7]=(...e)=>se.loadRequests&&se.loadRequests(...e))},t[19]||(t[19]=[(0,a.Lk)("i",{class:"fas fa-redo"},null,-1),(0,a.eW)(" Try Again ")]))])])):0!==se.filteredRequests.length||te.loading?((0,a.uX)(),(0,a.CE)("div",P,[(0,a.Lk)("div",w,[(0,a.Lk)("div",v,[t[25]||(t[25]=(0,a.Lk)("label",null,"Show",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>te.itemsPerPage=e),onChange:t[10]||(t[10]=(...e)=>se.handleItemsPerPageChange&&se.handleItemsPerPageChange(...e))},t[24]||(t[24]=[(0,a.Lk)("option",{value:"10"},"10",-1),(0,a.Lk)("option",{value:"25"},"25",-1),(0,a.Lk)("option",{value:"50"},"50",-1)]),544),[[n.u1,te.itemsPerPage]]),t[26]||(t[26]=(0,a.Lk)("span",null,"entries",-1))]),(0,a.Lk)("div",b," Showing "+(0,r.v_)(se.getShowingStart())+" to "+(0,r.v_)(se.getShowingEnd())+" of "+(0,r.v_)(se.filteredRequests.length)+" entries ",1)]),(0,a.Lk)("div",L,[(0,a.Lk)("table",R,[t[31]||(t[31]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",{class:"col-id"},"Request ID"),(0,a.Lk)("th",{class:"col-type"},"Document Type"),(0,a.Lk)("th",{class:"col-purpose"},"Purpose"),(0,a.Lk)("th",{class:"col-status"},"Status"),(0,a.Lk)("th",{class:"col-date"},"Submitted"),(0,a.Lk)("th",{class:"col-amount"},"Amount"),(0,a.Lk)("th",{class:"col-progress"},"Progress"),(0,a.Lk)("th",{class:"col-actions"},"Actions")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(se.paginatedRequests,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.id,class:"request-row",onClick:t=>se.viewRequestDetails(e.id)},[(0,a.Lk)("td",A,[(0,a.Lk)("span",E,"#"+(0,r.v_)(e.id.toString().padStart(6,"0")),1)]),(0,a.Lk)("td",T,[(0,a.Lk)("div",x,[(0,a.Lk)("i",{class:(0,r.C4)(se.getDocumentIcon(e.document_type))},null,2),(0,a.Lk)("span",null,(0,r.v_)(e.document_type),1)])]),(0,a.Lk)("td",F,[(0,a.Lk)("span",null,(0,r.v_)(e.purpose_category||"Not specified"),1)]),(0,a.Lk)("td",N,[(0,a.Lk)("div",S,[(0,a.Lk)("span",{class:(0,r.C4)(["status-badge",se.getStatusClass(e.status)])},(0,r.v_)(se.formatStatus(e.status)),3),"rejected"===e.status&&e.rejection_reason?((0,a.uX)(),(0,a.CE)("div",I,[t[27]||(t[27]=(0,a.Lk)("i",{class:"fas fa-info-circle text-warning"},null,-1)),(0,a.Lk)("small",M,(0,r.v_)(e.rejection_reason),1)])):(0,a.Q3)("",!0)])]),(0,a.Lk)("td",D,[(0,a.Lk)("span",null,(0,r.v_)(se.formatDate(e.created_at)),1)]),(0,a.Lk)("td",O,[(0,a.Lk)("span",$,"₱"+(0,r.v_)(se.formatCurrency(e.total_fee)),1)]),(0,a.Lk)("td",Y,[(0,a.Lk)("div",U,[(0,a.Lk)("div",B,[(0,a.Lk)("div",{class:"progress-fill",style:(0,r.Tr)({width:se.getProgressPercentage(e.status)+"%"})},null,4)]),(0,a.Lk)("div",G,(0,r.v_)(se.getProgressText(e.status)),1)])]),(0,a.Lk)("td",j,[(0,a.Lk)("div",X,[(0,a.Lk)("button",{class:"action-btn view-btn",onClick:(0,n.D$)((t=>se.viewRequestDetails(e.id)),["stop"]),title:"View Details"},t[28]||(t[28]=[(0,a.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,Q),se.canCancelRequest(e.status)?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"action-btn cancel-btn",onClick:(0,n.D$)((t=>se.cancelRequest(e.id)),["stop"]),title:"Cancel Request"},t[29]||(t[29]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]),8,V)):(0,a.Q3)("",!0),se.needsPayment(e)?((0,a.uX)(),(0,a.CE)("button",{key:1,class:"action-btn pay-btn",onClick:(0,n.D$)((t=>se.processPayment(e.id)),["stop"]),title:"Pay Now"},t[30]||(t[30]=[(0,a.Lk)("i",{class:"fas fa-credit-card"},null,-1)]),8,W)):(0,a.Q3)("",!0)])])],8,C)))),128))])])]),se.totalPages>1?((0,a.uX)(),(0,a.CE)("div",z,[(0,a.Lk)("button",{class:"page-btn",disabled:1===te.currentPage,onClick:t[11]||(t[11]=e=>se.changePage(te.currentPage-1))},t[32]||(t[32]=[(0,a.Lk)("i",{class:"fas fa-chevron-left"},null,-1),(0,a.eW)(" Previous ")]),8,H),(0,a.Lk)("div",K,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(se.visiblePages,(e=>((0,a.uX)(),(0,a.CE)("button",{key:e,class:(0,r.C4)(["page-number",{active:e===te.currentPage}]),onClick:t=>se.changePage(e)},(0,r.v_)(e),11,J)))),128))]),(0,a.Lk)("button",{class:"page-btn",disabled:te.currentPage===se.totalPages,onClick:t[12]||(t[12]=e=>se.changePage(te.currentPage+1))},t[33]||(t[33]=[(0,a.eW)(" Next "),(0,a.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]),8,Z)])):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",k,[(0,a.Lk)("div",q,[t[23]||(t[23]=(0,a.Lk)("i",{class:"fas fa-inbox"},null,-1)),(0,a.Lk)("h3",null,(0,r.v_)(te.searchQuery||te.statusFilter||te.typeFilter?"No Matching Requests":"No Requests Yet"),1),(0,a.Lk)("p",null,(0,r.v_)(te.searchQuery||te.statusFilter||te.typeFilter?"Try adjusting your search or filters":"Start by creating your first document request"),1),te.searchQuery||te.statusFilter||te.typeFilter?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,class:"create-first-btn",onClick:t[8]||(t[8]=(...e)=>se.createNewRequest&&se.createNewRequest(...e))},t[22]||(t[22]=[(0,a.Lk)("i",{class:"fas fa-plus"},null,-1),(0,a.eW)(" Create Your First Request ")])))])]))])])}s(4114),s(8111),s(2489),s(116),s(8237);var te=s(1939),se=s(4710),ae=s(2599),ne=s(9197),re={name:"MyRequests",data(){return{requests:[],loading:!0,error:null,searchQuery:"",statusFilter:"",typeFilter:"",sortBy:"created_at_desc",currentPage:1,itemsPerPage:10,searchTimeout:null}},computed:{filteredRequests(){if(!Array.isArray(this.requests))return[];let e=[...this.requests];if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter((e=>e.document_type.toLowerCase().includes(t)||e.purpose_category?.toLowerCase().includes(t)||e.id.toString().includes(t)))}return this.statusFilter&&(e=e.filter((e=>e.status===this.statusFilter))),this.typeFilter&&(e=e.filter((e=>e.document_type===this.typeFilter))),e.sort(((e,t)=>{switch(this.sortBy){case"created_at_desc":return new Date(t.created_at)-new Date(e.created_at);case"created_at_asc":return new Date(e.created_at)-new Date(t.created_at);case"status":return e.status.localeCompare(t.status);case"type":return e.document_type.localeCompare(t.document_type);default:return 0}})),e},paginatedRequests(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredRequests.slice(e,t)},totalPages(){return Math.ceil(this.filteredRequests.length/this.itemsPerPage)},visiblePages(){const e=[],t=Math.max(1,this.currentPage-2),s=Math.min(this.totalPages,this.currentPage+2);for(let a=t;a<=s;a++)e.push(a);return e},totalRequests(){return this.requests.length},pendingCount(){return this.requests.filter((e=>["pending","under_review"].includes(e.status))).length},completedCount(){return this.requests.filter((e=>"completed"===e.status)).length},totalSpent(){return this.requests.filter((e=>"completed"===e.status)).reduce(((e,t)=>e+parseFloat(t.total_fee||0)),0)}},async mounted(){await this.loadRequests(),await this.initializeRealTimeFeatures()},beforeUnmount(){this.cleanupRealTimeFeatures()},methods:{async loadRequests(){try{this.loading=!0,this.error=null;const e=await te.A.getMyRequests();e&&e.data&&e.data.requests&&Array.isArray(e.data.requests)?this.requests=e.data.requests:e&&e.data&&Array.isArray(e.data)?this.requests=e.data:e&&Array.isArray(e)?this.requests=e:(this.requests=[],console.warn("API response does not contain array data:",e))}catch(e){console.error("Error loading requests:",e),this.error=e.response?.data?.message||"Failed to load requests",this.requests=[]}finally{this.loading=!1}},handleSearch(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((()=>{this.currentPage=1}),300)},applyFilters(){this.currentPage=1},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},handleItemsPerPageChange(){this.currentPage=1},getShowingStart(){return 0===this.filteredRequests.length?0:(this.currentPage-1)*this.itemsPerPage+1},getShowingEnd(){const e=this.currentPage*this.itemsPerPage;return Math.min(e,this.filteredRequests.length)},getDocumentIcon(e){const t={"Barangay Clearance":"fas fa-certificate",Cedula:"fas fa-id-card"};return t[e]||"fas fa-file-alt"},getStatusClass(e){const t={pending:"status-pending",under_review:"status-review",additional_info_required:"status-info-required",approved:"status-approved",payment_pending:"status-payment-pending",payment_confirmed:"status-payment-confirmed",payment_failed:"status-payment-failed",processing:"status-processing",ready_for_pickup:"status-ready",pickup_scheduled:"status-pickup-scheduled",completed:"status-completed",rejected:"status-rejected",cancelled:"status-cancelled"};return t[e]||"status-unknown"},formatStatus(e){const t={pending:"Pending",under_review:"Under Review",additional_info_required:"Additional Info Required",approved:"Approved",payment_pending:"Payment Pending",payment_confirmed:"Payment Confirmed",payment_failed:"Payment Failed",processing:"Processing",ready_for_pickup:"Ready for Pickup",pickup_scheduled:"Pickup Scheduled",completed:"Completed",rejected:"Rejected",cancelled:"Cancelled"};return t[e]||e},getProgressPercentage(e){const t={pending:10,under_review:25,additional_info_required:20,approved:40,payment_pending:45,payment_confirmed:50,payment_failed:45,processing:75,ready_for_pickup:90,pickup_scheduled:95,completed:100,rejected:0,cancelled:0};return t[e]||0},getProgressText(e){const t={pending:"Waiting for review",under_review:"Being reviewed",additional_info_required:"Additional information required",approved:"Approved, awaiting payment",payment_pending:"Payment required",payment_confirmed:"Payment confirmed, processing document",payment_failed:"Payment failed, please retry",processing:"Document being prepared",ready_for_pickup:"Ready for pickup",pickup_scheduled:"Pickup scheduled",completed:"Request completed",rejected:"Request rejected",cancelled:"Request cancelled"};return t[e]||"Unknown status"},canCancelRequest(e){const t=["pending","under_review","additional_info_required","approved","payment_pending","payment_failed"];return t.includes(e)},needsPayment(e){const t=["approved","payment_pending","payment_failed"],s=["pending","failed",null,void 0,""],a=t.includes(e.status)&&s.includes(e.payment_status)&&e.payment_method_id&&e.is_online_payment;return a},formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},formatCurrency(e){return parseFloat(e||0).toFixed(2)},viewRequestDetails(e){this.$router.push({name:"RequestDetails",params:{id:e}})},async cancelRequest(e){const t=prompt("Please provide a reason for cancelling this request (optional):","");if(null!==t&&confirm("Are you sure you want to cancel this request?"))try{const s=this.requests.find((t=>t.id===e));console.log("🚫 Cancelling request:",{requestId:e,reason:t,currentStatus:s?.status,currentRequest:s});const a=t.trim()||"Cancelled by user";await te.A.cancelRequest(e,a),this.$toast?.success("Request cancelled successfully. Administrators have been notified."),await this.loadRequests(),console.log("✅ Request cancelled successfully")}catch(s){console.error("❌ Error cancelling request:",s),console.error("❌ Error details:",{status:s.response?.status,statusText:s.response?.statusText,data:s.response?.data,message:s.message}),s.response?.data?.message?this.$toast?.error(s.response.data.message):s.message?.includes("cannot be cancelled")?this.$toast?.error("This request cannot be cancelled at its current stage"):this.$toast?.error("Failed to cancel request. Please try again.")}},async processPayment(e){try{const t=this.requests.find((t=>t.id===e));if(!t)return this.showToast("Error","Request not found","error"),void console.error("Request not found:",e);if(console.log("Processing payment for request:",t),!t.payment_method_id)return this.showToast("Error","No payment method selected for this request. Please contact support.","error"),void console.error("No payment method ID for request:",t);if(!t.is_online_payment)return void this.showToast("Info","This request uses in-person payment. Please pay at the barangay office.","info");this.showToast("Info","Initiating payment...","info");const s=ne["default"].getCurrentUser();console.log("Current user:",s);const a={request_id:e,payment_method_id:t.payment_method_id,customer_email:s?.email||t.email};console.log("Payment data:",a);const n=await ae["default"].initiatePayment(a);if(console.log("Payment response:",n),!(n&&n.success&&n.data&&n.data.checkout_url))throw console.error("Invalid payment response:",n),new Error(n?.message||"Failed to initiate payment - invalid response");this.showToast("Success","Redirecting to payment page...","success"),ae["default"].redirectToPayMongo(n.data.checkout_url)}catch(t){console.error("Payment initiation error:",t),console.error("Error details:",{message:t.message,response:t.response?.data,status:t.response?.status,config:t.config});let e="Failed to initiate payment";t.response?.data?.message?e=t.response.data.message:401===t.response?.status?e="Please log in to make a payment":404===t.response?.status?e="Payment service not found. Please contact support.":t.response?.status>=500?e="Payment service is temporarily unavailable. Please try again later.":t.message&&(e=t.message),this.showToast("Error",e,"error")}},createNewRequest(){this.$router.push({name:"NewDocumentRequest"})},goBack(){this.$router.push({name:"ClientDashboard"})},showToast(e,t,s="info"){console.log(`[${s.toUpperCase()}] ${e}: ${t}`);const a=document.createElement("div");if(a.className=`toast-notification toast-${s}`,a.innerHTML=`\n        <div class="toast-header">\n          <strong>${e}</strong>\n          <button type="button" class="toast-close" onclick="this.parentElement.parentElement.remove()">×</button>\n        </div>\n        <div class="toast-body">${t}</div>\n      `,!document.getElementById("toast-styles")){const e=document.createElement("style");e.id="toast-styles",e.textContent="\n          .toast-notification {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            min-width: 300px;\n            background: white;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            z-index: 9999;\n            animation: slideIn 0.3s ease;\n          }\n          .toast-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px 8px;\n            border-bottom: 1px solid #e9ecef;\n          }\n          .toast-body {\n            padding: 8px 16px 12px;\n            color: #6c757d;\n          }\n          .toast-close {\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            color: #6c757d;\n          }\n          .toast-success { border-left: 4px solid #28a745; }\n          .toast-error { border-left: 4px solid #dc3545; }\n          .toast-info { border-left: 4px solid #17a2b8; }\n          .toast-warning { border-left: 4px solid #ffc107; }\n          @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n          }\n        ",document.head.appendChild(e)}document.body.appendChild(a),setTimeout((()=>{a.parentElement&&(a.style.animation="slideIn 0.3s ease reverse",setTimeout((()=>a.remove()),300))}),5e3)},async initializeRealTimeFeatures(){console.log("Initializing real-time features for MyRequests");try{await se.Ay.init("client"),se.Ay.on("notification",this.handleRealTimeNotification),se.Ay.on("status_change",this.handleStatusChange),se.Ay.on("request_update",this.handleRequestUpdate)}catch(e){console.error("Failed to initialize real-time features:",e)}},cleanupRealTimeFeatures(){console.log("Cleaning up real-time features for MyRequests"),se.Ay.off("notification",this.handleRealTimeNotification),se.Ay.off("status_change",this.handleStatusChange),se.Ay.off("request_update",this.handleRequestUpdate),se.Ay.cleanup()},handleRealTimeNotification(e){switch(console.log("Real-time notification received:",e),e.type){case"status_change":this.handleStatusChange(e);break;case"request_update":this.handleRequestUpdate(e);break;default:console.log("Unhandled notification type:",e.type)}},handleStatusChange(e){console.log("Request status changed:",e);const t=this.requests.findIndex((t=>t.id===e.data?.request_id));-1!==t&&(this.requests[t].status=e.data.new_status,this.showStatusChangeNotification(e),this.loadRequests())},handleRequestUpdate(e){console.log("Request updated:",e),this.loadRequests()},showStatusChangeNotification(e){const{data:t}=e,s={approved:"✅ Your request has been approved!",rejected:"❌ Your request has been rejected.",processing:"⚙️ Your document is being processed.",ready_for_pickup:"📋 Your document is ready for pickup!",completed:"🎉 Your request has been completed!"},a=s[t.new_status]||`Status updated to ${t.new_status}`;"Notification"in window&&"granted"===Notification.permission&&new Notification(`Request ${t.request_number}`,{body:a,icon:"/favicon.ico",tag:`request-${t.request_id}`}),console.log(`🔔 ${a}`)}}},oe=s(1241);const ie=(0,oe.A)(re,[["render",ee],["__scopeId","data-v-01b2089c"]]);var ce=ie}}]);