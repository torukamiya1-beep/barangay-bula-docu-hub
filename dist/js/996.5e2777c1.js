"use strict";(self["webpackChunkbosfdr"]=self["webpackChunkbosfdr"]||[]).push([[996],{1268:function(e,t,i){var a=i(4300);class s{async checkRequestExists(e,t="client"){try{console.log(`üîç Checking if request ${e} exists for ${t}`);const i="admin"===t?`/admin/documents/requests/${e}/exists`:`/client/document-requests/${e}/exists`,s=await a["default"].get(i);return s.data&&s.data.success?(console.log(`‚úÖ Request ${e} exists and is accessible`),!0):(console.log(`‚ùå Request ${e} does not exist or is not accessible`),!1)}catch(i){return console.error("‚ùå Error checking request existence:",i),i.response&&404===i.response.status?!1:(console.log("‚ö†Ô∏è Assuming request exists due to error"),!0)}}async checkUserExists(e){try{console.log(`üîç Checking if user ${e} exists`);const t=await a["default"].get(`/admin/users/${e}/exists`);return t.data&&t.data.success?(console.log(`‚úÖ User ${e} exists and is accessible`),!0):(console.log(`‚ùå User ${e} does not exist or is not accessible`),!1)}catch(t){return console.error("‚ùå Error checking user existence:",t),t.response&&404===t.response.status?!1:(console.log("‚ö†Ô∏è Assuming user exists due to error"),!0)}}parseNotificationData(e){try{let t={};return e.data&&("string"===typeof e.data?t=JSON.parse(e.data):"object"===typeof e.data&&(t=e.data)),{requestId:t.request_id||null,userId:t.user_id||t.client_id||null,userType:t.user_type||null,requestNumber:t.request_number||null,documentType:t.document_type||null,priority:t.priority||null,...t}}catch(t){return console.error("‚ùå Error parsing notification data:",t),{}}}showNavigationError(e,t){console.error("üö® Navigation Error:",e),"function"===typeof t&&t("error",e)}getNotificationIcon(e,t="client"){const i={new_request:"fas fa-file-plus text-success",status_change:"fas fa-sync-alt text-info",request_update:"fas fa-edit text-warning",request_cancelled:"fas fa-times-circle text-danger",payment_confirmed:"fas fa-check-circle text-success",payment_update:"fas fa-money-bill text-info",system_alert:"fas fa-exclamation-triangle text-danger",urgent_request:"fas fa-exclamation-circle text-danger",user_registration:"fas fa-user-plus text-info",new_user:"fas fa-user-check text-success",test:"fas fa-vial text-secondary",connection:"fas fa-plug text-success"},a={status_change:"fas fa-sync-alt text-info",payment_confirmed:"fas fa-credit-card text-success",payment_required:"fas fa-money-bill text-warning",payment_update:"fas fa-money-bill text-info",document_ready:"fas fa-file-check text-success",ready_for_pickup:"fas fa-hand-paper text-success",request_approved:"fas fa-check-circle text-success",request_rejected:"fas fa-times-circle text-danger",request_update:"fas fa-edit text-warning",system_alert:"fas fa-exclamation-triangle text-danger",maintenance_notice:"fas fa-tools text-warning",test:"fas fa-vial text-secondary",connection:"fas fa-plug text-success"},s="admin"===t?i:a;return s[e]||"fas fa-bell text-primary"}formatNotificationTime(e){if(!e)return"";try{const t=new Date(e),i=new Date,a=Math.floor((i-t)/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const s=Math.floor(a/60);if(s<24)return`${s}h ago`;const n=Math.floor(s/24);return n<7?`${n}d ago`:t.toLocaleDateString()}catch(t){return console.error("Error formatting notification time:",t),""}}}t.A=new s},2944:function(e,t,i){i.d(t,{A:function(){return se}});var a=i(6768),s=i(4232),n=i(4230);const o={class:"sidebar-logo"},r={class:"logo-content"},l={class:"logo-image-container"},c={class:"sidebar-nav"},d={class:"nav-list"},u={class:"nav-item"},f=["title"],h={class:"nav-icon-container"},g=["title"],m={key:0,class:"nav-content"},p={class:"nav-badges"},v=["title"],k={key:1,class:"active-indicator"},y={class:"nav-item"},b=["title"],w={class:"nav-icon-container"},C={key:0,class:"collapsed-badge"},L={key:0,class:"nav-content"},q={key:0,class:"nav-badge"},_={key:1,class:"active-indicator"},A={class:"nav-item"},M=["title"],N={key:0,class:"nav-content"},R={key:1,class:"active-indicator"},x={class:"nav-item"},E=["title"],$={key:0,class:"nav-content"},U={key:1,class:"active-indicator"},S={class:"nav-item"},D=["title"],X={class:"nav-icon-container"},P={key:0,class:"collapsed-badge"},Q={key:0,class:"nav-content"},T={key:0,class:"nav-badge"},I={key:1,class:"active-indicator"},O={class:"nav-item"},F=["title"],z={key:0,class:"nav-text"},H={key:1,class:"active-indicator"},W={class:"nav-item"},B=["title"],J={key:0,class:"nav-text"},j={key:1,class:"active-indicator"},K={class:"sidebar-bottom"},G={class:"logout-section"},V=["title"],Y={key:0,class:"logout-content"},Z={key:1,class:"logout-arrow"};function ee(e,t,i,ee,te,ie){return(0,a.uX)(),(0,a.CE)("aside",{class:(0,s.C4)(["dashboard-sidebar",{collapsed:i.collapsed}])},[(0,a.Lk)("div",o,[(0,a.Lk)("div",r,[(0,a.Lk)("div",l,[(0,a.Lk)("img",{src:n,alt:"Barangay Bula Logo",class:"logo-image",onError:t[0]||(t[0]=(...e)=>ie.handleImageError&&ie.handleImageError(...e))},null,32)]),(0,a.Lk)("div",{class:(0,s.C4)(["logo-text",{"mobile-show":ie.isMobile,"desktop-hide":i.collapsed&&!ie.isMobile}])},t[10]||(t[10]=[(0,a.Lk)("h3",{class:"logo-title"},"Admin Panel",-1),(0,a.Lk)("p",{class:"logo-subtitle"},"Bula Document Hub",-1)]),2)]),(0,a.Lk)("button",{class:"mobile-close-btn",onClick:t[1]||(t[1]=(...e)=>ie.handleMobileClose&&ie.handleMobileClose(...e)),"aria-label":"Close sidebar"},t[11]||(t[11]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,a.Lk)("nav",c,[(0,a.Lk)("ul",d,[(0,a.Lk)("li",u,[(0,a.Lk)("a",{href:"#",class:(0,s.C4)(["nav-link",{active:"requests"===ie.currentActiveMenu,"has-urgent":i.urgentRequests>0}]),onClick:t[2]||(t[2]=e=>ie.handleMenuClick("requests",e)),title:i.collapsed&&!ie.isMobile?"Document Requests":""},[(0,a.Lk)("div",h,[t[13]||(t[13]=(0,a.Lk)("i",{class:"fas fa-file-alt nav-icon"},null,-1)),i.collapsed&&!ie.isMobile&&i.pendingRequests>0?((0,a.uX)(),(0,a.CE)("span",{key:0,class:(0,s.C4)(["collapsed-badge",{urgent:i.urgentRequests>0}])},(0,s.v_)(i.pendingRequests>99?"99+":i.pendingRequests),3)):(0,a.Q3)("",!0),i.collapsed&&!ie.isMobile&&i.urgentRequests>0?((0,a.uX)(),(0,a.CE)("span",{key:1,class:"urgent-indicator",title:`${i.urgentRequests} urgent request${i.urgentRequests>1?"s":""}`},t[12]||(t[12]=[(0,a.Lk)("i",{class:"fas fa-exclamation"},null,-1)]),8,g)):(0,a.Q3)("",!0)]),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("div",m,[t[15]||(t[15]=(0,a.Lk)("span",{class:"nav-text"},"Requests",-1)),(0,a.Lk)("div",p,[i.pendingRequests>0?((0,a.uX)(),(0,a.CE)("span",{key:0,class:(0,s.C4)(["nav-badge",{urgent:i.urgentRequests>0}])},(0,s.v_)(i.pendingRequests),3)):(0,a.Q3)("",!0),i.urgentRequests>0?((0,a.uX)(),(0,a.CE)("span",{key:1,class:"nav-badge urgent-badge",title:`${i.urgentRequests} urgent`},[t[14]||(t[14]=(0,a.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,a.eW)(" "+(0,s.v_)(i.urgentRequests),1)],8,v)):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0),i.collapsed&&!ie.isMobile&&"requests"===ie.currentActiveMenu?((0,a.uX)(),(0,a.CE)("div",k)):(0,a.Q3)("",!0)],10,f)]),(0,a.Lk)("li",y,[(0,a.Lk)("a",{href:"#",class:(0,s.C4)(["nav-link",{active:"users"===ie.currentActiveMenu}]),onClick:t[3]||(t[3]=e=>ie.handleMenuClick("users",e)),title:i.collapsed&&!ie.isMobile?"User Management":""},[(0,a.Lk)("div",w,[t[16]||(t[16]=(0,a.Lk)("i",{class:"fas fa-users nav-icon"},null,-1)),i.collapsed&&!ie.isMobile&&i.totalUsers>0?((0,a.uX)(),(0,a.CE)("span",C,(0,s.v_)(i.totalUsers>99?"99+":i.totalUsers),1)):(0,a.Q3)("",!0)]),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("div",L,[t[17]||(t[17]=(0,a.Lk)("span",{class:"nav-text"},"Users",-1)),i.totalUsers>0?((0,a.uX)(),(0,a.CE)("span",q,(0,s.v_)(i.totalUsers),1)):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),i.collapsed&&!ie.isMobile&&"users"===ie.currentActiveMenu?((0,a.uX)(),(0,a.CE)("div",_)):(0,a.Q3)("",!0)],10,b)]),(0,a.Lk)("li",A,[(0,a.Lk)("a",{href:"#",class:(0,s.C4)(["nav-link",{active:"archive"===ie.currentActiveMenu}]),onClick:t[4]||(t[4]=e=>ie.handleMenuClick("archive",e)),title:i.collapsed&&!ie.isMobile?"Archive":""},[t[19]||(t[19]=(0,a.Lk)("div",{class:"nav-icon-container"},[(0,a.Lk)("i",{class:"fas fa-archive nav-icon"})],-1)),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("div",N,t[18]||(t[18]=[(0,a.Lk)("span",{class:"nav-text"},"Archive",-1)]))):(0,a.Q3)("",!0),i.collapsed&&!ie.isMobile&&"archive"===ie.currentActiveMenu?((0,a.uX)(),(0,a.CE)("div",R)):(0,a.Q3)("",!0)],10,M)]),(0,a.Lk)("li",x,[(0,a.Lk)("a",{href:"#",class:(0,s.C4)(["nav-link",{active:"history"===ie.currentActiveMenu}]),onClick:t[5]||(t[5]=e=>ie.handleMenuClick("history",e)),title:i.collapsed&&!ie.isMobile?"Request History":""},[t[21]||(t[21]=(0,a.Lk)("div",{class:"nav-icon-container"},[(0,a.Lk)("i",{class:"fas fa-history nav-icon"})],-1)),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("div",$,t[20]||(t[20]=[(0,a.Lk)("span",{class:"nav-text"},"History",-1)]))):(0,a.Q3)("",!0),i.collapsed&&!ie.isMobile&&"history"===ie.currentActiveMenu?((0,a.uX)(),(0,a.CE)("div",U)):(0,a.Q3)("",!0)],10,E)]),(0,a.Lk)("li",S,[(0,a.Lk)("a",{href:"#",class:(0,s.C4)(["nav-link",{active:"reports"===ie.currentActiveMenu}]),onClick:t[6]||(t[6]=e=>ie.handleMenuClick("reports",e)),title:i.collapsed&&!ie.isMobile?"Reports & Analytics":""},[(0,a.Lk)("div",X,[t[22]||(t[22]=(0,a.Lk)("i",{class:"fas fa-chart-line nav-icon"},null,-1)),i.collapsed&&!ie.isMobile&&i.totalReports>0?((0,a.uX)(),(0,a.CE)("span",P,(0,s.v_)(i.totalReports>99?"99+":i.totalReports),1)):(0,a.Q3)("",!0)]),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("div",Q,[t[23]||(t[23]=(0,a.Lk)("span",{class:"nav-text"},"Reports",-1)),i.totalReports>0?((0,a.uX)(),(0,a.CE)("span",T,(0,s.v_)(i.totalReports),1)):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),i.collapsed&&!ie.isMobile&&"reports"===ie.currentActiveMenu?((0,a.uX)(),(0,a.CE)("div",I)):(0,a.Q3)("",!0)],10,D)]),(0,a.Lk)("li",O,[(0,a.Lk)("a",{href:"#",class:(0,s.C4)(["nav-link",{active:"settings"===ie.currentActiveMenu}]),onClick:t[7]||(t[7]=e=>ie.handleMenuClick("settings",e)),title:i.collapsed&&!ie.isMobile?"System Settings":""},[t[24]||(t[24]=(0,a.Lk)("div",{class:"nav-icon-container"},[(0,a.Lk)("i",{class:"fas fa-cog nav-icon"})],-1)),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("span",z,"Settings")):(0,a.Q3)("",!0),i.collapsed&&!ie.isMobile&&"settings"===ie.currentActiveMenu?((0,a.uX)(),(0,a.CE)("div",H)):(0,a.Q3)("",!0)],10,F)]),(0,a.Lk)("li",W,[(0,a.Lk)("a",{href:"#",class:(0,s.C4)(["nav-link",{active:"activity"===ie.currentActiveMenu||"audit"===ie.currentActiveMenu}]),onClick:t[8]||(t[8]=e=>ie.handleMenuClick("activity",e)),title:i.collapsed&&!ie.isMobile?"Activity Logs":""},[t[25]||(t[25]=(0,a.Lk)("div",{class:"nav-icon-container"},[(0,a.Lk)("i",{class:"fas fa-history nav-icon"})],-1)),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("span",J,"Activity Logs")):(0,a.Q3)("",!0),!i.collapsed||ie.isMobile||"activity"!==ie.currentActiveMenu&&"audit"!==ie.currentActiveMenu?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",j))],10,B)])])]),(0,a.Lk)("div",K,[(0,a.Lk)("div",G,[(0,a.Lk)("button",{class:(0,s.C4)(["logout-btn",{collapsed:i.collapsed&&!ie.isMobile}]),onClick:t[9]||(t[9]=e=>ie.handleLogout(e)),title:i.collapsed&&!ie.isMobile?"Logout":""},[t[28]||(t[28]=(0,a.Lk)("div",{class:"logout-icon-container"},[(0,a.Lk)("i",{class:"fas fa-sign-out-alt logout-icon"}),(0,a.Lk)("div",{class:"logout-ripple"})],-1)),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("div",Y,t[26]||(t[26]=[(0,a.Lk)("span",{class:"logout-text"},"Logout",-1)]))):(0,a.Q3)("",!0),!i.collapsed||ie.isMobile?((0,a.uX)(),(0,a.CE)("div",Z,t[27]||(t[27]=[(0,a.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]))):(0,a.Q3)("",!0)],10,V)])])],2)}i(4114);var te={name:"AdminSidebar",props:{collapsed:{type:Boolean,default:!1},activeMenu:{type:String,default:"dashboard"},totalUsers:{type:Number,default:0},pendingRequests:{type:Number,default:0},totalReports:{type:Number,default:0},urgentRequests:{type:Number,default:0},processingRequests:{type:Number,default:0},pendingResidencyCount:{type:Number,default:0}},emits:["menu-change","logout","toggle-sidebar"],data(){return{isMobileState:!1}},computed:{isMobile(){return this.isMobileState},currentActiveMenu(){const e=this.$route.path,t={"/admin/dashboard":"dashboard","/admin/users":"users","/admin/requests":"requests","/admin/history":"history","/admin/reports":"reports","/admin/settings":"settings","/admin/activity-logs":"activity","/admin/audit-logs":"audit","/admin/profile":"profile"};return t[e]||this.activeMenu||"dashboard"}},mounted(){this.updateMobileState(),this.handleResize=()=>{this.updateMobileState()},window.addEventListener("resize",this.handleResize)},beforeUnmount(){this.handleResize&&window.removeEventListener("resize",this.handleResize)},methods:{updateMobileState(){this.isMobileState=window.innerWidth<=768},handleImageError(e){console.log("Logo image failed to load, using fallback"),e.target.style.display="none"},handleMenuClick(e,t){t&&t.preventDefault();const i={dashboard:"/admin/dashboard",users:"/admin/users",archive:"/admin/users/archive",requests:"/admin/requests",history:"/admin/history",reports:"/admin/reports",settings:"/admin/settings",activity:"/admin/activity-logs",audit:"/admin/audit-logs",profile:"/admin/profile"},a=i[e];a&&this.$route.path!==a&&this.$router.push(a).catch((e=>{"NavigationDuplicated"!==e.name&&console.error("Navigation error:",e)})),this.$emit("menu-action",e)},handleLogout(e){e&&e.preventDefault(),this.$emit("logout")},handleMobileClose(){this.$emit("toggle-sidebar")}},watch:{collapsed:{handler(e){e?document.body.classList.add("sidebar-collapsed"):document.body.classList.remove("sidebar-collapsed")},immediate:!0}}},ie=i(1241);const ae=(0,ie.A)(te,[["render",ee],["__scopeId","data-v-5814a075"]]);var se=ae},3237:function(e,t,i){i.d(t,{A:function(){return F}});var a=i(6768),s=i(4232);const n={class:"header-content"},o={class:"header-left"},r={class:"page-title"},l={class:"header-actions"},c={class:"user-info"},d={class:"user-name"},u={class:"user-role"},f={key:0,class:"dropdown-menu"};function h(e,t,i,h,g,m){const p=(0,a.g2)("AdminNotifications");return(0,a.uX)(),(0,a.CE)("header",{class:(0,s.C4)(["dashboard-header",{"sidebar-collapsed":i.sidebarCollapsed}])},[(0,a.Lk)("div",n,[(0,a.Lk)("div",o,[(0,a.Lk)("button",{class:"sidebar-toggle",onClick:t[0]||(t[0]=(...e)=>m.handleSidebarToggle&&m.handleSidebarToggle(...e))},t[6]||(t[6]=[(0,a.Lk)("i",{class:"fas fa-bars"},null,-1)])),(0,a.Lk)("div",r,[(0,a.Lk)("h1",null,(0,s.v_)(m.getPageTitle()),1)])]),(0,a.Lk)("div",l,[(0,a.bF)(p,{onNewNotification:m.handleNewNotification,onNotificationClick:m.handleNotificationClick,onOpenRequestModal:m.handleOpenRequestModal,onOpenUserModal:m.handleOpenUserModal,onError:m.handleNotificationError},null,8,["onNewNotification","onNotificationClick","onOpenRequestModal","onOpenUserModal","onError"]),(0,a.Lk)("div",{class:(0,s.C4)(["user-dropdown",{active:i.showUserDropdown}])},[(0,a.Lk)("button",{class:"user-btn",onClick:t[1]||(t[1]=(...e)=>m.handleUserDropdownToggle&&m.handleUserDropdownToggle(...e))},[t[7]||(t[7]=(0,a.Lk)("div",{class:"user-avatar"},[(0,a.Lk)("i",{class:"fas fa-user-circle"})],-1)),(0,a.Lk)("div",c,[(0,a.Lk)("span",d,(0,s.v_)(m.displayUserName),1),(0,a.Lk)("span",u,(0,s.v_)(m.displayUserRole),1)])]),i.showUserDropdown?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("a",{href:"#",class:"dropdown-item",onClick:t[2]||(t[2]=e=>m.handleMenuAction("profile",e))},t[8]||(t[8]=[(0,a.Lk)("i",{class:"fas fa-user me-2"},null,-1),(0,a.eW)(" My Profile ")])),(0,a.Lk)("a",{href:"#",class:"dropdown-item",onClick:t[3]||(t[3]=e=>m.handleMenuAction("settings",e))},t[9]||(t[9]=[(0,a.Lk)("i",{class:"fas fa-cog me-2"},null,-1),(0,a.eW)(" Settings ")])),(0,a.Lk)("a",{href:"#",class:"dropdown-item",onClick:t[4]||(t[4]=e=>m.handleMenuAction("account",e))},t[10]||(t[10]=[(0,a.Lk)("i",{class:"fas fa-id-card me-2"},null,-1),(0,a.eW)(" Account Info ")])),t[12]||(t[12]=(0,a.Lk)("div",{class:"dropdown-divider"},null,-1)),(0,a.Lk)("a",{href:"#",class:"dropdown-item",onClick:t[5]||(t[5]=e=>m.handleLogout(e))},t[11]||(t[11]=[(0,a.Lk)("i",{class:"fas fa-sign-out-alt me-2"},null,-1),(0,a.eW)(" Logout ")]))])):(0,a.Q3)("",!0)],2)])])],2)}i(4114);var g=i(5130);const m={class:"admin-notifications"},p={key:0,class:"notification-badge"},v={class:"notification-header"},k={class:"notification-actions"},y=["disabled"],b={class:"notification-body"},w={key:0,class:"text-center p-3"},C={key:1,class:"text-center p-4 text-muted"},L={key:2,class:"notification-list"},q=["data-notification-id","onClick"],_={class:"notification-icon"},A={class:"notification-content"},M={class:"notification-title"},N={class:"notification-message"},R={class:"notification-time"},x={key:0,class:"notification-priority"},E={key:3,class:"notification-footer"},$=["disabled"];function U(e,t,i,n,o,r){return(0,a.uX)(),(0,a.CE)("div",m,[(0,a.Lk)("div",{class:"notification-bell",onClick:t[0]||(t[0]=(...e)=>r.toggleNotificationPanel&&r.toggleNotificationPanel(...e))},[t[6]||(t[6]=(0,a.Lk)("i",{class:"fas fa-bell"},null,-1)),o.unreadCount>0?((0,a.uX)(),(0,a.CE)("span",p,(0,s.v_)(o.unreadCount>99?"99+":o.unreadCount),1)):(0,a.Q3)("",!0)]),o.showPanel?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"notification-panel",onClick:t[4]||(t[4]=(0,g.D$)((()=>{}),["stop"]))},[(0,a.Lk)("div",v,[t[9]||(t[9]=(0,a.Lk)("h5",null,"Notifications",-1)),(0,a.Lk)("div",k,[o.unreadCount>0?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[1]||(t[1]=(...e)=>r.markAllAsRead&&r.markAllAsRead(...e)),class:"btn btn-sm btn-outline-primary",disabled:o.markingAllRead},[t[7]||(t[7]=(0,a.Lk)("i",{class:"fas fa-check-double"},null,-1)),(0,a.eW)(" "+(0,s.v_)(o.markingAllRead?"Marking...":"Mark All Read"),1)],8,y)):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.toggleNotificationPanel&&r.toggleNotificationPanel(...e)),class:"btn btn-sm btn-outline-secondary"},t[8]||(t[8]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))])]),(0,a.Lk)("div",b,[o.loading?((0,a.uX)(),(0,a.CE)("div",w,t[10]||(t[10]=[(0,a.Lk)("div",{class:"spinner-border spinner-border-sm",role:"status"},[(0,a.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,a.Lk)("p",{class:"mt-2 mb-0"},"Loading notifications...",-1)]))):0===o.notifications.length?((0,a.uX)(),(0,a.CE)("div",C,t[11]||(t[11]=[(0,a.Lk)("i",{class:"fas fa-bell-slash fa-2x mb-2"},null,-1),(0,a.Lk)("p",{class:"mb-0"},"No notifications",-1)]))):((0,a.uX)(),(0,a.CE)("div",L,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.notifications,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,"data-notification-id":e.id,class:(0,s.C4)(["notification-item",{unread:!e.is_read,"priority-high":"high"===e.priority||"urgent"===e.priority,clickable:!0}]),onClick:t=>r.handleNotificationClick(e)},[(0,a.Lk)("div",_,[(0,a.Lk)("i",{class:(0,s.C4)(r.getNotificationIcon(e.type))},null,2)]),(0,a.Lk)("div",A,[(0,a.Lk)("div",M,(0,s.v_)(e.title),1),(0,a.Lk)("div",N,(0,s.v_)(e.message),1),(0,a.Lk)("div",R,(0,s.v_)(r.formatTime(e.created_at)),1)]),"high"===e.priority||"urgent"===e.priority?((0,a.uX)(),(0,a.CE)("div",x,t[12]||(t[12]=[(0,a.Lk)("i",{class:"fas fa-exclamation-triangle text-warning"},null,-1)]))):(0,a.Q3)("",!0)],10,q)))),128))])),o.hasMore?((0,a.uX)(),(0,a.CE)("div",E,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.loadMore&&r.loadMore(...e)),class:"btn btn-sm btn-outline-primary w-100",disabled:o.loadingMore},[t[13]||(t[13]=(0,a.Lk)("i",{class:"fas fa-chevron-down"},null,-1)),(0,a.eW)(" "+(0,s.v_)(o.loadingMore?"Loading...":"Load More"),1)],8,$)])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0),o.showPanel?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"notification-overlay",onClick:t[5]||(t[5]=(...e)=>r.toggleNotificationPanel&&r.toggleNotificationPanel(...e))})):(0,a.Q3)("",!0)])}i(8111),i(7588);var S=i(4710),D=i(1268),X={name:"AdminNotifications",data(){return{showPanel:!1,notifications:[],unreadCount:0,loading:!1,loadingMore:!1,markingAllRead:!1,currentPage:1,hasMore:!0,limit:10,notificationService:null}},mounted(){this.initializeNotifications()},beforeUnmount(){this.cleanup()},methods:{async initializeNotifications(){try{console.log("üöÄ AdminNotifications: Initializing admin notification service"),this.notificationService=(0,S.ei)(),await this.notificationService.requestNotificationPermission(),await this.notificationService.init(),this.notificationService.on("notification",this.handleNewNotification),this.notificationService.on("connected",this.onConnected),this.notificationService.on("error",this.onError),await this.loadUnreadCount(),console.log("‚úÖ AdminNotifications: Admin notification service initialized successfully")}catch(e){console.error("‚ùå AdminNotifications: Failed to initialize notifications:",e),this.error=e.message||"Failed to initialize notifications"}},cleanup(){this.notificationService&&(this.notificationService.off("notification",this.handleNewNotification),this.notificationService.off("connected",this.onConnected),this.notificationService.off("error",this.onError))},async toggleNotificationPanel(){this.showPanel=!this.showPanel,this.showPanel&&0===this.notifications.length&&await this.loadNotifications()},async loadNotifications(e=1){try{1===e?(this.loading=!0,this.notifications=[],this.currentPage=1):this.loadingMore=!0,console.log("üîç AdminNotifications: Loading notifications, page:",e,"limit:",this.limit);const t=await this.notificationService.getNotifications(e,this.limit);console.log("üì® AdminNotifications: Raw API response:",t);let i=[],a={};t.data&&t.data.notifications?Array.isArray(t.data.notifications)?(i=t.data.notifications,a=t.data.pagination||{},console.log("‚úÖ AdminNotifications: Parsed notifications:",i.length,"items"),console.log("üìä AdminNotifications: Pagination:",a)):(console.warn("‚ö†Ô∏è AdminNotifications: Invalid response structure - notifications is not an array"),console.log("üìä AdminNotifications: response.data.notifications:",t.data.notifications)):(console.warn("‚ö†Ô∏è AdminNotifications: Invalid response structure - no data.notifications found"),console.log("üìä AdminNotifications: response.data:",t.data)),1===e?this.notifications=i:this.notifications.push(...i),this.hasMore=a.page<a.pages,this.currentPage=e,console.log("üìã AdminNotifications: Final notifications array:",this.notifications),console.log("üìÑ AdminNotifications: Has more pages:",this.hasMore)}catch(t){console.error("‚ùå AdminNotifications: Failed to load notifications:",t),this.$emit("error","Failed to load notifications")}finally{this.loading=!1,this.loadingMore=!1}},async loadMore(){this.hasMore&&!this.loadingMore&&await this.loadNotifications(this.currentPage+1)},async loadUnreadCount(){try{this.unreadCount=await this.notificationService.getUnreadCount()}catch(e){console.error("Failed to load unread count:",e)}},async markAllAsRead(){try{this.markingAllRead=!0,await this.notificationService.markAllAsRead(),this.notifications.forEach((e=>{e.is_read=!0})),this.unreadCount=0,this.$emit("notifications-read")}catch(e){console.error("Failed to mark all as read:",e),this.$emit("error","Failed to mark notifications as read")}finally{this.markingAllRead=!1}},async handleNotificationClick(e){console.log("üîî Admin notification clicked:",e),this.showLoadingState(e);try{e.is_read||(await this.notificationService.markAsRead(e.id),e.is_read=!0,this.unreadCount=Math.max(0,this.unreadCount-1),this.$emit("notification-read",e)),await this.navigateToRelevantPage(e),this.showPanel=!1}catch(t){console.error("‚ùå Failed to handle notification click:",t),this.showErrorToast("Failed to process notification")}finally{this.hideLoadingState(e)}this.$emit("notification-click",e)},async navigateToRelevantPage(e){console.log("üß≠ Determining navigation for notification:",e.type,e.data);try{const t="string"===typeof e.data?JSON.parse(e.data):e.data||{};let i=null;switch(e.type){case"new_request":i=await this.handleNewRequestNavigation(t);break;case"status_change":case"request_update":i=await this.handleRequestUpdateNavigation(t);break;case"request_cancelled":i=await this.handleRequestCancellationNavigation(t);break;case"payment_confirmed":i=await this.handlePaymentConfirmationNavigation(t);break;case"payment_update":i=await this.handlePaymentNavigation(t);break;case"system_alert":case"urgent_request":i=await this.handleSystemAlertNavigation(t);break;case"user_registration":case"new_user":case"new_client_registration":i=await this.handleUserNavigation(t);break;default:console.log("ü§∑ Unknown notification type, using default navigation"),i=await this.handleDefaultNavigation(t)}if(i){console.log("üöÄ Navigating to:",i);const e=this.$router.push(i),t=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Navigation timeout"))),5e3)}));await Promise.race([e,t])}else console.log("‚ÑπÔ∏è No navigation target determined for notification")}catch(t){throw console.error("‚ùå Navigation error:",t),new Error("Failed to navigate to notification target")}},async handleNewRequestNavigation(e){if(e.request_id){const t=await this.checkRequestExists(e.request_id);return t?await this.openRequestDetailsModal(e.request_id):(this.showErrorToast("Request no longer exists"),{name:"AdminRequests"})}return{name:"AdminRequests"}},async handleRequestUpdateNavigation(e){if(e.request_id){const t=await this.checkRequestExists(e.request_id);return t?await this.openRequestDetailsModal(e.request_id):(this.showErrorToast("Request no longer exists"),{name:"AdminRequests"})}return{name:"AdminRequests"}},async handleRequestCancellationNavigation(e){if(e.request_id){const t=await this.checkRequestExists(e.request_id);return t?await this.openRequestDetailsModal(e.request_id,"status"):(this.showErrorToast("Request no longer exists"),{name:"AdminRequests"})}return{name:"AdminRequests",query:{filter:"cancelled"}}},async handlePaymentConfirmationNavigation(e){if(e.request_id){const t=await this.checkRequestExists(e.request_id);return t?await this.openRequestDetailsModal(e.request_id,"payment"):(this.showErrorToast("Request no longer exists"),{name:"AdminRequests"})}return{name:"AdminRequests",query:{filter:"payment_confirmed"}}},async handlePaymentNavigation(e){if(e.request_id){const t=await this.checkRequestExists(e.request_id);if(t)return await this.openRequestDetailsModal(e.request_id,"payment")}return{name:"AdminReports",query:{section:"revenue"}}},async handleSystemAlertNavigation(e){return e.request_id?{name:"AdminRequests",query:{highlight:e.request_id,filter:"urgent"}}:{name:"AdminDashboard"}},async handleUserNavigation(e){if(e.user_id||e.client_id){const t=e.user_id||e.client_id,i=await this.checkUserExists(t);return i?await this.openUserDetailsModal(t,e.user_type||"client"):(this.showErrorToast("User no longer exists"),{name:"AdminUsers"})}return{name:"AdminUsers"}},async handleDefaultNavigation(e){if(e.request_id){const t=await this.checkRequestExists(e.request_id);if(t)return await this.openRequestDetailsModal(e.request_id)}if(e.user_id||e.client_id){const t=e.user_id||e.client_id,i=await this.checkUserExists(t);return i?{name:"AdminUsers",query:{highlight:t,type:e.user_type||"client"}}:(this.showErrorToast("User no longer exists"),{name:"AdminUsers"})}return{name:"AdminDashboard"}},async checkRequestExists(e){return await D.A.checkRequestExists(e,"admin")},async checkUserExists(e){return await D.A.checkUserExists(e)},showLoadingState(e){const t=document.querySelector(`[data-notification-id="${e.id}"]`);t&&t.classList.add("loading")},hideLoadingState(e){const t=document.querySelector(`[data-notification-id="${e.id}"]`);t&&t.classList.remove("loading")},showErrorToast(e){D.A.showNavigationError(e,this.$emit.bind(this))},async openRequestDetailsModal(e,t=null){try{return console.log("üîî Opening request details modal for ID:",e,"Focus tab:",t),this.$emit("open-request-modal",{requestId:e,focusTab:t}),null}catch(i){return console.error("‚ùå Error opening request modal:",i),{name:"AdminRequests",query:{highlight:e,tab:t}}}},async openUserDetailsModal(e,t="client"){try{return console.log("üîî Opening user details modal for ID:",e,"Type:",t),this.$emit("open-user-modal",{userId:e,userType:t}),null}catch(i){return console.error("‚ùå Error opening user modal:",i),{name:"AdminUsers",query:{highlight:e,type:t}}}},handleNewNotification(e,t=null){if(t&&t.userType&&"admin"!==t.userType)console.log("üö´ AdminNotifications: Ignoring non-admin notification:",t.userType);else if(e.recipient_type&&"admin"!==e.recipient_type)console.log("üö´ AdminNotifications: Ignoring notification for:",e.recipient_type);else if(console.log("üì¢ AdminNotifications: Processing admin notification:",e),"unread_count_update"!==e.type)if("notification_read"!==e.type){if("all_notifications_read"===e.type)return this.notifications.forEach((e=>e.is_read=!0)),void(this.unreadCount=0);this.showPanel&&this.notifications.unshift(e),e.is_read||this.unreadCount++,this.$emit("new-notification",e)}else{const t=this.notifications.findIndex((t=>t.id===e.notification_id));-1!==t&&(this.notifications[t].is_read=!0,this.unreadCount=Math.max(0,this.unreadCount-1))}else this.unreadCount=e.count||0},onConnected(){console.log("Connected to notification stream"),this.$emit("connected")},onError(e){console.error("Notification stream error:",e),this.$emit("error","Connection to notification stream failed")},getNotificationIcon(e){const t={status_change:"fas fa-sync-alt text-info",new_request:"fas fa-file-alt text-success",request_update:"fas fa-edit text-warning",system_alert:"fas fa-exclamation-triangle text-danger",user_registration:"fas fa-user-plus text-info",new_user:"fas fa-user-check text-success",new_client_registration:"fas fa-user-plus text-info",test:"fas fa-vial text-secondary",connection:"fas fa-plug text-success"};return t[e]||"fas fa-bell text-primary"},formatTime(e){const t=new Date(e),i=new Date,a=Math.floor((i-t)/6e4);return a<1?"Just now":a<60?`${a}m ago`:a<1440?`${Math.floor(a/60)}h ago`:t.toLocaleDateString()}}},P=i(1241);const Q=(0,P.A)(X,[["render",U],["__scopeId","data-v-c280c9c2"]]);var T=Q,I={name:"AdminHeader",components:{AdminNotifications:T},props:{userName:{type:String,default:"Admin"},showUserDropdown:{type:Boolean,default:!1},sidebarCollapsed:{type:Boolean,default:!1},activeMenu:{type:String,default:"dashboard"}},emits:["sidebar-toggle","user-dropdown-toggle","menu-action","logout","error","new-notification"],computed:{displayUserName(){const e=this.$adminAuth?.getAdminData();return e?e.profile&&e.profile.first_name?e.profile.last_name?`${e.profile.first_name} ${e.profile.last_name}`:e.profile.first_name:e.username||this.userName:this.userName||"Admin"},displayUserRole(){const e=this.$adminAuth?.getAdminData();return e&&e.role?e.role.charAt(0).toUpperCase()+e.role.slice(1):"Admin"}},mounted(){document.addEventListener("click",this.handleOutsideClick)},beforeUnmount(){document.removeEventListener("click",this.handleOutsideClick)},methods:{getPageTitle(){const e=this.$route.path,t={"/admin/dashboard":"Admin Dashboard","/admin/users":"User Management","/admin/requests":"Document Requests","/admin/reports":"Reports & Analytics","/admin/settings":"System Settings","/admin/activity-logs":"Activity Logs","/admin/audit-logs":"Audit Logs","/admin/profile":"Admin Profile"};return t[e]||this.$route.meta?.title||"Admin Dashboard"},handleSidebarToggle(){this.$emit("sidebar-toggle")},handleUserDropdownToggle(){this.$emit("user-dropdown-toggle")},handleMenuAction(e,t){t&&t.preventDefault();const i={profile:"/admin/profile",settings:"/admin/settings",account:"/admin/profile"},a=i[e];a&&this.$route.path!==a&&this.$router.push(a).catch((e=>{"NavigationDuplicated"!==e.name&&console.error("Navigation error:",e)})),this.showUserDropdown&&this.$emit("user-dropdown-toggle"),this.$emit("menu-action",e)},handleLogout(e){e&&e.preventDefault(),this.$emit("logout")},handleOutsideClick(e){e.target.closest(".user-dropdown")||this.showUserDropdown&&this.$emit("user-dropdown-toggle")},handleNewNotification(e){console.log("New notification received:",e),this.$emit("new-notification",e)},async handleNotificationClick(e){console.log("üîî AdminHeader: Notification clicked:",e);try{const t="string"===typeof e.data?JSON.parse(e.data):e.data||{};console.log("üìä AdminHeader: Notification data:",t)}catch(t){console.error("‚ùå AdminHeader: Error handling notification click:",t)}this.$emit("notification-click",e)},handleOpenRequestModal(e){console.log("üîî AdminHeader: Request to open modal:",e),this.$emit("open-request-modal",e)},handleOpenUserModal(e){console.log("üîî AdminHeader: Request to open user modal:",e),this.$emit("open-user-modal",e)},handleNotificationError(e){console.error("Notification error:",e),this.$emit("error",e)}}};const O=(0,P.A)(I,[["render",h],["__scopeId","data-v-65f8e09e"]]);var F=O},4230:function(e,t,i){e.exports=i.p+"img/icon-of-bula.fe10b6ab.jpg"}}]);