{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"client-notifications\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"notification-badge\"\n};\nconst _hoisted_3 = {\n  class: \"notification-header\"\n};\nconst _hoisted_4 = {\n  class: \"notification-actions\"\n};\nconst _hoisted_5 = [\"disabled\"];\nconst _hoisted_6 = {\n  class: \"notification-content\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"notification-loading\"\n};\nconst _hoisted_8 = {\n  key: 1,\n  class: \"notification-error\"\n};\nconst _hoisted_9 = {\n  key: 2,\n  class: \"no-notifications\"\n};\nconst _hoisted_10 = {\n  key: 3,\n  class: \"notification-list\"\n};\nconst _hoisted_11 = [\"data-notification-id\", \"onClick\"];\nconst _hoisted_12 = {\n  class: \"notification-icon\"\n};\nconst _hoisted_13 = {\n  class: \"notification-content\"\n};\nconst _hoisted_14 = {\n  class: \"notification-title\"\n};\nconst _hoisted_15 = {\n  class: \"notification-message\"\n};\nconst _hoisted_16 = {\n  class: \"notification-time\"\n};\nconst _hoisted_17 = {\n  key: 0,\n  class: \"unread-indicator\"\n};\nconst _hoisted_18 = {\n  key: 0,\n  class: \"load-more-container\"\n};\nconst _hoisted_19 = [\"disabled\"];\nconst _hoisted_20 = {\n  key: 0,\n  class: \"fas fa-spinner fa-spin\"\n};\nconst _hoisted_21 = {\n  key: 1,\n  class: \"fas fa-chevron-down\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" Notification Bell Icon \"), _createElementVNode(\"div\", {\n    class: \"notification-bell\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.toggleNotificationPanel && $options.toggleNotificationPanel(...args))\n  }, [_cache[6] || (_cache[6] = _createElementVNode(\"i\", {\n    class: \"fas fa-bell\"\n  }, null, -1 /* HOISTED */)), $data.unreadCount > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_2, _toDisplayString($data.unreadCount > 99 ? '99+' : $data.unreadCount), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createCommentVNode(\" Notification Panel \"), $data.showPanel ? (_openBlock(), _createElementBlock(\"div\", {\n    key: 0,\n    class: \"notification-panel\",\n    onClick: _cache[5] || (_cache[5] = _withModifiers(() => {}, [\"stop\"]))\n  }, [_createElementVNode(\"div\", _hoisted_3, [_cache[9] || (_cache[9] = _createElementVNode(\"h5\", null, \"Notifications\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_4, [$data.unreadCount > 0 ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.markAllAsRead && $options.markAllAsRead(...args)),\n    class: \"btn btn-sm btn-outline-primary\",\n    disabled: $data.markingAllRead\n  }, [_cache[7] || (_cache[7] = _createElementVNode(\"i\", {\n    class: \"fas fa-check-double\"\n  }, null, -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($data.markingAllRead ? 'Marking...' : 'Mark All Read'), 1 /* TEXT */)], 8 /* PROPS */, _hoisted_5)) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.toggleNotificationPanel && $options.toggleNotificationPanel(...args)),\n    class: \"btn btn-sm btn-outline-secondary\"\n  }, _cache[8] || (_cache[8] = [_createElementVNode(\"i\", {\n    class: \"fas fa-times\"\n  }, null, -1 /* HOISTED */)]))])]), _createElementVNode(\"div\", _hoisted_6, [$data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, _cache[10] || (_cache[10] = [_createElementVNode(\"div\", {\n    class: \"spinner-border spinner-border-sm\",\n    role: \"status\"\n  }, [_createElementVNode(\"span\", {\n    class: \"visually-hidden\"\n  }, \"Loading...\")], -1 /* HOISTED */), _createElementVNode(\"span\", {\n    class: \"ms-2\"\n  }, \"Loading notifications...\", -1 /* HOISTED */)]))) : $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [_cache[12] || (_cache[12] = _createElementVNode(\"i\", {\n    class: \"fas fa-exclamation-triangle\"\n  }, null, -1 /* HOISTED */)), _createElementVNode(\"span\", null, _toDisplayString($data.error), 1 /* TEXT */), _createElementVNode(\"button\", {\n    onClick: _cache[3] || (_cache[3] = $event => $options.loadNotifications(1)),\n    class: \"btn btn-sm btn-outline-primary ms-2\"\n  }, _cache[11] || (_cache[11] = [_createElementVNode(\"i\", {\n    class: \"fas fa-redo\"\n  }, null, -1 /* HOISTED */), _createTextVNode(\" Retry \")]))])) : $data.notifications.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, _cache[13] || (_cache[13] = [_createElementVNode(\"i\", {\n    class: \"fas fa-bell-slash\"\n  }, null, -1 /* HOISTED */), _createElementVNode(\"p\", null, \"No notifications yet\", -1 /* HOISTED */)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.notifications, notification => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: notification.id,\n      \"data-notification-id\": notification.id,\n      class: _normalizeClass([\"notification-item\", {\n        'unread': !notification.is_read,\n        'priority-high': notification.priority === 'high' || notification.priority === 'urgent',\n        'clickable': true\n      }]),\n      onClick: $event => $options.handleNotificationClick(notification)\n    }, [_createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"i\", {\n      class: _normalizeClass($options.getNotificationIcon(notification.type))\n    }, null, 2 /* CLASS */)]), _createElementVNode(\"div\", _hoisted_13, [_createElementVNode(\"div\", _hoisted_14, _toDisplayString(notification.title), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_15, _toDisplayString(notification.message), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_16, _toDisplayString($options.formatTime(notification.created_at)), 1 /* TEXT */)]), !notification.is_read ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17)) : _createCommentVNode(\"v-if\", true)], 10 /* CLASS, PROPS */, _hoisted_11);\n  }), 128 /* KEYED_FRAGMENT */)), _createCommentVNode(\" Load More Button \"), $data.hasMore ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, [_createElementVNode(\"button\", {\n    onClick: _cache[4] || (_cache[4] = (...args) => $options.loadMore && $options.loadMore(...args)),\n    class: \"btn btn-sm btn-outline-primary\",\n    disabled: $data.loadingMore\n  }, [$data.loadingMore ? (_openBlock(), _createElementBlock(\"i\", _hoisted_20)) : (_openBlock(), _createElementBlock(\"i\", _hoisted_21)), _createTextVNode(\" \" + _toDisplayString($data.loadingMore ? 'Loading...' : 'Load More'), 1 /* TEXT */)], 8 /* PROPS */, _hoisted_19)])) : _createCommentVNode(\"v-if\", true)]))])])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createElementVNode","onClick","_cache","args","$options","toggleNotificationPanel","$data","unreadCount","_hoisted_2","_toDisplayString","showPanel","_withModifiers","_hoisted_3","_hoisted_4","markAllAsRead","disabled","markingAllRead","_hoisted_6","loading","_hoisted_7","role","error","_hoisted_8","$event","loadNotifications","notifications","length","_hoisted_9","_hoisted_10","_Fragment","_renderList","notification","key","id","_normalizeClass","is_read","priority","handleNotificationClick","_hoisted_12","getNotificationIcon","type","_hoisted_13","_hoisted_14","title","_hoisted_15","message","_hoisted_16","formatTime","created_at","_hoisted_17","hasMore","_hoisted_18","loadMore","loadingMore","_hoisted_20","_hoisted_21"],"sources":["D:\\brgy_docu_hub\\BOSFDR\\src\\components\\client\\ClientNotifications.vue"],"sourcesContent":["<template>\n  <div class=\"client-notifications\">\n    <!-- Notification Bell Icon -->\n    <div class=\"notification-bell\" @click=\"toggleNotificationPanel\">\n      <i class=\"fas fa-bell\"></i>\n      <span v-if=\"unreadCount > 0\" class=\"notification-badge\">{{ unreadCount > 99 ? '99+' : unreadCount }}</span>\n    </div>\n\n    <!-- Notification Panel -->\n    <div v-if=\"showPanel\" class=\"notification-panel\" @click.stop>\n      <div class=\"notification-header\">\n        <h5>Notifications</h5>\n        <div class=\"notification-actions\">\n          <button \n            v-if=\"unreadCount > 0\" \n            @click=\"markAllAsRead\" \n            class=\"btn btn-sm btn-outline-primary\"\n            :disabled=\"markingAllRead\"\n          >\n            <i class=\"fas fa-check-double\"></i>\n            {{ markingAllRead ? 'Marking...' : 'Mark All Read' }}\n          </button>\n          <button @click=\"toggleNotificationPanel\" class=\"btn btn-sm btn-outline-secondary\">\n            <i class=\"fas fa-times\"></i>\n          </button>\n        </div>\n      </div>\n\n      <div class=\"notification-content\">\n        <div v-if=\"loading\" class=\"notification-loading\">\n          <div class=\"spinner-border spinner-border-sm\" role=\"status\">\n            <span class=\"visually-hidden\">Loading...</span>\n          </div>\n          <span class=\"ms-2\">Loading notifications...</span>\n        </div>\n\n        <div v-else-if=\"error\" class=\"notification-error\">\n          <i class=\"fas fa-exclamation-triangle\"></i>\n          <span>{{ error }}</span>\n          <button @click=\"loadNotifications(1)\" class=\"btn btn-sm btn-outline-primary ms-2\">\n            <i class=\"fas fa-redo\"></i> Retry\n          </button>\n        </div>\n\n        <div v-else-if=\"notifications.length === 0\" class=\"no-notifications\">\n          <i class=\"fas fa-bell-slash\"></i>\n          <p>No notifications yet</p>\n        </div>\n\n        <div v-else class=\"notification-list\">\n          <div\n            v-for=\"notification in notifications\"\n            :key=\"notification.id\"\n            :data-notification-id=\"notification.id\"\n            class=\"notification-item\"\n            :class=\"{\n              'unread': !notification.is_read,\n              'priority-high': notification.priority === 'high' || notification.priority === 'urgent',\n              'clickable': true\n            }\"\n            @click=\"handleNotificationClick(notification)\"\n          >\n            <div class=\"notification-icon\">\n              <i :class=\"getNotificationIcon(notification.type)\"></i>\n            </div>\n            <div class=\"notification-content\">\n              <div class=\"notification-title\">{{ notification.title }}</div>\n              <div class=\"notification-message\">{{ notification.message }}</div>\n              <div class=\"notification-time\">{{ formatTime(notification.created_at) }}</div>\n            </div>\n            <div v-if=\"!notification.is_read\" class=\"unread-indicator\"></div>\n          </div>\n\n          <!-- Load More Button -->\n          <div v-if=\"hasMore\" class=\"load-more-container\">\n            <button \n              @click=\"loadMore\" \n              class=\"btn btn-sm btn-outline-primary\"\n              :disabled=\"loadingMore\"\n            >\n              <i v-if=\"loadingMore\" class=\"fas fa-spinner fa-spin\"></i>\n              <i v-else class=\"fas fa-chevron-down\"></i>\n              {{ loadingMore ? 'Loading...' : 'Load More' }}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { getClientNotificationService } from '../../services/notificationService';\nimport notificationNavigationService from '../../services/notificationNavigationService';\n\nexport default {\n  name: 'ClientNotifications',\n  \n  emits: [\n    'new-notification',\n    'notification-click', \n    'notification-read',\n    'notifications-read',\n    'connected',\n    'error'\n  ],\n\n  data() {\n    return {\n      showPanel: false,\n      notifications: [],\n      unreadCount: 0,\n      loading: false,\n      loadingMore: false,\n      markingAllRead: false,\n      error: null,\n      currentPage: 1,\n      hasMore: true,\n      pageSize: 20,\n      notificationService: null // Store the client-specific service instance\n    };\n  },\n\n  async mounted() {\n    await this.initializeNotifications();\n    \n    // Close panel when clicking outside\n    document.addEventListener('click', this.handleOutsideClick);\n  },\n\n  beforeUnmount() {\n    // Clean up event listeners\n    document.removeEventListener('click', this.handleOutsideClick);\n\n    // Remove notification service listeners\n    if (this.notificationService) {\n      this.notificationService.off('notification', this.handleNewNotification);\n      this.notificationService.off('connected', this.onConnected);\n      this.notificationService.off('error', this.onError);\n    }\n  },\n\n  methods: {\n    async initializeNotifications() {\n      try {\n        console.log('üöÄ ClientNotifications: Initializing client notification service');\n\n        // Get the client-specific notification service\n        this.notificationService = getClientNotificationService();\n\n        // Request notification permission\n        await this.notificationService.requestNotificationPermission();\n\n        // Initialize the client notification service\n        await this.notificationService.init();\n\n        // Set up event listeners\n        this.notificationService.on('notification', this.handleNewNotification);\n        this.notificationService.on('connected', this.onConnected);\n        this.notificationService.on('error', this.onError);\n\n        // Load initial data\n        await this.loadUnreadCount();\n\n        console.log('‚úÖ ClientNotifications: Client notification service initialized successfully');\n\n      } catch (error) {\n        console.error('‚ùå ClientNotifications: Failed to initialize client notifications:', error);\n        this.error = error.message || 'Failed to connect to notification service';\n      }\n    },\n\n    toggleNotificationPanel() {\n      this.showPanel = !this.showPanel;\n      \n      if (this.showPanel && this.notifications.length === 0) {\n        this.loadNotifications(1);\n      }\n    },\n\n    handleOutsideClick(event) {\n      if (!event.target.closest('.client-notifications')) {\n        this.showPanel = false;\n      }\n    },\n\n    async loadNotifications(page = 1) {\n      try {\n        if (page === 1) {\n          this.loading = true;\n          this.error = null;\n        } else {\n          this.loadingMore = true;\n        }\n\n        const response = await this.notificationService.getNotifications(page, this.pageSize);\n        console.log('Notifications response:', response);\n\n        // Handle the correct response structure from backend\n        let notifications = [];\n        let pagination = {};\n\n        if (response.data && response.data.notifications) {\n          // Backend returns: { success: true, data: { notifications: [...], pagination: {...} } }\n          if (Array.isArray(response.data.notifications)) {\n            notifications = response.data.notifications;\n            pagination = response.data.pagination || {};\n          }\n        }\n\n        if (page === 1) {\n          this.notifications = notifications;\n        } else {\n          this.notifications.push(...notifications);\n        }\n\n        this.currentPage = page;\n        this.hasMore = pagination.page < pagination.pages;\n\n        console.log('Loaded notifications:', this.notifications);\n\n      } catch (error) {\n        console.error('Failed to load notifications:', error);\n        this.error = 'Failed to load notifications';\n      } finally {\n        this.loading = false;\n        this.loadingMore = false;\n      }\n    },\n\n    async loadMore() {\n      if (this.hasMore && !this.loadingMore) {\n        await this.loadNotifications(this.currentPage + 1);\n      }\n    },\n\n    async loadUnreadCount() {\n      try {\n        this.unreadCount = await this.notificationService.getUnreadCount();\n      } catch (error) {\n        console.error('Failed to load unread count:', error);\n      }\n    },\n\n    async markAllAsRead() {\n      try {\n        this.markingAllRead = true;\n        await this.notificationService.markAllAsRead();\n        \n        // Update local state\n        this.notifications.forEach(notification => {\n          notification.is_read = true;\n        });\n        this.unreadCount = 0;\n        \n        this.$emit('notifications-read');\n        \n      } catch (error) {\n        console.error('Failed to mark all as read:', error);\n        this.$emit('error', 'Failed to mark notifications as read');\n      } finally {\n        this.markingAllRead = false;\n      }\n    },\n\n    async handleNotificationClick(notification) {\n      console.log('üîî Client notification clicked:', notification);\n\n      // Ensure we have a valid notification object with an ID\n      if (!notification || !notification.id) {\n        console.error('Invalid notification object:', notification);\n        return;\n      }\n\n      // Show loading state\n      this.showLoadingState(notification);\n\n      try {\n        // Mark as read if not already read\n        if (!notification.is_read) {\n          await this.notificationService.markAsRead(notification.id);\n          notification.is_read = true;\n          this.unreadCount = Math.max(0, this.unreadCount - 1);\n          this.$emit('notification-read', notification);\n        }\n\n        // Navigate based on notification type and data\n        await this.navigateToRelevantPage(notification);\n\n        // Close notification panel after successful navigation\n        this.showPanel = false;\n\n      } catch (error) {\n        console.error('‚ùå Failed to handle notification click:', error);\n        this.showErrorToast('Failed to process notification');\n      } finally {\n        this.hideLoadingState(notification);\n      }\n\n      // Emit click event for parent components to handle\n      this.$emit('notification-click', notification);\n    },\n\n    /**\n     * Navigate to the relevant page based on notification type and data\n     */\n    async navigateToRelevantPage(notification) {\n      console.log('üß≠ Determining navigation for notification:', notification.type, notification.data);\n\n      try {\n        const notificationData = typeof notification.data === 'string'\n          ? JSON.parse(notification.data)\n          : notification.data || {};\n\n        let targetRoute = null;\n\n        switch (notification.type) {\n          case 'status_change':\n          case 'request_update':\n            targetRoute = await this.handleRequestUpdateNavigation(notificationData);\n            break;\n\n          case 'payment_confirmed':\n          case 'payment_required':\n          case 'payment_update':\n            targetRoute = await this.handlePaymentNavigation(notificationData);\n            break;\n\n          case 'document_ready':\n          case 'ready_for_pickup':\n            targetRoute = await this.handleDocumentReadyNavigation(notificationData);\n            break;\n\n          case 'request_approved':\n          case 'request_rejected':\n            targetRoute = await this.handleRequestStatusNavigation(notificationData);\n            break;\n\n          case 'system_alert':\n          case 'maintenance_notice':\n            targetRoute = await this.handleSystemAlertNavigation(notificationData);\n            break;\n\n          default:\n            console.log('ü§∑ Unknown notification type, using default navigation');\n            targetRoute = await this.handleDefaultNavigation(notificationData);\n        }\n\n        if (targetRoute) {\n          console.log('üöÄ Navigating to:', targetRoute);\n\n          // Add timeout to prevent hanging navigation\n          const navigationPromise = this.$router.push(targetRoute);\n          const timeoutPromise = new Promise((_, reject) => {\n            setTimeout(() => reject(new Error('Navigation timeout')), 5000);\n          });\n\n          await Promise.race([navigationPromise, timeoutPromise]);\n        } else {\n          console.log('‚ÑπÔ∏è No navigation target determined for notification');\n        }\n\n      } catch (error) {\n        console.error('‚ùå Navigation error:', error);\n        throw new Error('Failed to navigate to notification target');\n      }\n    },\n\n    /**\n     * Handle navigation for request update notifications\n     */\n    async handleRequestUpdateNavigation(data) {\n      if (data.request_id) {\n        // Check if request still exists\n        const exists = await this.checkRequestExists(data.request_id);\n        if (exists) {\n          return {\n            name: 'RequestDetails',\n            params: { id: data.request_id }\n          };\n        } else {\n          this.showErrorToast('Request no longer exists');\n          return { name: 'MyRequests' };\n        }\n      }\n      return { name: 'MyRequests' };\n    },\n\n    /**\n     * Handle navigation for payment-related notifications\n     */\n    async handlePaymentNavigation(data) {\n      if (data.request_id) {\n        const exists = await this.checkRequestExists(data.request_id);\n        if (exists) {\n          return {\n            name: 'RequestDetails',\n            params: { id: data.request_id },\n            query: { tab: 'payment' } // Focus on payment section\n          };\n        }\n      }\n      // Fallback to requests page with payment filter\n      return {\n        name: 'MyRequests',\n        query: { filter: 'payment_required' }\n      };\n    },\n\n    /**\n     * Handle navigation for document ready notifications\n     */\n    async handleDocumentReadyNavigation(data) {\n      if (data.request_id) {\n        const exists = await this.checkRequestExists(data.request_id);\n        if (exists) {\n          return {\n            name: 'RequestDetails',\n            params: { id: data.request_id },\n            query: { tab: 'status' } // Focus on status/pickup info\n          };\n        }\n      }\n      // Fallback to requests page with ready filter\n      return {\n        name: 'MyRequests',\n        query: { filter: 'ready' }\n      };\n    },\n\n    /**\n     * Handle navigation for request status change notifications\n     */\n    async handleRequestStatusNavigation(data) {\n      if (data.request_id) {\n        const exists = await this.checkRequestExists(data.request_id);\n        if (exists) {\n          return {\n            name: 'RequestDetails',\n            params: { id: data.request_id }\n          };\n        }\n      }\n      return { name: 'MyRequests' };\n    },\n\n    /**\n     * Handle navigation for system alerts\n     */\n    async handleSystemAlertNavigation(data) {\n      // For system alerts, usually go to dashboard or help page\n      if (data.help_section) {\n        return {\n          name: 'HelpSupport',\n          query: { section: data.help_section }\n        };\n      }\n      return { name: 'ClientDashboard' };\n    },\n\n    /**\n     * Handle default navigation when type is unknown\n     */\n    async handleDefaultNavigation(data) {\n      // Priority order: request_id > dashboard\n      if (data.request_id) {\n        const exists = await this.checkRequestExists(data.request_id);\n        if (exists) {\n          return {\n            name: 'RequestDetails',\n            params: { id: data.request_id }\n          };\n        }\n      }\n\n      return { name: 'ClientDashboard' };\n    },\n\n    /**\n     * Check if a request still exists and belongs to the current user\n     */\n    async checkRequestExists(requestId) {\n      return await notificationNavigationService.checkRequestExists(requestId, 'client');\n    },\n\n    /**\n     * Show loading state for a notification\n     */\n    showLoadingState(notification) {\n      // Add loading class to notification item\n      const notificationElement = document.querySelector(`[data-notification-id=\"${notification.id}\"]`);\n      if (notificationElement) {\n        notificationElement.classList.add('loading');\n      }\n    },\n\n    /**\n     * Hide loading state for a notification\n     */\n    hideLoadingState(notification) {\n      const notificationElement = document.querySelector(`[data-notification-id=\"${notification.id}\"]`);\n      if (notificationElement) {\n        notificationElement.classList.remove('loading');\n      }\n    },\n\n    /**\n     * Show error toast message\n     */\n    showErrorToast(message) {\n      notificationNavigationService.showNavigationError(message, this.$emit.bind(this));\n    },\n\n    handleNewNotification(notification, context = null) {\n      // Validate this is a client notification\n      if (context && context.userType && context.userType !== 'client') {\n        console.log('üö´ ClientNotifications: Ignoring non-client notification:', context.userType);\n        return;\n      }\n\n      // Additional validation: check notification recipient type\n      if (notification.recipient_type && notification.recipient_type !== 'client') {\n        console.log('üö´ ClientNotifications: Ignoring notification for:', notification.recipient_type);\n        return;\n      }\n\n      console.log('üì¢ ClientNotifications: Processing client notification:', notification);\n\n      // Handle unread count updates from polling\n      if (notification.type === 'unread_count_update') {\n        this.unreadCount = notification.count || 0;\n        return;\n      }\n\n      // Handle notification read status updates\n      if (notification.type === 'notification_read') {\n        const notificationIndex = this.notifications.findIndex(n => n.id === notification.notification_id);\n        if (notificationIndex !== -1) {\n          this.notifications[notificationIndex].is_read = true;\n          this.unreadCount = Math.max(0, this.unreadCount - 1);\n        }\n        return;\n      }\n\n      // Handle all notifications marked as read\n      if (notification.type === 'all_notifications_read') {\n        this.notifications.forEach(n => n.is_read = true);\n        this.unreadCount = 0;\n        return;\n      }\n\n      // Add to beginning of list if panel is open\n      if (this.showPanel) {\n        this.notifications.unshift(notification);\n      }\n\n      // Update unread count for new notifications\n      if (!notification.is_read) {\n        this.unreadCount++;\n      }\n\n      // Emit event for parent components\n      this.$emit('new-notification', notification);\n    },\n\n    onConnected() {\n      console.log('Connected to client notification stream');\n      this.$emit('connected');\n    },\n\n    onError(error) {\n      console.error('Client notification stream error:', error);\n      this.$emit('error', 'Connection to notification stream failed');\n    },\n\n    getNotificationIcon(type) {\n      const icons = {\n        'status_change': 'fas fa-sync-alt text-info',\n        'payment_confirmed': 'fas fa-credit-card text-success',\n        'document_ready': 'fas fa-file-check text-success',\n        'request_update': 'fas fa-edit text-warning',\n        'system_alert': 'fas fa-exclamation-triangle text-danger',\n        'test': 'fas fa-vial text-secondary',\n        'connection': 'fas fa-plug text-success'\n      };\n      return icons[type] || 'fas fa-bell text-primary';\n    },\n\n    formatTime(timestamp) {\n      if (!timestamp) return '';\n      \n      const date = new Date(timestamp);\n      const now = new Date();\n      const diffInMinutes = Math.floor((now - date) / (1000 * 60));\n      \n      if (diffInMinutes < 1) return 'Just now';\n      if (diffInMinutes < 60) return `${diffInMinutes}m ago`;\n      \n      const diffInHours = Math.floor(diffInMinutes / 60);\n      if (diffInHours < 24) return `${diffInHours}h ago`;\n      \n      const diffInDays = Math.floor(diffInHours / 24);\n      if (diffInDays < 7) return `${diffInDays}d ago`;\n      \n      return date.toLocaleDateString();\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* Client Notifications Styles */\n.client-notifications {\n  position: relative;\n  display: inline-block;\n}\n\n.notification-bell {\n  position: relative;\n  cursor: pointer;\n  padding: 0.5rem;\n  border-radius: 50%;\n  transition: all 0.3s ease;\n  color: #495057;\n  font-size: 1.2rem;\n}\n\n.notification-bell:hover {\n  background: rgba(0, 123, 255, 0.1);\n  color: #007bff;\n  transform: scale(1.05);\n}\n\n.notification-badge {\n  position: absolute;\n  top: 0;\n  right: 0;\n  background: #dc3545;\n  color: white;\n  border-radius: 50%;\n  padding: 2px 6px;\n  font-size: 0.75rem;\n  font-weight: bold;\n  min-width: 18px;\n  text-align: center;\n  animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n  0% { transform: scale(1); }\n  50% { transform: scale(1.1); }\n  100% { transform: scale(1); }\n}\n\n.notification-panel {\n  position: absolute;\n  top: 100%;\n  right: 0;\n  width: 400px;\n  max-height: 500px;\n  background: white;\n  border: 1px solid #dee2e6;\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  z-index: 1050;\n  overflow: hidden;\n}\n\n.notification-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem;\n  border-bottom: 1px solid #dee2e6;\n  background: #f8f9fa;\n}\n\n.notification-header h5 {\n  margin: 0;\n  color: #1e3a8a;\n  font-weight: 600;\n}\n\n.notification-actions {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.notification-content {\n  max-height: 400px;\n  overflow-y: auto;\n}\n\n.notification-loading,\n.notification-error {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  color: #6c757d;\n}\n\n.notification-error {\n  flex-direction: column;\n  gap: 1rem;\n}\n\n.no-notifications {\n  text-align: center;\n  padding: 2rem;\n  color: #6c757d;\n}\n\n.no-notifications i {\n  font-size: 2rem;\n  margin-bottom: 0.5rem;\n  opacity: 0.5;\n}\n\n.notification-list {\n  padding: 0;\n}\n\n.notification-item {\n  display: flex;\n  align-items: flex-start;\n  gap: 1rem;\n  padding: 1rem;\n  border-bottom: 1px solid #f1f3f4;\n  cursor: pointer;\n  transition: background-color 0.2s ease;\n  position: relative;\n}\n\n.notification-item:hover {\n  background: #f8f9fa;\n}\n\n.notification-item.unread {\n  background: #f0f8ff;\n  border-left: 3px solid #007bff;\n}\n\n.notification-item.priority-high {\n  border-left: 3px solid #dc3545;\n}\n\n.notification-item.clickable {\n  cursor: pointer;\n  position: relative;\n  transition: all 0.2s ease;\n}\n\n.notification-item.clickable:hover {\n  background: #f0f8ff;\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(0, 123, 255, 0.15);\n}\n\n.notification-item.loading {\n  opacity: 0.7;\n  pointer-events: none;\n}\n\n.notification-item.loading::after {\n  content: '';\n  position: absolute;\n  top: 50%;\n  right: 1rem;\n  width: 16px;\n  height: 16px;\n  border: 2px solid #f3f3f3;\n  border-top: 2px solid #007bff;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n.notification-icon {\n  flex-shrink: 0;\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  background: #f8f9fa;\n}\n\n.notification-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.notification-title {\n  font-weight: 600;\n  color: #212529;\n  margin-bottom: 0.25rem;\n  line-height: 1.4;\n}\n\n.notification-message {\n  color: #6c757d;\n  font-size: 0.9rem;\n  line-height: 1.4;\n  margin-bottom: 0.5rem;\n}\n\n.notification-time {\n  color: #adb5bd;\n  font-size: 0.8rem;\n}\n\n.unread-indicator {\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  width: 8px;\n  height: 8px;\n  background: #007bff;\n  border-radius: 50%;\n}\n\n.load-more-container {\n  padding: 1rem;\n  text-align: center;\n  border-top: 1px solid #dee2e6;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n  .notification-bell {\n    padding: 0.4rem;\n    font-size: 1.1rem;\n  }\n\n  .notification-panel {\n    position: fixed;\n    top: 60px;\n    right: 0.5rem;\n    left: 0.5rem;\n    width: auto;\n    max-width: none;\n    margin: 0;\n    border-radius: 0.5rem;\n  }\n\n  .notification-header {\n    padding: 1rem;\n  }\n\n  .notification-header h5 {\n    font-size: 1.1rem;\n  }\n\n  .notification-item {\n    padding: 0.75rem;\n  }\n\n  .notification-title {\n    font-size: 0.9rem;\n  }\n\n  .notification-message {\n    font-size: 0.8rem;\n  }\n\n  .notification-time {\n    font-size: 0.75rem;\n  }\n\n  .notification-actions {\n    flex-direction: column;\n    gap: 0.25rem;\n  }\n\n  .btn-sm {\n    padding: 0.2rem 0.4rem;\n    font-size: 0.8rem;\n  }\n}\n\n@media (max-width: 480px) {\n  .notification-panel {\n    right: 0.25rem;\n    left: 0.25rem;\n    top: 55px;\n  }\n\n  .notification-header {\n    padding: 0.75rem;\n  }\n\n  .notification-item {\n    padding: 0.5rem;\n  }\n\n  .notification-title {\n    font-size: 0.85rem;\n  }\n\n  .notification-message {\n    font-size: 0.75rem;\n  }\n}\n\n/* Bootstrap utility classes */\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  line-height: 1.5;\n  color: #212529;\n  text-align: center;\n  text-decoration: none;\n  vertical-align: middle;\n  cursor: pointer;\n  user-select: none;\n  background-color: transparent;\n  border: 1px solid transparent;\n  padding: 0.375rem 0.75rem;\n  font-size: 1rem;\n  border-radius: 0.375rem;\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n\n.btn-sm {\n  padding: 0.25rem 0.5rem;\n  font-size: 0.875rem;\n  border-radius: 0.25rem;\n}\n\n.btn-outline-primary {\n  color: #0d6efd;\n  border-color: #0d6efd;\n}\n\n.btn-outline-primary:hover {\n  color: #fff;\n  background-color: #0d6efd;\n  border-color: #0d6efd;\n}\n\n.btn-outline-secondary {\n  color: #6c757d;\n  border-color: #6c757d;\n}\n\n.btn-outline-secondary:hover {\n  color: #fff;\n  background-color: #6c757d;\n  border-color: #6c757d;\n}\n\n.btn:disabled {\n  pointer-events: none;\n  opacity: 0.65;\n}\n\n.spinner-border {\n  display: inline-block;\n  width: 2rem;\n  height: 2rem;\n  vertical-align: -0.125em;\n  border: 0.25em solid currentColor;\n  border-right-color: transparent;\n  border-radius: 50%;\n  animation: spinner-border 0.75s linear infinite;\n}\n\n.spinner-border-sm {\n  width: 1rem;\n  height: 1rem;\n  border-width: 0.2em;\n}\n\n@keyframes spinner-border {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.visually-hidden {\n  position: absolute !important;\n  width: 1px !important;\n  height: 1px !important;\n  padding: 0 !important;\n  margin: -1px !important;\n  overflow: hidden !important;\n  clip: rect(0, 0, 0, 0) !important;\n  white-space: nowrap !important;\n  border: 0 !important;\n}\n\n.ms-2 {\n  margin-left: 0.5rem !important;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}