{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport documentRequestService from '@/services/documentRequestService';\nimport clientAuthService from '@/services/clientAuthService';\nimport ImageViewer from '@/components/common/ImageViewer.vue';\nexport default {\n  name: 'RequestDetails',\n  components: {\n    ImageViewer\n  },\n  data() {\n    return {\n      request: null,\n      loading: true,\n      error: null,\n      showImageViewer: false,\n      selectedImage: null,\n      imageObjectUrls: new Map(),\n      // Track created object URLs for cleanup\n      imageUrls: {\n        beneficiaryVerification: '',\n        pickupId: '',\n        authorizationLetter: ''\n      },\n      // Store loaded image URLs for template binding\n      progressSteps: [{\n        status: 'pending',\n        title: 'Request Submitted',\n        description: 'Your request has been submitted and is waiting for review',\n        icon: 'fas fa-paper-plane'\n      }, {\n        status: 'under_review',\n        title: 'Under Review',\n        description: 'Your request is being reviewed by our staff',\n        icon: 'fas fa-search'\n      }, {\n        status: 'approved',\n        title: 'Approved',\n        description: 'Your request has been approved and payment is required',\n        icon: 'fas fa-check'\n      }, {\n        status: 'processing',\n        title: 'Processing',\n        description: 'Your document is being prepared',\n        icon: 'fas fa-cog'\n      }, {\n        status: 'ready_for_pickup',\n        title: 'Ready for Pickup',\n        description: 'Your document is ready for pickup',\n        icon: 'fas fa-box'\n      }, {\n        status: 'completed',\n        title: 'Completed',\n        description: 'Request has been completed successfully',\n        icon: 'fas fa-check-circle'\n      }]\n    };\n  },\n  computed: {\n    clientData() {\n      return clientAuthService.getCurrentUser();\n    }\n  },\n  async mounted() {\n    await this.loadRequestDetails();\n  },\n  beforeUnmount() {\n    // Clean up object URLs to prevent memory leaks\n    this.cleanupImageUrls();\n  },\n  methods: {\n    async loadRequestDetails() {\n      try {\n        this.loading = true;\n        this.error = null;\n        const requestId = this.$route.params.id;\n        const response = await documentRequestService.getRequestDetails(requestId);\n        this.request = response.data;\n\n        // Debug: Log the received request data\n        console.log('üîç Frontend received request data:', {\n          id: this.request?.id,\n          requestor: this.request?.requestor,\n          nationality: this.request?.requestor?.nationality,\n          months_of_residency: this.request?.requestor?.months_of_residency,\n          years_of_residency: this.request?.requestor?.years_of_residency,\n          beneficiary: this.request?.beneficiary,\n          beneficiary_verification_image: this.request?.beneficiary?.verification_image_path,\n          authorized_pickup: this.request?.authorized_pickup,\n          pickup_id_image: this.request?.authorized_pickup?.id_image_path\n        });\n\n        // Debug: Log the request data to see what's available\n        console.log('üîç Request data loaded:', {\n          hasAuthorizedPickup: !!this.request.authorized_pickup,\n          authorizedPickupData: this.request.authorized_pickup,\n          pickupIdImagePath: this.request.authorized_pickup?.id_image_path,\n          authorizationLetterPath: this.request.authorized_pickup?.authorization_letter_path\n        });\n\n        // Load images after request details are loaded\n        await this.loadImages();\n      } catch (error) {\n        console.error('Error loading request details:', error);\n        this.error = error.response?.data?.message || 'Failed to load request details';\n      } finally {\n        this.loading = false;\n      }\n    },\n    async loadImages() {\n      // Check if user is authenticated\n      const authToken = localStorage.getItem('auth_token') || sessionStorage.getItem('auth_token');\n      if (!authToken) {\n        console.warn('‚ö†Ô∏è User not authenticated, skipping image loading');\n        this.showToast('Warning', 'Please log in to view verification images', 'warning');\n        return;\n      }\n      console.log('üñºÔ∏è Starting image loading process...');\n\n      // Load beneficiary verification image\n      if (this.request?.beneficiary?.verification_image_path) {\n        try {\n          console.log('üì∏ Loading beneficiary verification image...');\n          const imageUrl = await this.getVerificationImageUrl(this.request.beneficiary.verification_image_path);\n          if (imageUrl && imageUrl !== this.getPlaceholderImageUrl()) {\n            this.imageUrls.beneficiaryVerification = imageUrl;\n            console.log('‚úÖ Beneficiary verification image loaded successfully');\n          } else {\n            this.imageUrls.beneficiaryVerification = this.getPlaceholderImageUrl();\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to load beneficiary verification image:', error.message);\n          this.imageUrls.beneficiaryVerification = this.getPlaceholderImageUrl();\n          if (error.message.includes('log in')) {\n            this.showToast('Warning', 'Please log in to view images', 'warning');\n          }\n        }\n      }\n\n      // Load pickup ID image\n      if (this.request?.authorized_pickup?.id_image_path) {\n        try {\n          console.log('üì∏ Loading pickup ID image...', {\n            path: this.request.authorized_pickup.id_image_path,\n            filename: this.request.authorized_pickup.id_image_path.split(/[/\\\\]/).pop()\n          });\n          const imageUrl = await this.getPickupIdImageUrl(this.request.authorized_pickup.id_image_path);\n          if (imageUrl && imageUrl !== this.getPlaceholderImageUrl()) {\n            this.imageUrls.pickupId = imageUrl;\n            console.log('‚úÖ Pickup ID image loaded successfully');\n          } else {\n            this.imageUrls.pickupId = this.getPlaceholderImageUrl();\n            console.log('‚ö†Ô∏è Using placeholder for pickup ID image');\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to load pickup ID image:', error.message);\n          this.imageUrls.pickupId = this.getPlaceholderImageUrl();\n          if (error.message.includes('log in')) {\n            this.showToast('Warning', 'Please log in to view images', 'warning');\n          }\n        }\n      } else {\n        console.log('‚ö†Ô∏è No pickup ID image path found in request data');\n      }\n\n      // Load authorization letter image\n      if (this.request?.authorized_pickup?.authorization_letter_path) {\n        try {\n          console.log('üì∏ Loading authorization letter image...');\n          const imageUrl = await this.getAuthorizationLetterUrl(this.request.authorized_pickup.authorization_letter_path);\n          if (imageUrl && imageUrl !== this.getPlaceholderImageUrl()) {\n            this.imageUrls.authorizationLetter = imageUrl;\n            console.log('‚úÖ Authorization letter image loaded successfully');\n          } else {\n            this.imageUrls.authorizationLetter = this.getPlaceholderImageUrl();\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to load authorization letter image:', error.message);\n          this.imageUrls.authorizationLetter = this.getPlaceholderImageUrl();\n          if (error.message.includes('log in')) {\n            this.showToast('Warning', 'Please log in to view images', 'warning');\n          }\n        }\n      }\n      console.log('üñºÔ∏è Image loading process completed');\n    },\n    cleanupImageUrls() {\n      // Revoke all object URLs to prevent memory leaks\n      for (const [key, url] of this.imageObjectUrls) {\n        URL.revokeObjectURL(url);\n        console.log('üßπ Cleaned up object URL:', key);\n      }\n      this.imageObjectUrls.clear();\n    },\n    getDocumentIcon(type) {\n      const icons = {\n        'Barangay Clearance': 'fas fa-certificate',\n        'Cedula': 'fas fa-id-card'\n      };\n      return icons[type] || 'fas fa-file-alt';\n    },\n    getStatusClass(status) {\n      const classes = {\n        'pending': 'status-pending',\n        'under_review': 'status-review',\n        'approved': 'status-approved',\n        'processing': 'status-processing',\n        'ready_for_pickup': 'status-ready',\n        'completed': 'status-completed',\n        'rejected': 'status-rejected',\n        'cancelled': 'status-cancelled'\n      };\n      return classes[status] || 'status-unknown';\n    },\n    formatStatus(status) {\n      const statusMap = {\n        'pending': 'Pending',\n        'under_review': 'Under Review',\n        'approved': 'Approved',\n        'processing': 'Processing',\n        'ready_for_pickup': 'Ready for Pickup',\n        'completed': 'Completed',\n        'rejected': 'Rejected',\n        'cancelled': 'Cancelled'\n      };\n      return statusMap[status] || status;\n    },\n    getPaymentStatusClass(status) {\n      const classes = {\n        'pending': 'payment-pending',\n        'paid': 'payment-paid',\n        'failed': 'payment-failed',\n        'refunded': 'payment-refunded'\n      };\n      return classes[status] || 'payment-unknown';\n    },\n    formatPaymentStatus(status) {\n      const statusMap = {\n        'pending': 'Pending Payment',\n        'paid': 'Paid',\n        'failed': 'Payment Failed',\n        'refunded': 'Refunded'\n      };\n      return statusMap[status] || 'Not Required';\n    },\n    getMainTimelineSteps() {\n      // Create a copy of progress steps to modify for cash payments\n      const steps = [...this.progressSteps];\n\n      // Check if this is a cash payment\n      const isCashPayment = this.request && (this.request.payment_method === 'Cash Payment' || this.request.payment_method === 'Cash' || this.request.payment_method_code === 'CASH' || this.request.payment_method_id === 1 || this.request.is_online_payment === false || this.request.is_online_payment === 0 || this.request.is_online === false || this.request.is_online === 0);\n\n      // Modify the \"approved\" step description for cash payments\n      if (isCashPayment) {\n        const approvedStepIndex = steps.findIndex(step => step.status === 'approved');\n        if (approvedStepIndex !== -1) {\n          steps[approvedStepIndex] = {\n            ...steps[approvedStepIndex],\n            description: 'Your request has been approved. Payment will be collected during pickup.'\n          };\n        }\n      }\n      return steps;\n    },\n    isStepCompleted(stepStatus, currentStatus) {\n      // Don't mark any steps as completed if the request is rejected\n      if (currentStatus === 'rejected') {\n        // Only mark steps before \"under_review\" as completed for rejected requests\n        const completedBeforeRejection = ['pending'];\n        return completedBeforeRejection.includes(stepStatus);\n      }\n      const statusOrder = ['pending', 'under_review', 'approved', 'processing', 'ready_for_pickup', 'completed'];\n      const stepIndex = statusOrder.indexOf(stepStatus);\n      const currentIndex = statusOrder.indexOf(currentStatus);\n      return stepIndex < currentIndex;\n    },\n    getFullName() {\n      const client = this.request?.client || this.clientData?.profile;\n      if (!client) return 'N/A';\n      return `${client.first_name || ''} ${client.middle_name || ''} ${client.last_name || ''}`.trim();\n    },\n    getClientEmail() {\n      const email = this.request?.email || this.request?.client?.email || this.clientData?.profile?.email;\n      return email && email.trim() ? email : null;\n    },\n    getClientPhone() {\n      const phone = this.request?.phone_number || this.request?.client?.phone_number || this.clientData?.profile?.phone_number;\n      return phone && phone.trim() ? phone : 'Contact information not available';\n    },\n    getEmergencyContact() {\n      const contact = this.request?.emergency_contact_name;\n      return contact && contact.trim() ? contact : null;\n    },\n    getEmergencyPhone() {\n      const phone = this.request?.emergency_contact_phone;\n      return phone && phone.trim() ? phone : null;\n    },\n    getFullAddress() {\n      // Try multiple sources for address data\n      const client = this.request?.client || this.clientData || this.request;\n      if (!client) return 'Address not available';\n      const parts = [client.house_number || client.requestor_house_number, client.street || client.requestor_street, client.subdivision, client.barangay || client.requestor_barangay, client.city_municipality || client.requestor_city_municipality || client.city, client.province || client.requestor_province].filter(part => part && part.trim());\n      return parts.length > 0 ? parts.join(', ') : 'Address not available';\n    },\n    // New helper methods for complete client information\n    getClientUsername() {\n      return this.request?.client_username || this.request?.client?.username || this.clientData?.username;\n    },\n    getClientEmailVerified() {\n      return this.request?.email_verified || this.request?.client?.email_verified || this.clientData?.email_verified || false;\n    },\n    getClientPhoneVerified() {\n      return this.request?.phone_verified || this.request?.client?.phone_verified || this.clientData?.phone_verified || false;\n    },\n    getClientProfileVerified() {\n      return this.request?.is_verified || this.request?.client?.is_verified || this.clientData?.is_verified || false;\n    },\n    getClientResidencyVerified() {\n      return this.request?.residency_verified || this.request?.client?.residency_verified || this.clientData?.residency_verified || false;\n    },\n    getClientAccountStatus() {\n      return this.request?.status || this.request?.client?.status || this.clientData?.status || 'unknown';\n    },\n    getClientLastLogin() {\n      return this.request?.last_login || this.request?.client?.last_login || this.clientData?.last_login;\n    },\n    getClientCreatedAt() {\n      return this.request?.created_at || this.request?.client?.created_at || this.clientData?.created_at;\n    },\n    getClientBirthDate() {\n      return this.request?.birth_date || this.request?.requestor_birth_date || this.request?.client?.birth_date || this.clientData?.birth_date;\n    },\n    getClientGender() {\n      return this.request?.gender || this.request?.requestor_gender || this.request?.client?.gender || this.clientData?.gender;\n    },\n    getClientCivilStatus() {\n      return this.request?.civil_status_id || this.request?.requestor_civil_status_id || this.request?.client?.civil_status_id || this.clientData?.civil_status_id;\n    },\n    getClientNationality() {\n      return this.request?.requestor?.nationality || this.request?.nationality || this.request?.requestor_nationality || this.request?.client?.nationality || this.clientData?.nationality;\n    },\n    getClientAccountStatusClass() {\n      const status = this.getClientAccountStatus();\n      const classes = {\n        'active': 'bg-success',\n        'inactive': 'bg-secondary',\n        'suspended': 'bg-danger',\n        'pending_verification': 'bg-warning',\n        'pending_residency_verification': 'bg-info'\n      };\n      return classes[status] || 'bg-secondary';\n    },\n    formatAccountStatus(status) {\n      const statusMap = {\n        'active': 'Active',\n        'inactive': 'Inactive',\n        'suspended': 'Suspended',\n        'pending_verification': 'Pending Verification',\n        'pending_residency_verification': 'Pending Residency Verification'\n      };\n      return statusMap[status] || status;\n    },\n    formatGender(gender) {\n      if (!gender) return 'Not provided';\n      return gender.charAt(0).toUpperCase() + gender.slice(1);\n    },\n    getCivilStatusName(statusId) {\n      const statuses = {\n        1: 'Single',\n        2: 'Married',\n        3: 'Divorced',\n        4: 'Widowed',\n        5: 'Separated'\n      };\n      return statuses[statusId] || 'Not provided';\n    },\n    getResidencyDisplay() {\n      if (!this.request || !this.request.requestor) {\n        return 'Not provided';\n      }\n      const years = this.request.requestor.years_of_residency || 0;\n      const months = this.request.requestor.months_of_residency || 0;\n\n      // If both are 0, return \"Not provided\"\n      if (years === 0 && months === 0) {\n        return 'Not provided';\n      }\n      const parts = [];\n      if (years > 0) parts.push(`${years} year${years > 1 ? 's' : ''}`);\n      if (months > 0) parts.push(`${months} month${months > 1 ? 's' : ''}`);\n      return parts.length > 0 ? parts.join(' and ') : 'Less than a month';\n    },\n    formatDate(dateString) {\n      if (!dateString) return 'N/A';\n      return new Date(dateString).toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    },\n    formatCurrency(amount) {\n      return parseFloat(amount || 0).toFixed(2);\n    },\n    canCancelRequest(status) {\n      // Enhanced cancellation rules - allow cancellation until payment is confirmed\n      const cancellableStatuses = ['pending', 'under_review', 'additional_info_required', 'approved', 'payment_pending', 'payment_failed'];\n      return cancellableStatuses.includes(status);\n    },\n    needsPayment(request) {\n      // Check if request needs payment based on enhanced workflow\n      const paymentRequiredStatuses = ['approved', 'payment_pending', 'payment_failed'];\n      const unpaidStatuses = ['pending', 'failed', null, undefined, ''];\n      return paymentRequiredStatuses.includes(request.status) && unpaidStatuses.includes(request.payment_status) && request.payment_method_id &&\n      // Must have a payment method selected\n      request.is_online_payment; // Only show for online payment methods\n    },\n    canDownload(status) {\n      return status === 'completed';\n    },\n    async cancelRequest() {\n      // Enhanced cancellation with reason input\n      const reason = prompt('Please provide a reason for cancelling this request (optional):', '');\n\n      // If user clicked cancel on the prompt, don't proceed\n      if (reason === null) return;\n\n      // Confirm cancellation\n      if (!confirm('Are you sure you want to cancel this request?')) return;\n      try {\n        console.log('üö´ Cancelling request:', this.request.id, 'Reason:', reason);\n        const cancellationReason = reason.trim() || 'Cancelled by user';\n        await documentRequestService.cancelRequest(this.request.id, cancellationReason);\n        this.$toast?.success('Request cancelled successfully. Administrators have been notified.');\n        this.request.status = 'cancelled';\n\n        // Refresh request details to show updated status\n        await this.loadRequestDetails();\n        console.log('‚úÖ Request cancelled successfully');\n      } catch (error) {\n        console.error('‚ùå Error cancelling request:', error);\n\n        // Show more specific error messages\n        if (error.response?.data?.message) {\n          this.$toast?.error(error.response.data.message);\n        } else if (error.message?.includes('cannot be cancelled')) {\n          this.$toast?.error('This request cannot be cancelled at its current stage');\n        } else {\n          this.$toast?.error('Failed to cancel request. Please try again.');\n        }\n      }\n    },\n    async processPayment() {\n      try {\n        // Check if request has a payment method selected\n        if (!this.request.payment_method_id) {\n          this.showToast('Error', 'No payment method selected for this request', 'error');\n          return;\n        }\n\n        // Check if it's an online payment method\n        if (!this.request.is_online_payment) {\n          this.showToast('Info', 'This request uses in-person payment. Please pay at the barangay office.', 'info');\n          return;\n        }\n\n        // Show loading state\n        this.showToast('Info', 'Initiating payment...', 'info');\n\n        // Get current user data from clientAuthService\n        const currentUser = this.$clientAuth.getCurrentUser();\n\n        // Prepare payment data\n        const paymentData = {\n          request_id: this.request.id,\n          payment_method_id: this.request.payment_method_id,\n          customer_email: currentUser?.email || this.request.email\n        };\n\n        // Import paymentService dynamically if not already imported\n        const {\n          default: paymentService\n        } = await import('@/services/paymentService');\n\n        // Initiate payment through PayMongo\n        const response = await paymentService.initiatePayment(paymentData);\n        if (response.success && response.data.checkout_url) {\n          // Redirect to PayMongo checkout page\n          this.showToast('Success', 'Redirecting to payment page...', 'success');\n          paymentService.redirectToPayMongo(response.data.checkout_url);\n        } else {\n          throw new Error(response.message || 'Failed to initiate payment');\n        }\n      } catch (error) {\n        console.error('Payment initiation error:', error);\n        const errorMessage = error.response?.data?.message || error.message || 'Failed to initiate payment';\n        this.showToast('Error', errorMessage, 'error');\n      }\n    },\n    downloadDocument() {\n      // TODO: Implement document download\n      console.log('Download document for request:', this.request.id);\n    },\n    printDetails() {\n      window.print();\n    },\n    goBack() {\n      this.$router.push({\n        name: 'MyRequests'\n      });\n    },\n    // Beneficiary helper methods\n    getBeneficiaryFullName() {\n      if (!this.request?.beneficiary) return 'Not provided';\n      const b = this.request.beneficiary;\n      return `${b.first_name || ''} ${b.middle_name || ''} ${b.last_name || ''}`.trim();\n    },\n    getBeneficiaryAddress() {\n      if (!this.request?.beneficiary) return 'Not provided';\n      const b = this.request.beneficiary;\n      const parts = [b.house_number, b.street, b.subdivision, b.barangay, b.city_municipality, b.province].filter(part => part && part.trim());\n      return parts.length > 0 ? parts.join(', ') : 'Not provided';\n    },\n    async getVerificationImageUrl(imagePath) {\n      if (!imagePath) return this.getPlaceholderImageUrl();\n\n      // Extract filename from path\n      const filename = imagePath.split(/[/\\\\]/).pop();\n      const cacheKey = `beneficiary-${filename}`;\n\n      // Return cached URL if available\n      if (this.imageObjectUrls.has(cacheKey)) {\n        return this.imageObjectUrls.get(cacheKey);\n      }\n      try {\n        // Debug logging for path consistency\n        console.log('üîç Debug beneficiary verification image loading:', {\n          originalPath: imagePath,\n          extractedFilename: filename,\n          requestId: this.request.id,\n          finalApiUrl: `/client/document-requests/${this.request.id}/verification-image/beneficiary/${filename}`\n        });\n\n        // Fetch image as blob with authentication\n        const objectUrl = await documentRequestService.getVerificationImageObjectUrl(this.request.id, 'beneficiary', filename);\n\n        // Cache the object URL\n        this.imageObjectUrls.set(cacheKey, objectUrl);\n        console.log('‚úÖ Created object URL for beneficiary verification image:', filename);\n        return objectUrl;\n      } catch (error) {\n        console.error('‚ùå Failed to load beneficiary verification image:', {\n          filename,\n          imagePath,\n          requestId: this.request.id,\n          error: error.message,\n          status: error.response?.status\n        });\n\n        // Show user-friendly error messages\n        if (error.message.includes('not found')) {\n          this.showToast('Warning', 'Verification image not found on server', 'warning');\n        } else if (error.message.includes('contact support')) {\n          this.showToast('Error', 'Server error - please contact support', 'error');\n        } else {\n          this.showToast('Warning', `Failed to load verification image: ${error.message}`, 'warning');\n        }\n        return this.getPlaceholderImageUrl();\n      }\n    },\n    getVerificationStatusClass(status) {\n      const classes = {\n        'pending': 'bg-warning',\n        'approved': 'bg-success',\n        'rejected': 'bg-danger'\n      };\n      return classes[status] || 'bg-secondary';\n    },\n    formatVerificationStatus(status) {\n      const statusMap = {\n        'pending': 'Pending Verification',\n        'approved': 'Verified',\n        'rejected': 'Rejected'\n      };\n      return statusMap[status] || 'Unknown';\n    },\n    // Authorized pickup person helper methods\n    getAuthorizedPickupFullName() {\n      if (!this.request?.authorized_pickup) return 'Not provided';\n      const p = this.request.authorized_pickup;\n      return `${p.first_name || ''} ${p.middle_name || ''} ${p.last_name || ''}`.trim();\n    },\n    async getPickupIdImageUrl(imagePath) {\n      if (!imagePath) return this.getPlaceholderImageUrl();\n\n      // Extract filename from path\n      const filename = imagePath.split(/[/\\\\]/).pop();\n      const cacheKey = `pickup-id-${filename}`;\n\n      // Return cached URL if available\n      if (this.imageObjectUrls.has(cacheKey)) {\n        return this.imageObjectUrls.get(cacheKey);\n      }\n      try {\n        // Debug logging for path consistency\n        console.log('üîç Debug pickup ID image loading:', {\n          originalPath: imagePath,\n          extractedFilename: filename,\n          requestId: this.request.id,\n          finalApiUrl: `/client/document-requests/${this.request.id}/verification-image/pickup-id/${filename}`\n        });\n\n        // Fetch image as blob with authentication\n        const objectUrl = await documentRequestService.getVerificationImageObjectUrl(this.request.id, 'pickup-id', filename);\n\n        // Cache the object URL\n        this.imageObjectUrls.set(cacheKey, objectUrl);\n        console.log('‚úÖ Created object URL for pickup ID image:', filename);\n        return objectUrl;\n      } catch (error) {\n        console.error('‚ùå Failed to load pickup ID image:', {\n          filename,\n          imagePath,\n          requestId: this.request.id,\n          error: error.message,\n          status: error.response?.status\n        });\n\n        // Show user-friendly error messages\n        if (error.message.includes('not found')) {\n          this.showToast('Warning', 'ID image not found on server', 'warning');\n        } else if (error.message.includes('contact support')) {\n          this.showToast('Error', 'Server error - please contact support', 'error');\n        } else {\n          this.showToast('Warning', `Failed to load ID image: ${error.message}`, 'warning');\n        }\n        return this.getPlaceholderImageUrl();\n      }\n    },\n    async getAuthorizationLetterUrl(imagePath) {\n      if (!imagePath) return this.getPlaceholderImageUrl();\n\n      // Extract filename from path\n      const filename = imagePath.split(/[/\\\\]/).pop();\n      const cacheKey = `pickup-auth-${filename}`;\n\n      // Return cached URL if available\n      if (this.imageObjectUrls.has(cacheKey)) {\n        return this.imageObjectUrls.get(cacheKey);\n      }\n      try {\n        // Debug logging for path consistency\n        console.log('üîç Debug authorization letter loading:', {\n          originalPath: imagePath,\n          extractedFilename: filename,\n          requestId: this.request.id,\n          finalApiUrl: `/client/document-requests/${this.request.id}/verification-image/pickup-auth/${filename}`\n        });\n\n        // Fetch image as blob with authentication\n        const objectUrl = await documentRequestService.getVerificationImageObjectUrl(this.request.id, 'pickup-auth', filename);\n\n        // Cache the object URL\n        this.imageObjectUrls.set(cacheKey, objectUrl);\n        console.log('‚úÖ Created object URL for authorization letter:', filename);\n        return objectUrl;\n      } catch (error) {\n        console.error('‚ùå Failed to load authorization letter:', {\n          filename,\n          imagePath,\n          requestId: this.request.id,\n          error: error.message,\n          status: error.response?.status\n        });\n\n        // Show user-friendly error messages\n        if (error.message.includes('not found')) {\n          this.showToast('Warning', 'Authorization letter not found on server', 'warning');\n        } else if (error.message.includes('contact support')) {\n          this.showToast('Error', 'Server error - please contact support', 'error');\n        } else {\n          this.showToast('Warning', `Failed to load authorization letter: ${error.message}`, 'warning');\n        }\n        return this.getPlaceholderImageUrl();\n      }\n    },\n    getPlaceholderImageUrl() {\n      // Return a data URL for a simple placeholder image\n      return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik04NSA2MEw5NSA3MEwxMTUgNTBMMTM1IDcwTDE0NSA2MEwxNjUgODBMMTY1IDEyMEg0NVY4MEw2NSA2MEw4NSA2MFoiIGZpbGw9IiNEMUQ1REIiLz4KPGNpcmNsZSBjeD0iNzAiIGN5PSI0NSIgcj0iOCIgZmlsbD0iI0QxRDVEQiIvPgo8dGV4dCB4PSIxMDAiIHk9IjEwNSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmaWxsPSIjNkI3MjgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pgo8L3N2Zz4K';\n    },\n    async openImageModal(imagePath, imageName, imageType = 'beneficiaries') {\n      try {\n        // Use the already loaded image URLs from the reactive data\n        let imageUrl;\n        switch (imageType) {\n          case 'pickup_id':\n          case 'pickup_ids':\n            imageUrl = this.imageUrls.pickupId;\n            break;\n          case 'pickup_authorization':\n            imageUrl = this.imageUrls.authorizationLetter;\n            break;\n          default:\n            imageUrl = this.imageUrls.beneficiaryVerification;\n        }\n\n        // If image URL is not loaded yet, try to load it\n        if (!imageUrl || imageUrl === this.getPlaceholderImageUrl()) {\n          console.log('üîÑ Image not loaded yet, attempting to load for modal...');\n          switch (imageType) {\n            case 'pickup_id':\n            case 'pickup_ids':\n              imageUrl = await this.getPickupIdImageUrl(imagePath);\n              this.imageUrls.pickupId = imageUrl;\n              break;\n            case 'pickup_authorization':\n              imageUrl = await this.getAuthorizationLetterUrl(imagePath);\n              this.imageUrls.authorizationLetter = imageUrl;\n              break;\n            default:\n              imageUrl = await this.getVerificationImageUrl(imagePath);\n              this.imageUrls.beneficiaryVerification = imageUrl;\n          }\n        }\n        if (!imageUrl || imageUrl === this.getPlaceholderImageUrl()) {\n          this.showToast('Error', 'Failed to load image', 'error');\n          return;\n        }\n\n        // Debug logging for modal image data\n        console.log('üñºÔ∏è Opening ImageViewer modal with:', {\n          imageType,\n          imageName,\n          imagePath,\n          imageUrl: imageUrl ? imageUrl.substring(0, 50) + '...' : 'none',\n          isBlobUrl: imageUrl?.startsWith('blob:'),\n          isDataUrl: imageUrl?.startsWith('data:'),\n          isPlaceholder: imageUrl === this.getPlaceholderImageUrl()\n        });\n\n        // Set data for ImageViewer component\n        this.selectedImage = {\n          url: imageUrl,\n          title: imageName || 'Document',\n          filename: imagePath ? imagePath.split(/[/\\\\]/).pop() : '',\n          type: imageType,\n          downloadUrl: imageUrl\n        };\n        this.showImageViewer = true;\n      } catch (error) {\n        console.error('Error opening image modal:', error);\n        this.showToast('Error', 'Failed to load image', 'error');\n      }\n    },\n    closeImageViewer() {\n      this.showImageViewer = false;\n      this.selectedImage = null;\n    },\n    handleImageError(event, imageType) {\n      console.error(`‚ùå Failed to load ${imageType} image:`, event.target.src);\n\n      // Hide the broken image\n      event.target.style.display = 'none';\n\n      // Show error message to user\n      const container = event.target.closest('.verification-image-container');\n      if (container && !container.querySelector('.image-error-message')) {\n        const errorDiv = document.createElement('div');\n        errorDiv.className = 'image-error-message';\n        errorDiv.innerHTML = `\n          <i class=\"fas fa-exclamation-triangle text-warning\"></i>\n          <span>Unable to load ${imageType} image</span>\n          <small class=\"d-block mt-1\">Authentication or network error</small>\n        `;\n        container.appendChild(errorDiv);\n      }\n    },\n    handleImageLoad(event, imageType) {\n      console.log(`‚úÖ Successfully loaded ${imageType} image:`, event.target.src);\n    },\n    showToast(title, message, type = 'info') {\n      // Log to console for debugging\n      console.log(`[${type.toUpperCase()}] ${title}: ${message}`);\n\n      // Create a simple toast notification\n      const toast = document.createElement('div');\n      toast.className = `toast-notification toast-${type}`;\n      toast.innerHTML = `\n        <div class=\"toast-header\">\n          <strong>${title}</strong>\n          <button type=\"button\" class=\"toast-close\" onclick=\"this.parentElement.parentElement.remove()\">√ó</button>\n        </div>\n        <div class=\"toast-body\">${message}</div>\n      `;\n\n      // Add toast styles if not already added\n      if (!document.getElementById('toast-styles')) {\n        const styles = document.createElement('style');\n        styles.id = 'toast-styles';\n        styles.textContent = `\n          .toast-notification {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            min-width: 300px;\n            background: white;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            z-index: 9999;\n            animation: slideIn 0.3s ease;\n          }\n          .toast-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px 8px;\n            border-bottom: 1px solid #e9ecef;\n          }\n          .toast-body {\n            padding: 8px 16px 12px;\n            color: #6c757d;\n          }\n          .toast-close {\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            color: #6c757d;\n          }\n          .toast-success { border-left: 4px solid #28a745; }\n          .toast-error { border-left: 4px solid #dc3545; }\n          .toast-info { border-left: 4px solid #17a2b8; }\n          .toast-warning { border-left: 4px solid #ffc107; }\n          @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n          }\n        `;\n        document.head.appendChild(styles);\n      }\n\n      // Add toast to page\n      document.body.appendChild(toast);\n\n      // Auto-remove after 5 seconds\n      setTimeout(() => {\n        if (toast.parentElement) {\n          toast.style.animation = 'slideIn 0.3s ease reverse';\n          setTimeout(() => toast.remove(), 300);\n        }\n      }, 5000);\n    }\n  }\n};","map":{"version":3,"names":["documentRequestService","clientAuthService","ImageViewer","name","components","data","request","loading","error","showImageViewer","selectedImage","imageObjectUrls","Map","imageUrls","beneficiaryVerification","pickupId","authorizationLetter","progressSteps","status","title","description","icon","computed","clientData","getCurrentUser","mounted","loadRequestDetails","beforeUnmount","cleanupImageUrls","methods","requestId","$route","params","id","response","getRequestDetails","console","log","requestor","nationality","months_of_residency","years_of_residency","beneficiary","beneficiary_verification_image","verification_image_path","authorized_pickup","pickup_id_image","id_image_path","hasAuthorizedPickup","authorizedPickupData","pickupIdImagePath","authorizationLetterPath","authorization_letter_path","loadImages","message","authToken","localStorage","getItem","sessionStorage","warn","showToast","imageUrl","getVerificationImageUrl","getPlaceholderImageUrl","includes","path","filename","split","pop","getPickupIdImageUrl","getAuthorizationLetterUrl","key","url","URL","revokeObjectURL","clear","getDocumentIcon","type","icons","getStatusClass","classes","formatStatus","statusMap","getPaymentStatusClass","formatPaymentStatus","getMainTimelineSteps","steps","isCashPayment","payment_method","payment_method_code","payment_method_id","is_online_payment","is_online","approvedStepIndex","findIndex","step","isStepCompleted","stepStatus","currentStatus","completedBeforeRejection","statusOrder","stepIndex","indexOf","currentIndex","getFullName","client","profile","first_name","middle_name","last_name","trim","getClientEmail","email","getClientPhone","phone","phone_number","getEmergencyContact","contact","emergency_contact_name","getEmergencyPhone","emergency_contact_phone","getFullAddress","parts","house_number","requestor_house_number","street","requestor_street","subdivision","barangay","requestor_barangay","city_municipality","requestor_city_municipality","city","province","requestor_province","filter","part","length","join","getClientUsername","client_username","username","getClientEmailVerified","email_verified","getClientPhoneVerified","phone_verified","getClientProfileVerified","is_verified","getClientResidencyVerified","residency_verified","getClientAccountStatus","getClientLastLogin","last_login","getClientCreatedAt","created_at","getClientBirthDate","birth_date","requestor_birth_date","getClientGender","gender","requestor_gender","getClientCivilStatus","civil_status_id","requestor_civil_status_id","getClientNationality","requestor_nationality","getClientAccountStatusClass","formatAccountStatus","formatGender","charAt","toUpperCase","slice","getCivilStatusName","statusId","statuses","getResidencyDisplay","years","months","push","formatDate","dateString","Date","toLocaleDateString","year","month","day","hour","minute","formatCurrency","amount","parseFloat","toFixed","canCancelRequest","cancellableStatuses","needsPayment","paymentRequiredStatuses","unpaidStatuses","undefined","payment_status","canDownload","cancelRequest","reason","prompt","confirm","cancellationReason","$toast","success","processPayment","currentUser","$clientAuth","paymentData","request_id","customer_email","default","paymentService","initiatePayment","checkout_url","redirectToPayMongo","Error","errorMessage","downloadDocument","printDetails","window","print","goBack","$router","getBeneficiaryFullName","b","getBeneficiaryAddress","imagePath","cacheKey","has","get","originalPath","extractedFilename","finalApiUrl","objectUrl","getVerificationImageObjectUrl","set","getVerificationStatusClass","formatVerificationStatus","getAuthorizedPickupFullName","p","openImageModal","imageName","imageType","substring","isBlobUrl","startsWith","isDataUrl","isPlaceholder","downloadUrl","closeImageViewer","handleImageError","event","target","src","style","display","container","closest","querySelector","errorDiv","document","createElement","className","innerHTML","appendChild","handleImageLoad","toast","getElementById","styles","textContent","head","body","setTimeout","parentElement","animation","remove"],"sources":["D:\\brgy_docu_hub\\BOSFDR\\src\\components\\client\\RequestDetails.vue"],"sourcesContent":["<template>\n  <div class=\"request-details-page\">\n    <!-- Header -->\n    <div class=\"page-header\">\n      <div class=\"header-content\">\n        <div class=\"header-main\">\n          <h1 class=\"page-title\">\n            <i class=\"fas fa-file-alt\"></i>\n            Request Details\n          </h1>\n          <p class=\"page-description\">\n            View detailed information about your document request\n          </p>\n        </div>\n        <div class=\"header-actions\">\n          <button class=\"back-btn\" @click=\"goBack\">\n            <i class=\"fas fa-arrow-left\"></i>\n            Back to Requests\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Page Content -->\n    <div class=\"page-content\">\n      <!-- Loading State -->\n    <div v-if=\"loading\" class=\"loading-container\">\n      <div class=\"loading-spinner\">\n        <i class=\"fas fa-spinner fa-spin\"></i>\n      </div>\n      <p>Loading request details...</p>\n    </div>\n\n    <!-- Error State -->\n    <div v-else-if=\"error\" class=\"error-container\">\n      <div class=\"error-content\">\n        <i class=\"fas fa-exclamation-triangle\"></i>\n        <h3>Unable to Load Request</h3>\n        <p>{{ error }}</p>\n        <button class=\"retry-btn\" @click=\"loadRequestDetails\">\n          <i class=\"fas fa-redo\"></i>\n          Try Again\n        </button>\n      </div>\n    </div>\n\n    <!-- Request Details -->\n    <div v-else-if=\"request\" class=\"request-container\">\n      <!-- Request Overview -->\n      <div class=\"request-overview\">\n        <div class=\"overview-header\">\n          <div class=\"request-type\">\n            <i :class=\"getDocumentIcon(request.document_type)\"></i>\n            <div>\n              <h2>{{ request.document_type }}</h2>\n              <p class=\"request-id\">Request #{{ request.id.toString().padStart(6, '0') }}</p>\n            </div>\n          </div>\n          <div class=\"request-status\">\n            <span class=\"status-badge\" :class=\"getStatusClass(request.status)\">\n              {{ formatStatus(request.status) }}\n            </span>\n          </div>\n        </div>\n\n        <div class=\"overview-grid\">\n          <div class=\"overview-item\">\n            <label>Submitted Date:</label>\n            <span>{{ formatDate(request.created_at) }}</span>\n          </div>\n          <div class=\"overview-item\">\n            <label>Last Updated:</label>\n            <span>{{ formatDate(request.updated_at) }}</span>\n          </div>\n          <div class=\"overview-item\">\n            <label>Purpose:</label>\n            <span>{{ request.purpose_category || 'Not specified' }}</span>\n          </div>\n          <div class=\"overview-item\">\n            <label>Total Fee:</label>\n            <span class=\"amount\">‚Ç±{{ formatCurrency(request.total_fee) }}</span>\n          </div>\n        </div>\n\n        <!-- Progress Timeline -->\n        <div class=\"progress-timeline\">\n          <h3>Request Progress</h3>\n\n          <!-- Main Timeline -->\n          <div class=\"timeline\">\n            <div\n              v-for=\"(step, index) in getMainTimelineSteps()\"\n              :key=\"index\"\n              class=\"timeline-item\"\n              :class=\"{\n                active: step.status === request.status,\n                completed: isStepCompleted(step.status, request.status)\n              }\"\n            >\n              <div class=\"timeline-icon\">\n                <i :class=\"step.icon\"></i>\n              </div>\n              <div class=\"timeline-content\">\n                <h4>{{ step.title }}</h4>\n                <p>{{ step.description }}</p>\n                <span v-if=\"step.status === request.status\" class=\"timeline-date\">\n                  {{ formatDate(request.updated_at) }}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <!-- Rejection Branch (only show if rejected) -->\n          <div v-if=\"request.status === 'rejected'\" class=\"rejection-branch\">\n            <div class=\"branch-connector\"></div>\n            <div class=\"timeline-item rejected active\">\n              <div class=\"timeline-icon\">\n                <i class=\"fas fa-times-circle\"></i>\n              </div>\n              <div class=\"timeline-content\">\n                <h4>Request Rejected</h4>\n                <p>Your request has been rejected by our staff</p>\n                <span class=\"timeline-date\">{{ formatDate(request.updated_at) }}</span>\n                <div v-if=\"request.rejection_reason\" class=\"rejection-reason\">\n                  <i class=\"fas fa-info-circle\"></i>\n                  <strong>Reason:</strong> {{ request.rejection_reason }}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Request Information -->\n      <div class=\"request-info-section\">\n        <h3>Request Information</h3>\n        \n        <!-- Personal Information -->\n        <div class=\"info-card\">\n          <h4>\n            <i class=\"fas fa-user me-2\"></i>\n            Requestor Information\n          </h4>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <label>Full Name:</label>\n              <span>{{ getFullName() }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Username:</label>\n              <span>{{ getClientUsername() || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\" v-if=\"getClientEmail()\">\n              <label>Email:</label>\n              <span>{{ getClientEmail() }}</span>\n            </div>\n\n            <!-- I will comment the email for now -->\n            <!-- <div class=\"info-item\">\n              <label>Email Verified:</label>\n              <span class=\"badge\" :class=\"getClientEmailVerified() ? 'bg-success' : 'bg-warning'\">\n                {{ getClientEmailVerified() ? 'Verified' : 'Not Verified' }}\n              </span>\n            </div> -->\n            <div class=\"info-item\">\n              <label>Phone:</label>\n              <span>{{ getClientPhone() }}</span>\n            </div>\n\n            <!-- I will comment the Phone for now -->\n            <!-- <div class=\"info-item\">\n              <label>Phone Verified:</label>\n              <span class=\"badge\" :class=\"getClientPhoneVerified() ? 'bg-success' : 'bg-warning'\">\n                {{ getClientPhoneVerified() ? 'Verified' : 'Not Verified' }}\n              </span>\n            </div> -->\n\n            <div class=\"info-item\">\n              <label>Date of Birth:</label>\n              <span>{{ formatDate(getClientBirthDate()) || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Gender:</label>\n              <span>{{ formatGender(getClientGender()) || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Civil Status:</label>\n              <span>{{ getCivilStatusName(getClientCivilStatus()) || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Nationality:</label>\n              <span v-if=\"request && request.requestor\">{{ request.requestor.nationality || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Address:</label>\n              <span v-if=\"request && request.requestor\">{{ request.requestor.address || 'Not provided' }}</span>\n            </div>\n\n            <div class=\"info-item\">\n              <label>Years of Residency:</label>\n              <span>{{ getResidencyDisplay() || 'Not provided' }}</span>\n            </div>\n\n            <!-- I will comment the Profile Verified for now -->\n            <!-- <div class=\"info-item\">\n              <label>Profile Verified:</label>\n              <span class=\"badge\" :class=\"getClientProfileVerified() ? 'bg-success' : 'bg-warning'\">\n                {{ getClientProfileVerified() ? 'Verified' : 'Pending Verification' }}\n              </span>\n            </div> -->\n\n            <!-- I will comment the Residency Verified for now -->\n            <!-- <div class=\"info-item\">\n              <label>Residency Verified:</label>\n              <span class=\"badge\" :class=\"getClientResidencyVerified() ? 'bg-success' : 'bg-warning'\">\n                {{ getClientResidencyVerified() ? 'Verified' : 'Pending Verification' }}\n              </span>\n            </div> -->\n\n            <!-- I will comment the Account Status for now -->\n            <!-- <div class=\"info-item\">\n              <label>Account Status:</label>\n              <span class=\"badge\" :class=\"getClientAccountStatusClass()\">\n                {{ formatAccountStatus(getClientAccountStatus()) }}\n              </span>\n            </div> -->\n\n            <div v-if=\"getClientLastLogin()\" class=\"info-item\">\n              <label>Last Login:</label>\n              <span>{{ formatDate(getClientLastLogin()) }}</span>\n            </div>\n\n            <!-- I will comment the Account Created for now -->\n            <!-- <div class=\"info-item\">\n              <label>Account Created:</label>\n              <span>{{ formatDate(getClientCreatedAt()) || 'Not available' }}</span>\n            </div> -->\n\n          </div>\n        </div>\n\n        <!-- Beneficiary Information (for \"For Someone Else\" requests) -->\n        <div v-if=\"request.is_third_party_request && request.beneficiary\" class=\"info-card\">\n          <h4>\n            <i class=\"fas fa-user-friends me-2\"></i>\n            Beneficiary Information (For Someone Else)\n          </h4>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <label>Full Name:</label>\n              <span>{{ getBeneficiaryFullName() }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Relationship to Requestor:</label>\n              <span>{{ request.beneficiary.relationship_to_requestor || 'Not specified' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Email:</label>\n              <span>{{ request.beneficiary.email || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Phone:</label>\n              <span>{{ request.beneficiary.phone_number || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Date of Birth:</label>\n              <span>{{ formatDate(request.beneficiary.birth_date) || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Gender:</label>\n              <span>{{ formatGender(request.beneficiary.gender) || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Civil Status:</label>\n              <span>{{ getCivilStatusName(request.beneficiary.civil_status_id) || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Nationality:</label>\n              <span>{{ request.beneficiary.nationality || 'Not provided' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Address:</label>\n              <span>{{ getBeneficiaryAddress() }}</span>\n            </div>\n\n            <div v-if=\"request.beneficiary.verification_image_path\" class=\"info-item\">\n              <label>Verification Document:</label>\n              <div class=\"verification-image-container\">\n                <img\n                  v-if=\"imageUrls.beneficiaryVerification\"\n                  :src=\"imageUrls.beneficiaryVerification\"\n                  :alt=\"request.beneficiary.verification_image_name || 'Verification Document'\"\n                  class=\"verification-image\"\n                  @click=\"openImageModal(request.beneficiary.verification_image_path, request.beneficiary.verification_image_name, 'beneficiaries')\"\n                  @error=\"handleImageError($event, 'beneficiary verification')\"\n                  @load=\"handleImageLoad($event, 'beneficiary verification')\"\n                >\n                <div v-else class=\"image-loading\">\n                  <i class=\"fas fa-spinner fa-spin\"></i>\n                  <span>Loading image...</span>\n                </div>\n\n                <!-- I will comment the Verification Status for now -->\n                <!-- <div class=\"verification-status\">\n                  <span class=\"badge\" :class=\"getVerificationStatusClass(request.beneficiary.verification_status)\">\n                    {{ formatVerificationStatus(request.beneficiary.verification_status) }}\n                  </span>\n                </div> -->\n              </div>\n            </div>\n\n          </div>\n        </div>\n\n        <!-- Document Specific Information -->\n        <div class=\"info-card\">\n          <h4>{{ request.document_type }} Details</h4>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <label>Purpose Category:</label>\n              <span>{{ request.purpose_category || 'Not specified' }}</span>\n            </div>\n\n            <!-- I will comment purpose details for now  -->\n            <!-- <div class=\"info-item\">\n              <label>Purpose Details:</label>\n              <span>{{ request.purpose_details || 'General purpose' }}</span>\n            </div> -->\n\n            <!-- Barangay Clearance specific fields -->\n            <template v-if=\"request.document_type === 'Barangay Clearance'\">\n              <div class=\"info-item\" v-if=\"getEmergencyContact()\">\n                <label>Emergency Contact:</label>\n                <span>{{ getEmergencyContact() }}</span>\n              </div>\n              <div class=\"info-item\" v-if=\"getEmergencyPhone()\">\n                <label>Emergency Phone:</label>\n                <span>{{ getEmergencyPhone() }}</span>\n              </div>\n              <div class=\"info-item\">\n                <label>Pending Cases:</label>\n                <span>{{ request.has_pending_cases ? 'Yes' : 'No' }}</span>\n              </div>\n            </template>\n\n            <!-- Cedula specific fields -->\n            <template v-if=\"request.document_type === 'Cedula' && request.specific_details\">\n              <div class=\"info-item\">\n                <label>Annual Income:</label>\n                <span>‚Ç±{{ formatCurrency(request.specific_details.annual_income) }}</span>\n              </div>\n\n              <!-- I will not show this in frontend  -->\n              <!-- <div class=\"info-item\">\n                <label>Income Source:</label>\n                <span>{{ request.specific_details.income_source || 'Not specified' }}</span>\n              </div> -->\n\n              <!-- I will not show this in frontend  -->\n              <!-- <div class=\"info-item\">\n                <label>Real Property:</label>\n                <span>{{ request.specific_details.has_real_property ? 'Yes' : 'No' }}</span>\n              </div> -->\n\n              <!-- I will not show this in frontend  -->\n              <!-- <div v-if=\"request.specific_details.has_real_property\" class=\"info-item\">\n                <label>Property Value:</label>\n                <span>‚Ç±{{ formatCurrency(request.specific_details.property_value) }}</span>\n              </div> -->\n              <div v-if=\"request.specific_details.business_name\" class=\"info-item\">\n                <label>Business Name:</label>\n                <span>{{ request.specific_details.business_name }}</span>\n              </div>\n            </template>\n          </div>\n        </div>\n\n        <!-- Property Information Section (for Cedula only) -->\n        <div v-if=\"request.document_type === 'Cedula' && request.specific_details\" class=\"info-card\">\n          <h4>\n            <i class=\"fas fa-home me-2\"></i>\n            Property Information\n          </h4>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <label>Assessed Property Value:</label>\n              <span>‚Ç±{{ formatCurrency(request.specific_details.property_assessed_value || 0) }}</span>\n            </div>\n            <div v-if=\"request.specific_details.property_location\" class=\"info-item\">\n              <label>Property Location:</label>\n              <span>{{ request.specific_details.property_location }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Personal Property Value:</label>\n              <span>‚Ç±{{ formatCurrency(request.specific_details.personal_property_value || 0) }}</span>\n            </div>\n          </div>\n        </div>\n\n        <!-- Business Information Section (for Cedula only) -->\n        <div v-if=\"request.document_type === 'Cedula' && request.specific_details && (request.specific_details.business_name || request.specific_details.business_gross_receipts > 0)\" class=\"info-card\">\n          <h4>\n            <i class=\"fas fa-briefcase me-2\"></i>\n            Business/Professional Information\n          </h4>\n          <div class=\"info-grid\">\n            <div v-if=\"request.specific_details.business_name\" class=\"info-item\">\n              <label>Business Name:</label>\n              <span>{{ request.specific_details.business_name }}</span>\n            </div>\n            <div v-if=\"request.specific_details.business_type\" class=\"info-item\">\n              <label>Business Type:</label>\n              <span>{{ request.specific_details.business_type }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Annual Gross Receipts/Professional Fees:</label>\n              <span>‚Ç±{{ formatCurrency(request.specific_details.business_gross_receipts || 0) }}</span>\n            </div>\n            <div v-if=\"request.specific_details.business_address\" class=\"info-item\">\n              <label>Business Address:</label>\n              <span>{{ request.specific_details.business_address }}</span>\n            </div>\n          </div>\n        </div>\n\n        <!-- I will not show the Tax Computation in frontend  -->\n        <!-- Tax Computation Section (for Cedula only) -->\n        <!-- <div v-if=\"request.document_type === 'Cedula' && request.specific_details\" class=\"info-card\">\n          <h4>\n            <i class=\"fas fa-calculator me-2\"></i>\n            Tax Computation\n          </h4>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <label>Computed Tax:</label>\n              <span>‚Ç±{{ formatCurrency(request.specific_details.computed_tax || 0) }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Total Document Fee:</label>\n              <span class=\"text-success fw-bold\">‚Ç±{{ formatCurrency(request.total_document_fee || 0) }}</span>\n            </div>\n          </div>\n        </div> -->\n      </div>\n\n        <!-- Authorized Pickup Person Information -->\n        <div v-if=\"request.authorized_pickup\" class=\"info-card\">\n          <h4>\n            <i class=\"fas fa-user-check me-2\"></i>\n            Authorized Pickup Person\n          </h4>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <label>Full Name:</label>\n              <span>{{ getAuthorizedPickupFullName() }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Relationship to Beneficiary:</label>\n              <span>{{ request.authorized_pickup.relationship_to_beneficiary || 'Not specified' }}</span>\n            </div>\n            <div class=\"info-item\">\n              <label>Phone Number:</label>\n              <span>{{ request.authorized_pickup.phone_number || 'Not provided' }}</span>\n            </div>\n            \n            <!-- I will comment the Email for now -->\n            <!-- <div class=\"info-item\">\n              <label>Email:</label>\n              <span>{{ request.authorized_pickup.email || 'Not provided' }}</span>\n            </div> -->\n\n            <!-- I will comment the ID Type for now -->\n            <!-- <div v-if=\"request.authorized_pickup.id_type\" class=\"info-item\">\n              <label>ID Type:</label>\n              <span>{{ request.authorized_pickup.id_type }}</span>\n            </div>\n            <div v-if=\"request.authorized_pickup.id_number\" class=\"info-item\">\n              <label>ID Number:</label>\n              <span>{{ request.authorized_pickup.id_number }}</span>\n            </div>\n            <div v-if=\"request.authorized_pickup.id_expiry_date\" class=\"info-item\">\n              <label>ID Expiry Date:</label>\n              <span>{{ formatDate(request.authorized_pickup.id_expiry_date) }}</span>\n            </div> -->\n\n            <!-- I will comment the Verification Status for now -->\n            <!-- <div class=\"info-item\">\n              <label>Verification Status:</label>\n              <span class=\"badge\" :class=\"getVerificationStatusClass(request.authorized_pickup.is_verified ? 'approved' : 'pending')\">\n                {{ request.authorized_pickup.is_verified ? 'Verified' : 'Pending Verification' }}\n              </span>\n            </div> -->\n\n            <div v-if=\"request.authorized_pickup.id_image_path\" class=\"info-item\">\n              <label>ID Document:</label>\n              <div class=\"verification-image-container\">\n                <img\n                  v-if=\"imageUrls.pickupId\"\n                  :src=\"imageUrls.pickupId\"\n                  :alt=\"request.authorized_pickup.id_image_name || 'ID Document'\"\n                  class=\"verification-image\"\n                  @click=\"openImageModal(request.authorized_pickup.id_image_path, request.authorized_pickup.id_image_name, 'pickup_id')\"\n                  @error=\"handleImageError($event, 'pickup ID')\"\n                  @load=\"handleImageLoad($event, 'pickup ID')\"\n                >\n                <div v-else class=\"image-loading\">\n                  <i class=\"fas fa-spinner fa-spin\"></i>\n                  <span>Loading image...</span>\n                </div>\n              </div>\n            </div>\n\n            <div v-if=\"request.authorized_pickup.authorization_letter_path\" class=\"info-item\">\n              <label>Authorization Letter:</label>\n              <div class=\"verification-image-container\">\n                <img\n                  v-if=\"imageUrls.authorizationLetter\"\n                  :src=\"imageUrls.authorizationLetter\"\n                  alt=\"Authorization Letter\"\n                  class=\"verification-image\"\n                  @click=\"openImageModal(request.authorized_pickup.authorization_letter_path, 'Authorization Letter', 'pickup_authorization')\"\n                  @error=\"handleImageError($event, 'authorization letter')\"\n                  @load=\"handleImageLoad($event, 'authorization letter')\"\n                >\n                <div v-else class=\"image-loading\">\n                  <i class=\"fas fa-spinner fa-spin\"></i>\n                  <span>Loading image...</span>\n                </div>\n              </div>\n            </div>\n\n          </div>\n        </div>\n\n        <!-- Payment Information -->\n        <div class=\"info-card\">\n          <h4>Payment Information</h4>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <label>Payment Method:</label>\n              <span>{{ request.payment_method || 'Not selected' }}</span>\n            </div>\n\n            <!-- I will not show this in frontend  -->\n            <!-- <div class=\"info-item\">\n              <label>Payment Status:</label>\n              <span class=\"payment-status\" :class=\"getPaymentStatusClass(request.payment_status)\">\n                {{ formatPaymentStatus(request.payment_status) }}\n              </span>\n            </div> -->\n            <div class=\"info-item\">\n              <label>Total Fee:</label>\n              <span class=\"amount\">‚Ç±{{ formatCurrency(request.total_fee) }}</span>\n            </div>\n            <div v-if=\"request.payment_date\" class=\"info-item\">\n              <label>Payment Date:</label>\n              <span>{{ formatDate(request.payment_date) }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Actions -->\n      <div class=\"request-actions\">\n        <button \n          v-if=\"canCancelRequest(request.status)\"\n          class=\"action-btn cancel-btn\"\n          @click=\"cancelRequest\"\n        >\n          <i class=\"fas fa-times\"></i>\n          Cancel Request\n        </button>\n\n        <button \n          v-if=\"needsPayment(request)\"\n          class=\"action-btn pay-btn\"\n          @click=\"processPayment\"\n        >\n          <i class=\"fas fa-credit-card\"></i>\n          Pay Now\n        </button>\n\n        <!-- I will comment this, I dont need this for now -->\n        <!-- <button \n          v-if=\"canDownload(request.status)\"\n          class=\"action-btn download-btn\"\n          @click=\"downloadDocument\"\n        >\n          <i class=\"fas fa-download\"></i>\n          Download Document\n        </button> -->\n\n        <!-- I will comment this, I dont need this for now -->x\n        <!-- <button class=\"action-btn print-btn\" @click=\"printDetails\">\n          <i class=\"fas fa-print\"></i>\n          Print Details\n        </button> -->\n      </div>\n\n      <!-- Admin Notes (if any) -->\n      <div v-if=\"request.admin_notes\" class=\"admin-notes\">\n        <h3>Admin Notes</h3>\n        <div class=\"notes-content\">\n          <p>{{ request.admin_notes }}</p>\n          <span class=\"notes-date\">{{ formatDate(request.updated_at) }}</span>\n        </div>\n      </div>\n    </div> <!-- End page-content -->\n\n    <!-- Image Viewer Modal -->\n    <ImageViewer\n      v-if=\"showImageViewer && selectedImage\"\n      :imageUrl=\"selectedImage.url\"\n      :title=\"selectedImage.title\"\n      :filename=\"selectedImage.filename\"\n      :imageType=\"selectedImage.type\"\n      :downloadUrl=\"selectedImage.downloadUrl\"\n      @close=\"closeImageViewer\"\n    />\n  </div>\n</template>\n\n<script>\nimport documentRequestService from '@/services/documentRequestService';\nimport clientAuthService from '@/services/clientAuthService';\nimport ImageViewer from '@/components/common/ImageViewer.vue';\n\nexport default {\n  name: 'RequestDetails',\n  components: {\n    ImageViewer\n  },\n  data() {\n    return {\n      request: null,\n      loading: true,\n      error: null,\n      showImageViewer: false,\n      selectedImage: null,\n      imageObjectUrls: new Map(), // Track created object URLs for cleanup\n      imageUrls: {\n        beneficiaryVerification: '',\n        pickupId: '',\n        authorizationLetter: ''\n      }, // Store loaded image URLs for template binding\n      progressSteps: [\n        {\n          status: 'pending',\n          title: 'Request Submitted',\n          description: 'Your request has been submitted and is waiting for review',\n          icon: 'fas fa-paper-plane'\n        },\n        {\n          status: 'under_review',\n          title: 'Under Review',\n          description: 'Your request is being reviewed by our staff',\n          icon: 'fas fa-search'\n        },\n        {\n          status: 'approved',\n          title: 'Approved',\n          description: 'Your request has been approved and payment is required',\n          icon: 'fas fa-check'\n        },\n        {\n          status: 'processing',\n          title: 'Processing',\n          description: 'Your document is being prepared',\n          icon: 'fas fa-cog'\n        },\n        {\n          status: 'ready_for_pickup',\n          title: 'Ready for Pickup',\n          description: 'Your document is ready for pickup',\n          icon: 'fas fa-box'\n        },\n        {\n          status: 'completed',\n          title: 'Completed',\n          description: 'Request has been completed successfully',\n          icon: 'fas fa-check-circle'\n        }\n      ]\n    };\n  },\n  computed: {\n    clientData() {\n      return clientAuthService.getCurrentUser();\n    }\n  },\n  async mounted() {\n    await this.loadRequestDetails();\n  },\n  beforeUnmount() {\n    // Clean up object URLs to prevent memory leaks\n    this.cleanupImageUrls();\n  },\n  methods: {\n    async loadRequestDetails() {\n      try {\n        this.loading = true;\n        this.error = null;\n        \n        const requestId = this.$route.params.id;\n        const response = await documentRequestService.getRequestDetails(requestId);\n        this.request = response.data;\n        \n        // Debug: Log the received request data\n        console.log('üîç Frontend received request data:', {\n          id: this.request?.id,\n          requestor: this.request?.requestor,\n          nationality: this.request?.requestor?.nationality,\n          months_of_residency: this.request?.requestor?.months_of_residency,\n          years_of_residency: this.request?.requestor?.years_of_residency,\n          beneficiary: this.request?.beneficiary,\n          beneficiary_verification_image: this.request?.beneficiary?.verification_image_path,\n          authorized_pickup: this.request?.authorized_pickup,\n          pickup_id_image: this.request?.authorized_pickup?.id_image_path\n        });\n\n        // Debug: Log the request data to see what's available\n        console.log('üîç Request data loaded:', {\n          hasAuthorizedPickup: !!this.request.authorized_pickup,\n          authorizedPickupData: this.request.authorized_pickup,\n          pickupIdImagePath: this.request.authorized_pickup?.id_image_path,\n          authorizationLetterPath: this.request.authorized_pickup?.authorization_letter_path\n        });\n\n        // Load images after request details are loaded\n        await this.loadImages();\n\n      } catch (error) {\n        console.error('Error loading request details:', error);\n        this.error = error.response?.data?.message || 'Failed to load request details';\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async loadImages() {\n      // Check if user is authenticated\n      const authToken = localStorage.getItem('auth_token') || sessionStorage.getItem('auth_token');\n      if (!authToken) {\n        console.warn('‚ö†Ô∏è User not authenticated, skipping image loading');\n        this.showToast('Warning', 'Please log in to view verification images', 'warning');\n        return;\n      }\n\n      console.log('üñºÔ∏è Starting image loading process...');\n\n      // Load beneficiary verification image\n      if (this.request?.beneficiary?.verification_image_path) {\n        try {\n          console.log('üì∏ Loading beneficiary verification image...');\n          const imageUrl = await this.getVerificationImageUrl(this.request.beneficiary.verification_image_path);\n          if (imageUrl && imageUrl !== this.getPlaceholderImageUrl()) {\n            this.imageUrls.beneficiaryVerification = imageUrl;\n            console.log('‚úÖ Beneficiary verification image loaded successfully');\n          } else {\n            this.imageUrls.beneficiaryVerification = this.getPlaceholderImageUrl();\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to load beneficiary verification image:', error.message);\n          this.imageUrls.beneficiaryVerification = this.getPlaceholderImageUrl();\n          if (error.message.includes('log in')) {\n            this.showToast('Warning', 'Please log in to view images', 'warning');\n          }\n        }\n      }\n\n      // Load pickup ID image\n      if (this.request?.authorized_pickup?.id_image_path) {\n        try {\n          console.log('üì∏ Loading pickup ID image...', {\n            path: this.request.authorized_pickup.id_image_path,\n            filename: this.request.authorized_pickup.id_image_path.split(/[/\\\\]/).pop()\n          });\n          const imageUrl = await this.getPickupIdImageUrl(this.request.authorized_pickup.id_image_path);\n          if (imageUrl && imageUrl !== this.getPlaceholderImageUrl()) {\n            this.imageUrls.pickupId = imageUrl;\n            console.log('‚úÖ Pickup ID image loaded successfully');\n          } else {\n            this.imageUrls.pickupId = this.getPlaceholderImageUrl();\n            console.log('‚ö†Ô∏è Using placeholder for pickup ID image');\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to load pickup ID image:', error.message);\n          this.imageUrls.pickupId = this.getPlaceholderImageUrl();\n          if (error.message.includes('log in')) {\n            this.showToast('Warning', 'Please log in to view images', 'warning');\n          }\n        }\n      } else {\n        console.log('‚ö†Ô∏è No pickup ID image path found in request data');\n      }\n\n      // Load authorization letter image\n      if (this.request?.authorized_pickup?.authorization_letter_path) {\n        try {\n          console.log('üì∏ Loading authorization letter image...');\n          const imageUrl = await this.getAuthorizationLetterUrl(this.request.authorized_pickup.authorization_letter_path);\n          if (imageUrl && imageUrl !== this.getPlaceholderImageUrl()) {\n            this.imageUrls.authorizationLetter = imageUrl;\n            console.log('‚úÖ Authorization letter image loaded successfully');\n          } else {\n            this.imageUrls.authorizationLetter = this.getPlaceholderImageUrl();\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to load authorization letter image:', error.message);\n          this.imageUrls.authorizationLetter = this.getPlaceholderImageUrl();\n          if (error.message.includes('log in')) {\n            this.showToast('Warning', 'Please log in to view images', 'warning');\n          }\n        }\n      }\n\n      console.log('üñºÔ∏è Image loading process completed');\n    },\n\n    cleanupImageUrls() {\n      // Revoke all object URLs to prevent memory leaks\n      for (const [key, url] of this.imageObjectUrls) {\n        URL.revokeObjectURL(url);\n        console.log('üßπ Cleaned up object URL:', key);\n      }\n      this.imageObjectUrls.clear();\n    },\n\n    getDocumentIcon(type) {\n      const icons = {\n        'Barangay Clearance': 'fas fa-certificate',\n        'Cedula': 'fas fa-id-card'\n      };\n      return icons[type] || 'fas fa-file-alt';\n    },\n\n    getStatusClass(status) {\n      const classes = {\n        'pending': 'status-pending',\n        'under_review': 'status-review',\n        'approved': 'status-approved',\n        'processing': 'status-processing',\n        'ready_for_pickup': 'status-ready',\n        'completed': 'status-completed',\n        'rejected': 'status-rejected',\n        'cancelled': 'status-cancelled'\n      };\n      return classes[status] || 'status-unknown';\n    },\n\n    formatStatus(status) {\n      const statusMap = {\n        'pending': 'Pending',\n        'under_review': 'Under Review',\n        'approved': 'Approved',\n        'processing': 'Processing',\n        'ready_for_pickup': 'Ready for Pickup',\n        'completed': 'Completed',\n        'rejected': 'Rejected',\n        'cancelled': 'Cancelled'\n      };\n      return statusMap[status] || status;\n    },\n\n    getPaymentStatusClass(status) {\n      const classes = {\n        'pending': 'payment-pending',\n        'paid': 'payment-paid',\n        'failed': 'payment-failed',\n        'refunded': 'payment-refunded'\n      };\n      return classes[status] || 'payment-unknown';\n    },\n\n    formatPaymentStatus(status) {\n      const statusMap = {\n        'pending': 'Pending Payment',\n        'paid': 'Paid',\n        'failed': 'Payment Failed',\n        'refunded': 'Refunded'\n      };\n      return statusMap[status] || 'Not Required';\n    },\n\n    getMainTimelineSteps() {\n      // Create a copy of progress steps to modify for cash payments\n      const steps = [...this.progressSteps];\n\n      // Check if this is a cash payment\n      const isCashPayment = this.request &&\n        (this.request.payment_method === 'Cash Payment' ||\n         this.request.payment_method === 'Cash' ||\n         this.request.payment_method_code === 'CASH' ||\n         this.request.payment_method_id === 1 ||\n         this.request.is_online_payment === false ||\n         this.request.is_online_payment === 0 ||\n         this.request.is_online === false ||\n         this.request.is_online === 0);\n\n      // Modify the \"approved\" step description for cash payments\n      if (isCashPayment) {\n        const approvedStepIndex = steps.findIndex(step => step.status === 'approved');\n        if (approvedStepIndex !== -1) {\n          steps[approvedStepIndex] = {\n            ...steps[approvedStepIndex],\n            description: 'Your request has been approved. Payment will be collected during pickup.'\n          };\n        }\n      }\n\n      return steps;\n    },\n\n    isStepCompleted(stepStatus, currentStatus) {\n      // Don't mark any steps as completed if the request is rejected\n      if (currentStatus === 'rejected') {\n        // Only mark steps before \"under_review\" as completed for rejected requests\n        const completedBeforeRejection = ['pending'];\n        return completedBeforeRejection.includes(stepStatus);\n      }\n\n      const statusOrder = ['pending', 'under_review', 'approved', 'processing', 'ready_for_pickup', 'completed'];\n      const stepIndex = statusOrder.indexOf(stepStatus);\n      const currentIndex = statusOrder.indexOf(currentStatus);\n      return stepIndex < currentIndex;\n    },\n\n    getFullName() {\n      const client = this.request?.client || this.clientData?.profile;\n      if (!client) return 'N/A';\n      return `${client.first_name || ''} ${client.middle_name || ''} ${client.last_name || ''}`.trim();\n    },\n\n    getClientEmail() {\n      const email = this.request?.email || this.request?.client?.email || this.clientData?.profile?.email;\n      return email && email.trim() ? email : null;\n    },\n\n    getClientPhone() {\n      const phone = this.request?.phone_number || this.request?.client?.phone_number || this.clientData?.profile?.phone_number;\n      return phone && phone.trim() ? phone : 'Contact information not available';\n    },\n\n    getEmergencyContact() {\n      const contact = this.request?.emergency_contact_name;\n      return contact && contact.trim() ? contact : null;\n    },\n\n    getEmergencyPhone() {\n      const phone = this.request?.emergency_contact_phone;\n      return phone && phone.trim() ? phone : null;\n    },\n\n    getFullAddress() {\n      // Try multiple sources for address data\n      const client = this.request?.client || this.clientData || this.request;\n      if (!client) return 'Address not available';\n\n      const parts = [\n        client.house_number || client.requestor_house_number,\n        client.street || client.requestor_street,\n        client.subdivision,\n        client.barangay || client.requestor_barangay,\n        client.city_municipality || client.requestor_city_municipality || client.city,\n        client.province || client.requestor_province\n      ].filter(part => part && part.trim());\n\n      return parts.length > 0 ? parts.join(', ') : 'Address not available';\n    },\n\n    // New helper methods for complete client information\n    getClientUsername() {\n      return this.request?.client_username || this.request?.client?.username || this.clientData?.username;\n    },\n\n    getClientEmailVerified() {\n      return this.request?.email_verified || this.request?.client?.email_verified || this.clientData?.email_verified || false;\n    },\n\n    getClientPhoneVerified() {\n      return this.request?.phone_verified || this.request?.client?.phone_verified || this.clientData?.phone_verified || false;\n    },\n\n    getClientProfileVerified() {\n      return this.request?.is_verified || this.request?.client?.is_verified || this.clientData?.is_verified || false;\n    },\n\n    getClientResidencyVerified() {\n      return this.request?.residency_verified || this.request?.client?.residency_verified || this.clientData?.residency_verified || false;\n    },\n\n    getClientAccountStatus() {\n      return this.request?.status || this.request?.client?.status || this.clientData?.status || 'unknown';\n    },\n\n    getClientLastLogin() {\n      return this.request?.last_login || this.request?.client?.last_login || this.clientData?.last_login;\n    },\n\n    getClientCreatedAt() {\n      return this.request?.created_at || this.request?.client?.created_at || this.clientData?.created_at;\n    },\n\n    getClientBirthDate() {\n      return this.request?.birth_date || this.request?.requestor_birth_date || this.request?.client?.birth_date || this.clientData?.birth_date;\n    },\n\n    getClientGender() {\n      return this.request?.gender || this.request?.requestor_gender || this.request?.client?.gender || this.clientData?.gender;\n    },\n\n    getClientCivilStatus() {\n      return this.request?.civil_status_id || this.request?.requestor_civil_status_id || this.request?.client?.civil_status_id || this.clientData?.civil_status_id;\n    },\n\n    getClientNationality() {\n      return this.request?.requestor?.nationality || this.request?.nationality || this.request?.requestor_nationality || this.request?.client?.nationality || this.clientData?.nationality;\n    },\n\n    getClientAccountStatusClass() {\n      const status = this.getClientAccountStatus();\n      const classes = {\n        'active': 'bg-success',\n        'inactive': 'bg-secondary',\n        'suspended': 'bg-danger',\n        'pending_verification': 'bg-warning',\n        'pending_residency_verification': 'bg-info'\n      };\n      return classes[status] || 'bg-secondary';\n    },\n\n    formatAccountStatus(status) {\n      const statusMap = {\n        'active': 'Active',\n        'inactive': 'Inactive',\n        'suspended': 'Suspended',\n        'pending_verification': 'Pending Verification',\n        'pending_residency_verification': 'Pending Residency Verification'\n      };\n      return statusMap[status] || status;\n    },\n\n    formatGender(gender) {\n      if (!gender) return 'Not provided';\n      return gender.charAt(0).toUpperCase() + gender.slice(1);\n    },\n\n    getCivilStatusName(statusId) {\n      const statuses = {\n        1: 'Single',\n        2: 'Married',\n        3: 'Divorced',\n        4: 'Widowed',\n        5: 'Separated'\n      };\n      return statuses[statusId] || 'Not provided';\n    },\n\n    getResidencyDisplay() {\n      if (!this.request || !this.request.requestor) {\n        return 'Not provided';\n      }\n\n      const years = this.request.requestor.years_of_residency || 0;\n      const months = this.request.requestor.months_of_residency || 0;\n\n      // If both are 0, return \"Not provided\"\n      if (years === 0 && months === 0) {\n        return 'Not provided';\n      }\n\n      const parts = [];\n      if (years > 0) parts.push(`${years} year${years > 1 ? 's' : ''}`);\n      if (months > 0) parts.push(`${months} month${months > 1 ? 's' : ''}`);\n\n      return parts.length > 0 ? parts.join(' and ') : 'Less than a month';\n    },\n\n    formatDate(dateString) {\n      if (!dateString) return 'N/A';\n      return new Date(dateString).toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    },\n\n    formatCurrency(amount) {\n      return parseFloat(amount || 0).toFixed(2);\n    },\n\n    canCancelRequest(status) {\n      // Enhanced cancellation rules - allow cancellation until payment is confirmed\n      const cancellableStatuses = [\n        'pending',\n        'under_review',\n        'additional_info_required',\n        'approved',\n        'payment_pending',\n        'payment_failed'\n      ];\n      return cancellableStatuses.includes(status);\n    },\n\n    needsPayment(request) {\n      // Check if request needs payment based on enhanced workflow\n      const paymentRequiredStatuses = ['approved', 'payment_pending', 'payment_failed'];\n      const unpaidStatuses = ['pending', 'failed', null, undefined, ''];\n\n      return paymentRequiredStatuses.includes(request.status) &&\n             unpaidStatuses.includes(request.payment_status) &&\n             request.payment_method_id && // Must have a payment method selected\n             request.is_online_payment; // Only show for online payment methods\n    },\n\n    canDownload(status) {\n      return status === 'completed';\n    },\n\n    async cancelRequest() {\n      // Enhanced cancellation with reason input\n      const reason = prompt(\n        'Please provide a reason for cancelling this request (optional):',\n        ''\n      );\n\n      // If user clicked cancel on the prompt, don't proceed\n      if (reason === null) return;\n\n      // Confirm cancellation\n      if (!confirm('Are you sure you want to cancel this request?')) return;\n\n      try {\n        console.log('üö´ Cancelling request:', this.request.id, 'Reason:', reason);\n\n        const cancellationReason = reason.trim() || 'Cancelled by user';\n        await documentRequestService.cancelRequest(this.request.id, cancellationReason);\n\n        this.$toast?.success('Request cancelled successfully. Administrators have been notified.');\n        this.request.status = 'cancelled';\n\n        // Refresh request details to show updated status\n        await this.loadRequestDetails();\n\n        console.log('‚úÖ Request cancelled successfully');\n      } catch (error) {\n        console.error('‚ùå Error cancelling request:', error);\n\n        // Show more specific error messages\n        if (error.response?.data?.message) {\n          this.$toast?.error(error.response.data.message);\n        } else if (error.message?.includes('cannot be cancelled')) {\n          this.$toast?.error('This request cannot be cancelled at its current stage');\n        } else {\n          this.$toast?.error('Failed to cancel request. Please try again.');\n        }\n      }\n    },\n\n    async processPayment() {\n      try {\n        // Check if request has a payment method selected\n        if (!this.request.payment_method_id) {\n          this.showToast('Error', 'No payment method selected for this request', 'error');\n          return;\n        }\n\n        // Check if it's an online payment method\n        if (!this.request.is_online_payment) {\n          this.showToast('Info', 'This request uses in-person payment. Please pay at the barangay office.', 'info');\n          return;\n        }\n\n        // Show loading state\n        this.showToast('Info', 'Initiating payment...', 'info');\n\n        // Get current user data from clientAuthService\n        const currentUser = this.$clientAuth.getCurrentUser();\n\n        // Prepare payment data\n        const paymentData = {\n          request_id: this.request.id,\n          payment_method_id: this.request.payment_method_id,\n          customer_email: currentUser?.email || this.request.email\n        };\n\n        // Import paymentService dynamically if not already imported\n        const { default: paymentService } = await import('@/services/paymentService');\n\n        // Initiate payment through PayMongo\n        const response = await paymentService.initiatePayment(paymentData);\n\n        if (response.success && response.data.checkout_url) {\n          // Redirect to PayMongo checkout page\n          this.showToast('Success', 'Redirecting to payment page...', 'success');\n          paymentService.redirectToPayMongo(response.data.checkout_url);\n        } else {\n          throw new Error(response.message || 'Failed to initiate payment');\n        }\n\n      } catch (error) {\n        console.error('Payment initiation error:', error);\n        const errorMessage = error.response?.data?.message || error.message || 'Failed to initiate payment';\n        this.showToast('Error', errorMessage, 'error');\n      }\n    },\n\n    downloadDocument() {\n      // TODO: Implement document download\n      console.log('Download document for request:', this.request.id);\n    },\n\n    printDetails() {\n      window.print();\n    },\n\n    goBack() {\n      this.$router.push({ name: 'MyRequests' });\n    },\n\n    // Beneficiary helper methods\n    getBeneficiaryFullName() {\n      if (!this.request?.beneficiary) return 'Not provided';\n      const b = this.request.beneficiary;\n      return `${b.first_name || ''} ${b.middle_name || ''} ${b.last_name || ''}`.trim();\n    },\n\n    getBeneficiaryAddress() {\n      if (!this.request?.beneficiary) return 'Not provided';\n      const b = this.request.beneficiary;\n      const parts = [\n        b.house_number,\n        b.street,\n        b.subdivision,\n        b.barangay,\n        b.city_municipality,\n        b.province\n      ].filter(part => part && part.trim());\n      return parts.length > 0 ? parts.join(', ') : 'Not provided';\n    },\n\n    async getVerificationImageUrl(imagePath) {\n      if (!imagePath) return this.getPlaceholderImageUrl();\n\n      // Extract filename from path\n      const filename = imagePath.split(/[/\\\\]/).pop();\n      const cacheKey = `beneficiary-${filename}`;\n\n      // Return cached URL if available\n      if (this.imageObjectUrls.has(cacheKey)) {\n        return this.imageObjectUrls.get(cacheKey);\n      }\n\n      try {\n        // Debug logging for path consistency\n        console.log('üîç Debug beneficiary verification image loading:', {\n          originalPath: imagePath,\n          extractedFilename: filename,\n          requestId: this.request.id,\n          finalApiUrl: `/client/document-requests/${this.request.id}/verification-image/beneficiary/${filename}`\n        });\n\n        // Fetch image as blob with authentication\n        const objectUrl = await documentRequestService.getVerificationImageObjectUrl(\n          this.request.id,\n          'beneficiary',\n          filename\n        );\n\n        // Cache the object URL\n        this.imageObjectUrls.set(cacheKey, objectUrl);\n        console.log('‚úÖ Created object URL for beneficiary verification image:', filename);\n        return objectUrl;\n      } catch (error) {\n        console.error('‚ùå Failed to load beneficiary verification image:', {\n          filename,\n          imagePath,\n          requestId: this.request.id,\n          error: error.message,\n          status: error.response?.status\n        });\n\n        // Show user-friendly error messages\n        if (error.message.includes('not found')) {\n          this.showToast('Warning', 'Verification image not found on server', 'warning');\n        } else if (error.message.includes('contact support')) {\n          this.showToast('Error', 'Server error - please contact support', 'error');\n        } else {\n          this.showToast('Warning', `Failed to load verification image: ${error.message}`, 'warning');\n        }\n        return this.getPlaceholderImageUrl();\n      }\n    },\n\n    getVerificationStatusClass(status) {\n      const classes = {\n        'pending': 'bg-warning',\n        'approved': 'bg-success',\n        'rejected': 'bg-danger'\n      };\n      return classes[status] || 'bg-secondary';\n    },\n\n    formatVerificationStatus(status) {\n      const statusMap = {\n        'pending': 'Pending Verification',\n        'approved': 'Verified',\n        'rejected': 'Rejected'\n      };\n      return statusMap[status] || 'Unknown';\n    },\n\n    // Authorized pickup person helper methods\n    getAuthorizedPickupFullName() {\n      if (!this.request?.authorized_pickup) return 'Not provided';\n      const p = this.request.authorized_pickup;\n      return `${p.first_name || ''} ${p.middle_name || ''} ${p.last_name || ''}`.trim();\n    },\n\n    async getPickupIdImageUrl(imagePath) {\n      if (!imagePath) return this.getPlaceholderImageUrl();\n\n      // Extract filename from path\n      const filename = imagePath.split(/[/\\\\]/).pop();\n      const cacheKey = `pickup-id-${filename}`;\n\n      // Return cached URL if available\n      if (this.imageObjectUrls.has(cacheKey)) {\n        return this.imageObjectUrls.get(cacheKey);\n      }\n\n      try {\n        // Debug logging for path consistency\n        console.log('üîç Debug pickup ID image loading:', {\n          originalPath: imagePath,\n          extractedFilename: filename,\n          requestId: this.request.id,\n          finalApiUrl: `/client/document-requests/${this.request.id}/verification-image/pickup-id/${filename}`\n        });\n\n        // Fetch image as blob with authentication\n        const objectUrl = await documentRequestService.getVerificationImageObjectUrl(\n          this.request.id,\n          'pickup-id',\n          filename\n        );\n\n        // Cache the object URL\n        this.imageObjectUrls.set(cacheKey, objectUrl);\n        console.log('‚úÖ Created object URL for pickup ID image:', filename);\n        return objectUrl;\n      } catch (error) {\n        console.error('‚ùå Failed to load pickup ID image:', {\n          filename,\n          imagePath,\n          requestId: this.request.id,\n          error: error.message,\n          status: error.response?.status\n        });\n\n        // Show user-friendly error messages\n        if (error.message.includes('not found')) {\n          this.showToast('Warning', 'ID image not found on server', 'warning');\n        } else if (error.message.includes('contact support')) {\n          this.showToast('Error', 'Server error - please contact support', 'error');\n        } else {\n          this.showToast('Warning', `Failed to load ID image: ${error.message}`, 'warning');\n        }\n        return this.getPlaceholderImageUrl();\n      }\n    },\n\n    async getAuthorizationLetterUrl(imagePath) {\n      if (!imagePath) return this.getPlaceholderImageUrl();\n\n      // Extract filename from path\n      const filename = imagePath.split(/[/\\\\]/).pop();\n      const cacheKey = `pickup-auth-${filename}`;\n\n      // Return cached URL if available\n      if (this.imageObjectUrls.has(cacheKey)) {\n        return this.imageObjectUrls.get(cacheKey);\n      }\n\n      try {\n        // Debug logging for path consistency\n        console.log('üîç Debug authorization letter loading:', {\n          originalPath: imagePath,\n          extractedFilename: filename,\n          requestId: this.request.id,\n          finalApiUrl: `/client/document-requests/${this.request.id}/verification-image/pickup-auth/${filename}`\n        });\n\n        // Fetch image as blob with authentication\n        const objectUrl = await documentRequestService.getVerificationImageObjectUrl(\n          this.request.id,\n          'pickup-auth',\n          filename\n        );\n\n        // Cache the object URL\n        this.imageObjectUrls.set(cacheKey, objectUrl);\n        console.log('‚úÖ Created object URL for authorization letter:', filename);\n        return objectUrl;\n      } catch (error) {\n        console.error('‚ùå Failed to load authorization letter:', {\n          filename,\n          imagePath,\n          requestId: this.request.id,\n          error: error.message,\n          status: error.response?.status\n        });\n\n        // Show user-friendly error messages\n        if (error.message.includes('not found')) {\n          this.showToast('Warning', 'Authorization letter not found on server', 'warning');\n        } else if (error.message.includes('contact support')) {\n          this.showToast('Error', 'Server error - please contact support', 'error');\n        } else {\n          this.showToast('Warning', `Failed to load authorization letter: ${error.message}`, 'warning');\n        }\n        return this.getPlaceholderImageUrl();\n      }\n    },\n\n    getPlaceholderImageUrl() {\n      // Return a data URL for a simple placeholder image\n      return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik04NSA2MEw5NSA3MEwxMTUgNTBMMTM1IDcwTDE0NSA2MEwxNjUgODBMMTY1IDEyMEg0NVY4MEw2NSA2MEw4NSA2MFoiIGZpbGw9IiNEMUQ1REIiLz4KPGNpcmNsZSBjeD0iNzAiIGN5PSI0NSIgcj0iOCIgZmlsbD0iI0QxRDVEQiIvPgo8dGV4dCB4PSIxMDAiIHk9IjEwNSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmaWxsPSIjNkI3MjgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pgo8L3N2Zz4K';\n    },\n\n    async openImageModal(imagePath, imageName, imageType = 'beneficiaries') {\n      try {\n        // Use the already loaded image URLs from the reactive data\n        let imageUrl;\n        switch (imageType) {\n          case 'pickup_id':\n          case 'pickup_ids':\n            imageUrl = this.imageUrls.pickupId;\n            break;\n          case 'pickup_authorization':\n            imageUrl = this.imageUrls.authorizationLetter;\n            break;\n          default:\n            imageUrl = this.imageUrls.beneficiaryVerification;\n        }\n\n        // If image URL is not loaded yet, try to load it\n        if (!imageUrl || imageUrl === this.getPlaceholderImageUrl()) {\n          console.log('üîÑ Image not loaded yet, attempting to load for modal...');\n          switch (imageType) {\n            case 'pickup_id':\n            case 'pickup_ids':\n              imageUrl = await this.getPickupIdImageUrl(imagePath);\n              this.imageUrls.pickupId = imageUrl;\n              break;\n            case 'pickup_authorization':\n              imageUrl = await this.getAuthorizationLetterUrl(imagePath);\n              this.imageUrls.authorizationLetter = imageUrl;\n              break;\n            default:\n              imageUrl = await this.getVerificationImageUrl(imagePath);\n              this.imageUrls.beneficiaryVerification = imageUrl;\n          }\n        }\n\n        if (!imageUrl || imageUrl === this.getPlaceholderImageUrl()) {\n          this.showToast('Error', 'Failed to load image', 'error');\n          return;\n        }\n\n        // Debug logging for modal image data\n        console.log('üñºÔ∏è Opening ImageViewer modal with:', {\n          imageType,\n          imageName,\n          imagePath,\n          imageUrl: imageUrl ? imageUrl.substring(0, 50) + '...' : 'none',\n          isBlobUrl: imageUrl?.startsWith('blob:'),\n          isDataUrl: imageUrl?.startsWith('data:'),\n          isPlaceholder: imageUrl === this.getPlaceholderImageUrl()\n        });\n\n        // Set data for ImageViewer component\n        this.selectedImage = {\n          url: imageUrl,\n          title: imageName || 'Document',\n          filename: imagePath ? imagePath.split(/[/\\\\]/).pop() : '',\n          type: imageType,\n          downloadUrl: imageUrl\n        };\n        this.showImageViewer = true;\n      } catch (error) {\n        console.error('Error opening image modal:', error);\n        this.showToast('Error', 'Failed to load image', 'error');\n      }\n    },\n\n    closeImageViewer() {\n      this.showImageViewer = false;\n      this.selectedImage = null;\n    },\n\n    handleImageError(event, imageType) {\n      console.error(`‚ùå Failed to load ${imageType} image:`, event.target.src);\n\n      // Hide the broken image\n      event.target.style.display = 'none';\n\n      // Show error message to user\n      const container = event.target.closest('.verification-image-container');\n      if (container && !container.querySelector('.image-error-message')) {\n        const errorDiv = document.createElement('div');\n        errorDiv.className = 'image-error-message';\n        errorDiv.innerHTML = `\n          <i class=\"fas fa-exclamation-triangle text-warning\"></i>\n          <span>Unable to load ${imageType} image</span>\n          <small class=\"d-block mt-1\">Authentication or network error</small>\n        `;\n        container.appendChild(errorDiv);\n      }\n    },\n\n    handleImageLoad(event, imageType) {\n      console.log(`‚úÖ Successfully loaded ${imageType} image:`, event.target.src);\n    },\n\n    showToast(title, message, type = 'info') {\n      // Log to console for debugging\n      console.log(`[${type.toUpperCase()}] ${title}: ${message}`);\n\n      // Create a simple toast notification\n      const toast = document.createElement('div');\n      toast.className = `toast-notification toast-${type}`;\n      toast.innerHTML = `\n        <div class=\"toast-header\">\n          <strong>${title}</strong>\n          <button type=\"button\" class=\"toast-close\" onclick=\"this.parentElement.parentElement.remove()\">√ó</button>\n        </div>\n        <div class=\"toast-body\">${message}</div>\n      `;\n\n      // Add toast styles if not already added\n      if (!document.getElementById('toast-styles')) {\n        const styles = document.createElement('style');\n        styles.id = 'toast-styles';\n        styles.textContent = `\n          .toast-notification {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            min-width: 300px;\n            background: white;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            z-index: 9999;\n            animation: slideIn 0.3s ease;\n          }\n          .toast-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px 8px;\n            border-bottom: 1px solid #e9ecef;\n          }\n          .toast-body {\n            padding: 8px 16px 12px;\n            color: #6c757d;\n          }\n          .toast-close {\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            color: #6c757d;\n          }\n          .toast-success { border-left: 4px solid #28a745; }\n          .toast-error { border-left: 4px solid #dc3545; }\n          .toast-info { border-left: 4px solid #17a2b8; }\n          .toast-warning { border-left: 4px solid #ffc107; }\n          @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n          }\n        `;\n        document.head.appendChild(styles);\n      }\n\n      // Add toast to page\n      document.body.appendChild(toast);\n\n      // Auto-remove after 5 seconds\n      setTimeout(() => {\n        if (toast.parentElement) {\n          toast.style.animation = 'slideIn 0.3s ease reverse';\n          setTimeout(() => toast.remove(), 300);\n        }\n      }, 5000);\n    }\n  }\n};\n</script>\n\n<style src=\"./css/RequestDetails.css\"></style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}