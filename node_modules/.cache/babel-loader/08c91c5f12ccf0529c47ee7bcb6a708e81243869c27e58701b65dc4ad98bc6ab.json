{"ast":null,"code":"import { writeCrc } from './crc';\n// https://www.w3.org/TR/png/#11tEXt\nexport const textChunkName = 'tEXt';\nconst NULL = 0;\nconst latin1Decoder = new TextDecoder('latin1');\nfunction validateKeyword(keyword) {\n  validateLatin1(keyword);\n  if (keyword.length === 0 || keyword.length > 79) {\n    throw new Error('keyword length must be between 1 and 79');\n  }\n}\n// eslint-disable-next-line no-control-regex\nconst latin1Regex = /^[\\u0000-\\u00FF]*$/;\nfunction validateLatin1(text) {\n  if (!latin1Regex.test(text)) {\n    throw new Error('invalid latin1 text');\n  }\n}\nexport function decodetEXt(text, buffer, length) {\n  const keyword = readKeyword(buffer);\n  text[keyword] = readLatin1(buffer, length - keyword.length - 1);\n}\nexport function encodetEXt(buffer, keyword, text) {\n  validateKeyword(keyword);\n  validateLatin1(text);\n  const length = keyword.length + 1 /* NULL */ + text.length;\n  buffer.writeUint32(length);\n  buffer.writeChars(textChunkName);\n  buffer.writeChars(keyword);\n  buffer.writeByte(NULL);\n  buffer.writeChars(text);\n  writeCrc(buffer, length + 4);\n}\n// https://www.w3.org/TR/png/#11keywords\nexport function readKeyword(buffer) {\n  buffer.mark();\n  while (buffer.readByte() !== NULL) {\n    /* advance */\n  }\n  const end = buffer.offset;\n  buffer.reset();\n  const keyword = latin1Decoder.decode(buffer.readBytes(end - buffer.offset - 1));\n  // NULL\n  buffer.skip(1);\n  validateKeyword(keyword);\n  return keyword;\n}\nexport function readLatin1(buffer, length) {\n  return latin1Decoder.decode(buffer.readBytes(length));\n}","map":{"version":3,"names":["writeCrc","textChunkName","NULL","latin1Decoder","TextDecoder","validateKeyword","keyword","validateLatin1","length","Error","latin1Regex","text","test","decodetEXt","buffer","readKeyword","readLatin1","encodetEXt","writeUint32","writeChars","writeByte","mark","readByte","end","offset","reset","decode","readBytes","skip"],"sources":["../../src/helpers/text.ts"],"sourcesContent":[null],"mappings":"AAEA,SAASA,QAAQ,QAAQ,OAAO;AAEhC;AAEA,OAAO,MAAMC,aAAa,GAAG,MAAM;AAEnC,MAAMC,IAAI,GAAG,CAAC;AAEd,MAAMC,aAAa,GAAG,IAAIC,WAAW,CAAC,QAAQ,CAAC;AAE/C,SAASC,eAAeA,CAACC,OAAe;EACtCC,cAAc,CAACD,OAAO,CAAC;EACvB,IAAIA,OAAO,CAACE,MAAM,KAAK,CAAC,IAAIF,OAAO,CAACE,MAAM,GAAG,EAAE,EAAE;IAC/C,MAAM,IAAIC,KAAK,CAAC,yCAAyC,CAAC;EAC5D;AACF;AAEA;AACA,MAAMC,WAAW,GAAG,oBAAoB;AACxC,SAASH,cAAcA,CAACI,IAAY;EAClC,IAAI,CAACD,WAAW,CAACE,IAAI,CAACD,IAAI,CAAC,EAAE;IAC3B,MAAM,IAAIF,KAAK,CAAC,qBAAqB,CAAC;EACxC;AACF;AAEA,OAAM,SAAUI,UAAUA,CACxBF,IAA4B,EAC5BG,MAAgB,EAChBN,MAAc;EAEd,MAAMF,OAAO,GAAGS,WAAW,CAACD,MAAM,CAAC;EACnCH,IAAI,CAACL,OAAO,CAAC,GAAGU,UAAU,CAACF,MAAM,EAAEN,MAAM,GAAGF,OAAO,CAACE,MAAM,GAAG,CAAC,CAAC;AACjE;AAEA,OAAM,SAAUS,UAAUA,CAACH,MAAgB,EAAER,OAAe,EAAEK,IAAY;EACxEN,eAAe,CAACC,OAAO,CAAC;EACxBC,cAAc,CAACI,IAAI,CAAC;EACpB,MAAMH,MAAM,GAAGF,OAAO,CAACE,MAAM,GAAG,CAAC,CAAC,aAAaG,IAAI,CAACH,MAAM;EAE1DM,MAAM,CAACI,WAAW,CAACV,MAAM,CAAC;EAC1BM,MAAM,CAACK,UAAU,CAAClB,aAAa,CAAC;EAChCa,MAAM,CAACK,UAAU,CAACb,OAAO,CAAC;EAC1BQ,MAAM,CAACM,SAAS,CAAClB,IAAI,CAAC;EACtBY,MAAM,CAACK,UAAU,CAACR,IAAI,CAAC;EACvBX,QAAQ,CAACc,MAAM,EAAEN,MAAM,GAAG,CAAC,CAAC;AAC9B;AAEA;AACA,OAAM,SAAUO,WAAWA,CAACD,MAAgB;EAC1CA,MAAM,CAACO,IAAI,EAAE;EACb,OAAOP,MAAM,CAACQ,QAAQ,EAAE,KAAKpB,IAAI,EAAE;IACjC;EAAA;EAEF,MAAMqB,GAAG,GAAGT,MAAM,CAACU,MAAM;EACzBV,MAAM,CAACW,KAAK,EAAE;EACd,MAAMnB,OAAO,GAAGH,aAAa,CAACuB,MAAM,CAClCZ,MAAM,CAACa,SAAS,CAACJ,GAAG,GAAGT,MAAM,CAACU,MAAM,GAAG,CAAC,CAAC,CAC1C;EACD;EACAV,MAAM,CAACc,IAAI,CAAC,CAAC,CAAC;EAEdvB,eAAe,CAACC,OAAO,CAAC;EAExB,OAAOA,OAAO;AAChB;AAEA,OAAM,SAAUU,UAAUA,CAACF,MAAgB,EAAEN,MAAc;EACzD,OAAOL,aAAa,CAACuB,MAAM,CAACZ,MAAM,CAACa,SAAS,CAACnB,MAAM,CAAC,CAAC;AACvD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}