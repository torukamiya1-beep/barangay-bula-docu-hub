{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport documentRequestService from '@/services/documentRequestService';\nimport clientAuthService from '@/services/clientAuthService';\nimport paymentService from '@/services/paymentService';\nimport addressService from '@/services/addressService';\nimport FileUpload from '@/components/common/FileUpload.vue';\nexport default {\n  name: 'CedulaRequest',\n  components: {\n    FileUpload\n  },\n  data() {\n    return {\n      currentStep: 1,\n      submitting: false,\n      purposeCategories: [],\n      paymentMethods: [],\n      // Grouped payment methods for display\n      originalPaymentMethods: [],\n      // Original payment methods from backend\n      processingFee: 5.00,\n      // Processing fee\n      basicTax: 5.00,\n      // Basic community tax\n      familyRelationshipError: null,\n      formData: {\n        document_type_id: 1,\n        // Cedula\n        purpose_category_id: '',\n        purpose_details: '',\n        is_third_party_request: false,\n        beneficiary: {\n          first_name: '',\n          middle_name: '',\n          last_name: '',\n          suffix: '',\n          birth_date: '',\n          gender: '',\n          civil_status_id: '',\n          nationality: 'Filipino',\n          phone_number: '',\n          email: '',\n          house_number: '',\n          street: '',\n          subdivision: '',\n          barangay: 'Bula',\n          city_municipality: 'General Santos City (Dadiangas)',\n          province: 'South Cotabato',\n          postal_code: '',\n          years_of_residency: null,\n          months_of_residency: null,\n          relationship_to_requestor: '',\n          region_code: '12',\n          province_code: '1263',\n          city_code: '126303',\n          barangay_code: '126303005'\n        },\n        authorized_pickup: {\n          first_name: '',\n          middle_name: '',\n          last_name: '',\n          suffix: '',\n          phone_number: '',\n          email: '',\n          relationship_to_beneficiary: ''\n        },\n        annual_income: 0,\n        income_source: '',\n        business_name: '',\n        business_address: '',\n        business_nature: '',\n        has_real_property: false,\n        property_value: 0,\n        property_location: '',\n        has_personal_property: false,\n        personal_property_value: 0,\n        has_business: false,\n        business_gross_receipts: 0,\n        business_type: '',\n        payment_method_id: '',\n        agree_to_terms: false\n      },\n      pickupOption: 'self',\n      // 'self' or 'authorized'\n      uploadedFiles: {\n        beneficiary_verification: null,\n        pickup_id_image: null,\n        pickup_authorization: null\n      },\n      civilStatuses: [],\n      clientData: null,\n      // Fresh profile data\n\n      // Address dropdown data\n      regions: [],\n      provinces: [],\n      cities: [],\n      barangays: [],\n      filteredProvinces: [],\n      filteredCities: [],\n      filteredBarangays: [],\n      // Validation control\n      isValidating: false\n    };\n  },\n  computed: {\n    // Keep the old method as fallback\n    cachedClientData() {\n      return clientAuthService.getCurrentUser();\n    },\n    shouldShowPurposeDetails() {\n      // Show purpose details only when \"Other\" category (id=10) is selected\n      return this.formData.purpose_category_id === 10;\n    },\n    familyVerificationPlaceholder() {\n      // Dynamic placeholder based on relationship selection\n      if (this.formData.beneficiary.relationship_to_requestor === 'spouse') {\n        return 'Click to upload spouse verification image';\n      }\n      return 'Click to upload family Member Verification Image';\n    },\n    familyVerificationText() {\n      // Dynamic verification text based on relationship selection\n      if (this.formData.beneficiary.relationship_to_requestor === 'spouse') {\n        return 'To verify that this person is indeed your spouse, please upload a clear photo of Marriage Application.';\n      }\n      return 'To verify that this person is indeed your family member, please upload a clear photo of their valid ID (Driver\\'s License, National ID, Passport, etc.).';\n    },\n    // Debug computed property for submit button state\n    submitButtonDisabled() {\n      const disabled = this.submitting || !this.formData.agree_to_terms;\n      console.log('üîò Submit button disabled:', disabled, {\n        submitting: this.submitting,\n        agree_to_terms: this.formData.agree_to_terms,\n        currentStep: this.currentStep\n      });\n      return disabled;\n    },\n    incomeTax() {\n      const income = this.formData.annual_income || 0;\n\n      // Official Philippine Community Tax Formula (2024)\n      // Source: Local Government Code, MoneyMax 2024 guide\n      // Additional tax: ‚Ç±1 for every ‚Ç±1,000 of gross earnings\n      const additionalTax = Math.floor(income / 1000) * 1.00;\n      return Math.min(additionalTax, 5000); // Maximum additional tax ‚Ç±5,000\n    },\n    propertyTax() {\n      let tax = 0;\n\n      // Real property tax - FIXED: Use ‚Ç±1 per ‚Ç±1,000 formula (Philippine Community Tax Law)\n      if (this.formData.has_real_property) {\n        const realValue = this.formData.property_value || 0;\n        tax += Math.floor(realValue / 1000) * 1.00;\n      }\n\n      // Personal property tax - FIXED: Use ‚Ç±1 per ‚Ç±1,000 formula (Philippine Community Tax Law)\n      if (this.formData.has_personal_property) {\n        const personalValue = this.formData.personal_property_value || 0;\n        tax += Math.floor(personalValue / 1000) * 1.00;\n      }\n      return Math.min(tax, 5000); // Maximum property tax\n    },\n    businessTax() {\n      if (!this.formData.has_business) return 0;\n      const receipts = this.formData.business_gross_receipts || 0;\n      // FIXED: Use ‚Ç±1 per ‚Ç±1,000 formula (Philippine Community Tax Law)\n      const tax = Math.floor(receipts / 1000) * 1.00;\n      return Math.min(tax, 5000); // Maximum business tax\n    },\n    totalTax() {\n      // Official Philippine Community Tax Formula (2024)\n      const basicTax = 5.00; // Basic community tax minimum ‚Ç±5\n      const additionalTax = this.incomeTax + this.propertyTax + this.businessTax;\n      return basicTax + additionalTax;\n    },\n    convenienceFee() {\n      // PayMongo minimum payment requirement: ‚Ç±100.00 (confirmed by API testing)\n      const baseTotal = this.totalTax + this.processingFee;\n      const paymongoMinimum = 100.00;\n      return Math.max(0, paymongoMinimum - baseTotal);\n    },\n    totalFee() {\n      return this.totalTax + this.processingFee + this.convenienceFee;\n    }\n  },\n  async mounted() {\n    console.log('üéØ CedulaRequest component mounted');\n\n    // Migrate legacy auth if needed\n    clientAuthService.migrateLegacyAuth();\n\n    // Check authentication status (unified auth system)\n    const token = localStorage.getItem('auth_token') || localStorage.getItem('clientToken');\n    const clientData = localStorage.getItem('auth_user') || localStorage.getItem('clientData');\n    console.log('üîë Auth token exists:', !!token);\n    console.log('üë§ Client data exists:', !!clientData);\n    if (clientData) {\n      try {\n        const parsedData = JSON.parse(clientData);\n        console.log('üë§ Client data:', parsedData);\n      } catch (e) {\n        console.error('‚ùå Error parsing client data:', e);\n      }\n    }\n    await this.loadFormData();\n  },\n  methods: {\n    async loadFormData() {\n      try {\n        // Load fresh profile data first\n        console.log('Loading fresh profile data...');\n        const profileResponse = await clientAuthService.getProfile();\n        if (profileResponse.success) {\n          this.clientData = profileResponse.data;\n          console.log('Fresh profile data loaded:', this.clientData);\n        } else {\n          // Fallback to cached data\n          this.clientData = this.cachedClientData;\n          console.log('Using cached profile data:', this.clientData);\n        }\n        const [purposeResponse, paymentResponse] = await Promise.all([documentRequestService.getPurposeCategories(), documentRequestService.getPaymentMethods(), this.loadCivilStatuses(), this.loadAddressData()]);\n        this.purposeCategories = purposeResponse.data || [];\n        this.originalPaymentMethods = paymentResponse.data || [];\n        this.paymentMethods = paymentService.groupPaymentMethods(this.originalPaymentMethods);\n      } catch (error) {\n        console.error('Error loading form data:', error);\n        // Fallback to cached data on error\n        this.clientData = this.cachedClientData;\n        this.showToast('Error', 'Failed to load some form data', 'error');\n      }\n    },\n    onPurposeChange() {\n      // Clear purpose details if not \"Other\" category (id=10)\n      if (!this.shouldShowPurposeDetails) {\n        this.formData.purpose_details = '';\n      }\n    },\n    sanitizeRequestData(data) {\n      // Convert undefined values to null to prevent MySQL binding errors\n      const sanitized = {};\n      for (const [key, value] of Object.entries(data)) {\n        if (value === undefined) {\n          sanitized[key] = null;\n        } else if (value === '') {\n          sanitized[key] = null;\n        } else if (typeof value === 'object' && value !== null) {\n          // Recursively sanitize nested objects\n          sanitized[key] = this.sanitizeRequestData(value);\n        } else {\n          sanitized[key] = value;\n        }\n      }\n      return sanitized;\n    },\n    getFullName() {\n      // Try fresh data first, then fallback to cached data structure\n      const profile = this.clientData || this.clientData?.profile;\n      if (!profile) return 'N/A';\n      return `${profile.first_name || ''} ${profile.middle_name || ''} ${profile.last_name || ''}`.trim();\n    },\n    getFullAddress() {\n      // Try fresh data first, then fallback to cached data structure\n      const profile = this.clientData || this.clientData?.profile;\n      if (!profile) return 'Not provided';\n      const parts = [profile.house_number, profile.street, profile.subdivision, profile.barangay, profile.city_municipality || profile.city, profile.province].filter(Boolean);\n      return parts.length > 0 ? parts.join(', ') : 'Not provided';\n    },\n    formatGender(gender) {\n      if (!gender) return 'Not provided';\n      return gender.charAt(0).toUpperCase() + gender.slice(1);\n    },\n    getCivilStatusName(statusId) {\n      const statuses = {\n        1: 'Single',\n        2: 'Married',\n        3: 'Divorced',\n        4: 'Widowed',\n        5: 'Separated'\n      };\n      return statuses[statusId] || 'Not provided';\n    },\n    getResidencyDisplay() {\n      // Try fresh data first, then fallback to cached data structure\n      const profile = this.clientData || this.clientData?.profile;\n      if (!profile) return 'Not provided';\n      const years = profile.years_of_residency;\n      const months = profile.months_of_residency;\n      if (!years && !months) return 'Not provided';\n      const parts = [];\n      if (years) parts.push(`${years} year${years > 1 ? 's' : ''}`);\n      if (months) parts.push(`${months} month${months > 1 ? 's' : ''}`);\n      return parts.join(' and ');\n    },\n    formatDate(dateString) {\n      if (!dateString) return 'Not provided';\n      return new Date(dateString).toLocaleDateString();\n    },\n    formatCurrency(amount) {\n      return parseFloat(amount || 0).toFixed(2);\n    },\n    // REMOVED: Incorrect percentage-based rate methods\n    // Philippine Community Tax Law uses ‚Ç±1 per ‚Ç±1,000 formula for all categories\n    // These methods were causing the calculation bug\n\n    calculateTax() {\n      // Tax calculation is handled by computed properties\n      this.$forceUpdate();\n    },\n    canProceedToNextStep() {\n      const result = (() => {\n        switch (this.currentStep) {\n          case 1:\n            {\n              let basicValidation = this.formData.purpose_category_id;\n\n              // Only require purpose details if the field is shown (Other category, id=10)\n              if (this.shouldShowPurposeDetails) {\n                basicValidation = basicValidation && this.formData.purpose_details && this.formData.purpose_details.length >= 10;\n              }\n              if (!basicValidation) return false;\n\n              // Additional validation for third-party requests\n              if (this.formData.is_third_party_request) {\n                return this.validateBeneficiaryData();\n              }\n              return true;\n            }\n          case 2:\n            return this.formData.annual_income >= 0 && this.formData.income_source && this.formData.has_real_property !== null && this.formData.has_personal_property !== null && this.formData.has_business !== null;\n          case 3:\n            {\n              const paymentValid = this.formData.payment_method_id;\n              if (!paymentValid) return false;\n\n              // Additional validation for authorized pickup\n              if (this.pickupOption === 'authorized') {\n                return this.validateAuthorizedPickup();\n              }\n              return true;\n            }\n          default:\n            return true;\n        }\n      })();\n      console.log(`üîç canProceedToNextStep (step ${this.currentStep}):`, result);\n      if (this.currentStep === 1) {\n        console.log('  - purpose_category_id:', this.formData.purpose_category_id);\n        console.log('  - purpose_details:', this.formData.purpose_details);\n      } else if (this.currentStep === 2) {\n        console.log('  - annual_income:', this.formData.annual_income);\n        console.log('  - income_source:', this.formData.income_source);\n        console.log('  - has_real_property:', this.formData.has_real_property);\n        console.log('  - has_personal_property:', this.formData.has_personal_property);\n        console.log('  - has_business:', this.formData.has_business);\n      } else if (this.currentStep === 3) {\n        console.log('  - payment_method_id:', this.formData.payment_method_id);\n      }\n      return result;\n    },\n    nextStep() {\n      console.log('üîÑ nextStep called, current step:', this.currentStep);\n      const canProceed = this.canProceedToNextStep();\n      console.log('üîç Can proceed:', canProceed);\n      if (canProceed && this.currentStep < 4) {\n        this.currentStep++;\n        console.log('‚úÖ Moved to step:', this.currentStep);\n      } else {\n        console.log('‚ùå Cannot proceed to next step');\n      }\n    },\n    previousStep() {\n      if (this.currentStep > 1) {\n        this.currentStep--;\n      }\n    },\n    selectPaymentMethod(methodId) {\n      this.formData.payment_method_id = methodId;\n    },\n    getActualPaymentMethodId() {\n      return paymentService.getActualPaymentMethodId(this.formData.payment_method_id, this.originalPaymentMethods);\n    },\n    getPaymentIcon(methodCode) {\n      const icons = {\n        'CASH': 'fas fa-money-bill',\n        'ONLINE_PAYMENT_GROUP': 'fas fa-credit-card',\n        'PAYMONGO_CARD': 'fas fa-credit-card',\n        'PAYMONGO_GCASH': 'fab fa-google-pay',\n        'PAYMONGO_GRABPAY': 'fas fa-mobile-alt',\n        'PAYMONGO_PAYMAYA': 'fas fa-wallet',\n        'PAYMONGO_BANK': 'fas fa-university'\n      };\n      return icons[methodCode] || 'fas fa-credit-card';\n    },\n    getPurposeCategoryName() {\n      const category = this.purposeCategories.find(c => c.id === this.formData.purpose_category_id);\n      return category?.category_name || '';\n    },\n    getPaymentMethodName() {\n      const method = this.paymentMethods.find(m => m.id === this.formData.payment_method_id);\n      return method?.method_name || '';\n    },\n    getPaymentMethodDisplayName(methodCode) {\n      return paymentService.getPaymentMethodDisplayName(methodCode);\n    },\n    // Handle phone number input to restrict to digits only\n    handlePhoneInput(event, section) {\n      const value = event.target.value;\n      // Remove any non-digit characters\n      const digitsOnly = value.replace(/\\D/g, '');\n      // Limit to 11 digits\n      const limitedValue = digitsOnly.substring(0, 11);\n      if (section === 'beneficiary') {\n        this.formData.beneficiary.phone_number = limitedValue;\n      } else if (section === 'authorized_pickup') {\n        this.formData.authorized_pickup.phone_number = limitedValue;\n      }\n    },\n    // New methods for third-party requests\n    handleRequestTypeChange() {\n      if (!this.formData.is_third_party_request) {\n        // Reset beneficiary data when switching back to self\n        this.resetBeneficiaryData();\n        this.familyRelationshipError = null;\n      }\n    },\n    handleGenderChange() {\n      // Clear suffix when male is not selected since suffix field will be hidden\n      if (this.formData.beneficiary.gender !== 'male') {\n        this.formData.beneficiary.suffix = '';\n      }\n    },\n    validateFamilyRelationship() {\n      this.familyRelationshipError = null;\n      if (!this.formData.is_third_party_request) {\n        return true;\n      }\n      const relationship = this.formData.beneficiary.relationship_to_requestor;\n      if (!relationship) {\n        return true; // Will be caught by required validation\n      }\n\n      // Define allowed immediate family relationships\n      const allowedRelationships = ['spouse', 'husband', 'wife', 'child', 'son', 'daughter', 'parent', 'father', 'mother', 'sibling', 'brother', 'sister'];\n      if (!allowedRelationships.includes(relationship.toLowerCase())) {\n        this.familyRelationshipError = 'You can only request documents on behalf of immediate family members (spouse, children, parents, siblings).';\n        return false;\n      }\n      return true;\n    },\n    handlePickupOptionChange() {\n      if (this.pickupOption !== 'authorized') {\n        // Reset authorized pickup data\n        this.resetAuthorizedPickupData();\n      }\n    },\n    resetBeneficiaryData() {\n      this.formData.beneficiary = {\n        first_name: '',\n        middle_name: '',\n        last_name: '',\n        suffix: '',\n        birth_date: '',\n        gender: '',\n        civil_status_id: '',\n        nationality: 'Filipino',\n        phone_number: '',\n        email: '',\n        house_number: '',\n        street: '',\n        subdivision: '',\n        barangay: 'Bula',\n        city_municipality: 'General Santos City (Dadiangas)',\n        province: 'South Cotabato',\n        postal_code: '',\n        years_of_residency: null,\n        months_of_residency: null,\n        relationship_to_requestor: '',\n        region: 'Region XII (SOCCSKSARGEN)',\n        region_code: '12',\n        province_code: '1263',\n        city_code: '126303',\n        barangay_code: '126303005'\n      };\n    },\n    resetAuthorizedPickupData() {\n      this.formData.authorized_pickup = {\n        first_name: '',\n        middle_name: '',\n        last_name: '',\n        suffix: '',\n        phone_number: '',\n        email: '',\n        relationship_to_beneficiary: ''\n      };\n      // Also reset the uploaded files\n      this.uploadedFiles.pickup_id_image = null;\n      this.uploadedFiles.pickup_authorization = null;\n    },\n    async loadCivilStatuses() {\n      try {\n        // For now, use a static list. In production, this would be an API call\n        this.civilStatuses = [{\n          id: 1,\n          status_name: 'Single'\n        }, {\n          id: 2,\n          status_name: 'Married'\n        }, {\n          id: 3,\n          status_name: 'Widowed'\n        }, {\n          id: 4,\n          status_name: 'Divorced'\n        }, {\n          id: 5,\n          status_name: 'Separated'\n        }];\n      } catch (error) {\n        console.error('Error loading civil statuses:', error);\n      }\n    },\n    validateBeneficiaryData() {\n      if (!this.formData.is_third_party_request) return true;\n      const required = ['first_name', 'last_name', 'birth_date', 'gender', 'civil_status_id', 'region_code', 'province_code', 'city_code', 'barangay_code', 'relationship_to_requestor'];\n      for (const field of required) {\n        if (!this.formData.beneficiary[field]) {\n          this.showToast('Error', `Please fill in the beneficiary's ${field.replace('_', ' ')}`, 'error');\n          return false;\n        }\n      }\n\n      // Validate family relationship\n      if (!this.validateFamilyRelationship()) {\n        this.showToast('Error', this.familyRelationshipError, 'error');\n        return false;\n      }\n\n      // Check for required verification image\n      if (!this.uploadedFiles.beneficiary_verification) {\n        this.showToast('Error', 'Please upload the family member\\'s verification ID image', 'error');\n        return false;\n      }\n      return true;\n    },\n    validateAuthorizedPickup(showErrors = false) {\n      console.log('üîç validateAuthorizedPickup called with showErrors:', showErrors);\n      console.log('üîç pickupOption:', this.pickupOption);\n      console.log('üîç authorized_pickup data:', this.formData.authorized_pickup);\n      if (this.pickupOption !== 'authorized') {\n        console.log('‚úÖ Not authorized pickup, validation passed');\n        return true;\n      }\n\n      // Prevent multiple validation calls in quick succession\n      if (this.isValidating) {\n        console.log('‚ö†Ô∏è Validation already in progress, skipping');\n        return false;\n      }\n      if (showErrors) {\n        this.isValidating = true;\n        setTimeout(() => {\n          this.isValidating = false;\n        }, 1000); // Reset after 1 second\n      }\n      const required = ['first_name', 'last_name', 'phone_number', 'relationship_to_beneficiary'];\n      for (const field of required) {\n        const value = this.formData.authorized_pickup[field];\n        console.log(`üîç Checking field ${field}:`, value);\n        if (!value || value.trim() === '') {\n          if (showErrors) {\n            console.log(`‚ùå Field ${field} is missing`);\n            this.showToast('Error', `Please fill in the pickup person's ${field.replace('_', ' ')}`, 'error');\n          }\n          return false;\n        }\n      }\n\n      // Check for required file uploads\n      if (!this.uploadedFiles.pickup_id_image) {\n        if (showErrors) {\n          console.log('‚ùå Missing pickup ID image');\n          this.showToast('Error', 'Please upload the pickup person\\'s valid ID image', 'error');\n        }\n        return false;\n      }\n      if (!this.uploadedFiles.pickup_authorization) {\n        if (showErrors) {\n          console.log('‚ùå Missing pickup authorization');\n          this.showToast('Error', 'Please upload the authorization letter', 'error');\n        }\n        return false;\n      }\n      console.log('‚úÖ Authorized pickup validation passed');\n      return true;\n    },\n    handleSubmitClick(event) {\n      console.log('üî• Submit button clicked!', event);\n      console.log('üìã Form data:', this.formData);\n      console.log('‚úÖ Agree to terms:', this.formData.agree_to_terms);\n      console.log('üîÑ Current step:', this.currentStep);\n      console.log('üö´ Button disabled:', this.submitting || !this.formData.agree_to_terms);\n\n      // Don't prevent default here, let the form submission happen naturally\n    },\n    async handleSubmit() {\n      console.log('üöÄ handleSubmit called');\n      console.log('üìã Form data:', this.formData);\n      console.log('‚úÖ Agree to terms:', this.formData.agree_to_terms);\n      if (!this.formData.agree_to_terms) {\n        console.log('‚ùå Terms not agreed to');\n        this.showToast('Error', 'Please agree to the terms and conditions', 'error');\n        return;\n      }\n\n      // Debug pickup option and form data\n      console.log('üîç DEBUG: pickupOption =', this.pickupOption);\n      console.log('üîç DEBUG: authorized_pickup data =', JSON.stringify(this.formData.authorized_pickup, null, 2));\n      console.log('üîç DEBUG: uploadedFiles =', this.uploadedFiles);\n\n      // Final validation with error messages for authorized pickup\n      if (this.pickupOption === 'authorized') {\n        console.log('üîç Running final validation for authorized pickup...');\n        if (!this.validateAuthorizedPickup(true)) {\n          console.log('‚ùå Validation failed, stopping submission');\n          this.submitting = false;\n          return;\n        }\n        console.log('‚úÖ Validation passed, continuing with submission');\n      }\n      try {\n        console.log('üîÑ Starting submission process...');\n        this.submitting = true;\n\n        // Check authentication (unified auth system)\n        const token = localStorage.getItem('auth_token') || localStorage.getItem('clientToken');\n        console.log('üîë Auth token exists:', !!token);\n        if (!token) {\n          this.showToast('Error', 'Please log in to submit a request', 'error');\n          this.submitting = false;\n          return;\n        }\n\n        // Ensure required fields are properly formatted and sanitize undefined values\n        const requestData = this.sanitizeRequestData({\n          // Core document request fields\n          document_type_id: parseInt(this.formData.document_type_id),\n          purpose_category_id: parseInt(this.formData.purpose_category_id),\n          purpose_details: this.shouldShowPurposeDetails && this.formData.purpose_details && this.formData.purpose_details.length >= 10 ? this.formData.purpose_details : null,\n          payment_method_id: this.getActualPaymentMethodId(),\n          delivery_method: 'pickup',\n          priority: 'normal',\n          // Third-party request data\n          is_third_party_request: this.formData.is_third_party_request || false,\n          requestor_notes: null,\n          beneficiary: this.formData.is_third_party_request ? this.formData.beneficiary : null,\n          authorized_pickup: this.pickupOption === 'authorized' ? this.formData.authorized_pickup : null,\n          // Cedula-specific fields - ensure numeric fields are numbers\n          annual_income: parseFloat(this.formData.annual_income) || 0,\n          monthly_income: parseFloat(this.formData.monthly_income) || 0,\n          property_assessed_value: parseFloat(this.formData.property_value) || 0,\n          business_income: parseFloat(this.formData.business_gross_receipts) || 0,\n          business_gross_receipts: parseFloat(this.formData.business_gross_receipts) || 0,\n          // Optional text fields\n          occupation: this.formData.occupation || null,\n          employer_name: this.formData.employer_name || null,\n          employer_address: this.formData.employer_address || null,\n          business_name: this.formData.business_name || null,\n          business_address: this.formData.business_address || null,\n          business_type: this.formData.business_type || null,\n          property_location: this.formData.property_location || null,\n          tin_number: this.formData.tin_number || null,\n          previous_ctc_number: this.formData.previous_ctc_number || null,\n          previous_ctc_date_issued: this.formData.previous_ctc_date_issued || null,\n          previous_ctc_place_issued: this.formData.previous_ctc_place_issued || null,\n          // Boolean fields\n          has_real_property: Boolean(this.formData.has_real_property),\n          has_personal_property: Boolean(this.formData.has_personal_property),\n          // Numeric fields with defaults\n          personal_property_value: parseFloat(this.formData.personal_property_value) || 0,\n          // Computed values\n          computed_tax: this.totalTax || 0,\n          total_fee: this.totalFee || 0,\n          // CRITICAL: Send exact total_document_fee for PayMongo accuracy\n          total_document_fee: this.totalFee || 0\n        });\n        console.log('üì§ Request data to submit:', requestData);\n\n        // Validate required fields\n        if (!requestData.purpose_category_id) {\n          this.showToast('Error', 'Please select a purpose category', 'error');\n          this.submitting = false;\n          return;\n        }\n\n        // Only validate purpose details if the field is shown (Other category, id=10)\n        if (this.shouldShowPurposeDetails && (!requestData.purpose_details || requestData.purpose_details.length < 10)) {\n          this.showToast('Error', 'Purpose details must be at least 10 characters long', 'error');\n          this.submitting = false;\n          return;\n        }\n        if (!requestData.payment_method_id) {\n          this.showToast('Error', 'Please select a payment method', 'error');\n          this.submitting = false;\n          return;\n        }\n        console.log('üì° Making API call...');\n        const response = await documentRequestService.submitRequest(requestData);\n        console.log('‚úÖ API response:', response);\n\n        // Upload beneficiary verification if this is a third-party request\n        if (this.formData.is_third_party_request && this.uploadedFiles.beneficiary_verification && response.data.id) {\n          console.log('üì§ Uploading beneficiary verification...');\n          await this.uploadBeneficiaryVerification(response.data.id);\n        }\n\n        // Upload files if this is an authorized pickup request\n        if (this.pickupOption === 'authorized' && response.data.id) {\n          console.log('üì§ Uploading pickup authorization files...');\n          await this.uploadPickupFiles(response.data.id);\n        }\n        this.showToast('Success', 'Cedula request submitted successfully!', 'success');\n        this.$router.push({\n          name: 'RequestDetails',\n          params: {\n            id: response.data.id\n          }\n        });\n      } catch (error) {\n        console.error('‚ùå Error submitting request:', error);\n        console.error('‚ùå Error response:', error.response);\n        console.error('‚ùå Error data:', error.response?.data);\n        let errorMessage = 'Failed to submit request';\n        if (error.response?.data?.message) {\n          errorMessage = error.response.data.message;\n        } else if (error.response?.data?.error) {\n          errorMessage = error.response.data.error;\n        } else if (error.message) {\n          errorMessage = error.message;\n        }\n        this.showToast('Error', errorMessage, 'error');\n      } finally {\n        console.log('üèÅ Submission process completed');\n        this.submitting = false;\n      }\n    },\n    async uploadBeneficiaryVerification(requestId) {\n      try {\n        console.log('üîç Starting beneficiary verification upload for request:', requestId);\n\n        // First, get the beneficiary ID from the request\n        const api = (await import('@/services/api.js')).default;\n        const requestResponse = await api.get(`/client/document-requests/${requestId}`);\n        if (!requestResponse.data.success || !requestResponse.data.data.beneficiary) {\n          throw new Error('Beneficiary information not found');\n        }\n        const beneficiaryId = requestResponse.data.data.beneficiary.id;\n        console.log('üìã Found beneficiary ID:', beneficiaryId);\n\n        // Upload the verification image\n        const formData = new FormData();\n        formData.append('verification_image', this.uploadedFiles.beneficiary_verification);\n        const uploadResponse = await api.post(`/verification-documents/beneficiary/${beneficiaryId}/verification-image`, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        if (uploadResponse.data.success) {\n          console.log('‚úÖ Beneficiary verification uploaded successfully');\n          this.showToast('Success', 'Family member verification uploaded successfully', 'success');\n        } else {\n          throw new Error(uploadResponse.data.message || 'Upload failed');\n        }\n      } catch (error) {\n        console.error('‚ùå Error uploading beneficiary verification:', error);\n        console.error('‚ùå Error response:', error.response?.data);\n        // Don't throw the error - the request was already created successfully\n        this.showToast('Warning', 'Request created but verification image failed to upload. You can upload it later.', 'warning');\n      }\n    },\n    async uploadPickupFiles(requestId) {\n      try {\n        console.log('üîç Starting file upload for request:', requestId);\n\n        // Import the API service\n        const api = (await import('@/services/api.js')).default;\n\n        // First, get the authorized pickup person ID from the backend\n        const pickupResponse = await api.get(`/client/document-requests/${requestId}/authorization-status`);\n        const pickupPersonId = pickupResponse.data.data?.pickup_person?.id;\n        if (!pickupPersonId) {\n          console.error('‚ùå No pickup person ID found');\n          console.error('‚ùå Response data:', pickupResponse.data);\n          return;\n        }\n        console.log('‚úÖ Found pickup person ID:', pickupPersonId);\n\n        // Upload ID image if available\n        if (this.uploadedFiles.pickup_id_image) {\n          console.log('üì§ Uploading pickup ID image...');\n          const idFormData = new FormData();\n          idFormData.append('id_image', this.uploadedFiles.pickup_id_image);\n          const idResponse = await api.post(`/verification-documents/pickup-person/${pickupPersonId}/id-image`, idFormData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n          console.log('‚úÖ ID image uploaded successfully:', idResponse.data);\n        }\n\n        // Upload authorization document if available\n        if (this.uploadedFiles.pickup_authorization) {\n          console.log('üì§ Uploading authorization document...');\n          const authFormData = new FormData();\n          authFormData.append('authorization_document', this.uploadedFiles.pickup_authorization);\n          const authResponse = await api.post(`/verification-documents/pickup-person/${pickupPersonId}/authorization-document`, authFormData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n          console.log('‚úÖ Authorization document uploaded successfully:', authResponse.data);\n        }\n        console.log('üéâ All pickup files uploaded successfully');\n      } catch (error) {\n        console.error('‚ùå Error uploading pickup files:', error);\n        console.error('‚ùå Error response:', error.response?.data);\n        // Don't throw the error - the request was already created successfully\n        this.showToast('Warning', 'Request created but some files failed to upload. You can upload them later.', 'warning');\n      }\n    },\n    goBack() {\n      this.$router.push({\n        name: 'NewDocumentRequest'\n      });\n    },\n    updateProfile() {\n      // TODO: Navigate to profile update page\n      console.log('Update profile');\n    },\n    showTerms() {\n      // TODO: Show terms and conditions modal\n      console.log('Show terms');\n    },\n    showToast(title, message, type = 'info') {\n      // Log to console for debugging\n      console.log(`[${type.toUpperCase()}] ${title}: ${message}`);\n\n      // Create a simple toast notification\n      const toast = document.createElement('div');\n      toast.className = `toast-notification toast-${type}`;\n      toast.innerHTML = `\n        <div class=\"toast-header\">\n          <strong>${title}</strong>\n          <button type=\"button\" class=\"toast-close\" onclick=\"this.parentElement.parentElement.remove()\">√ó</button>\n        </div>\n        <div class=\"toast-body\">${message}</div>\n      `;\n\n      // Add toast styles if not already added\n      if (!document.getElementById('toast-styles')) {\n        const styles = document.createElement('style');\n        styles.id = 'toast-styles';\n        styles.textContent = `\n          .toast-notification {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            min-width: 300px;\n            background: white;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            z-index: 9999;\n            animation: slideIn 0.3s ease;\n          }\n          .toast-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px 8px;\n            border-bottom: 1px solid #e9ecef;\n          }\n          .toast-body {\n            padding: 8px 16px 12px;\n            color: #6c757d;\n          }\n          .toast-close {\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            color: #6c757d;\n          }\n          .toast-success { border-left: 4px solid #28a745; }\n          .toast-error { border-left: 4px solid #dc3545; }\n          .toast-info { border-left: 4px solid #17a2b8; }\n          .toast-warning { border-left: 4px solid #ffc107; }\n          @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n          }\n        `;\n        document.head.appendChild(styles);\n      }\n\n      // Add toast to page\n      document.body.appendChild(toast);\n\n      // Auto-remove after 5 seconds\n      setTimeout(() => {\n        if (toast.parentElement) {\n          toast.style.animation = 'slideIn 0.3s ease reverse';\n          setTimeout(() => toast.remove(), 300);\n        }\n      }, 5000);\n    },\n    // Verification file upload handlers\n    handleBeneficiaryVerificationFile(file) {\n      console.log('Beneficiary verification file selected:', file.name);\n      this.uploadedFiles.beneficiary_verification = file;\n    },\n    onBeneficiaryVerificationUpload(uploadResult) {\n      console.log('Beneficiary verification uploaded successfully:', uploadResult);\n      this.showToast('Success', 'Family member verification image uploaded successfully', 'success');\n    },\n    onBeneficiaryVerificationError(error) {\n      console.error('Beneficiary verification upload error:', error);\n      this.showToast('Error', 'Failed to upload verification image: ' + (error.response?.data?.message || error.message), 'error');\n    },\n    onBeneficiaryVerificationRemoved() {\n      console.log('Beneficiary verification file removed');\n      this.uploadedFiles.beneficiary_verification = null;\n    },\n    // Pickup person file upload handlers\n    handlePickupIdFile(file) {\n      console.log('Pickup ID file selected:', file.name);\n      this.uploadedFiles.pickup_id_image = file;\n    },\n    onPickupIdUpload(uploadResult) {\n      console.log('Pickup ID uploaded successfully:', uploadResult);\n      this.showToast('Success', 'Pickup person ID image uploaded successfully', 'success');\n    },\n    onPickupIdError(error) {\n      console.error('Pickup ID upload error:', error);\n      this.showToast('Error', 'Failed to upload ID image: ' + (error.response?.data?.message || error.message), 'error');\n    },\n    onPickupIdRemoved() {\n      console.log('Pickup ID file removed');\n      this.uploadedFiles.pickup_id_image = null;\n    },\n    handlePickupAuthFile(file) {\n      console.log('Pickup authorization file selected:', file.name);\n      this.uploadedFiles.pickup_authorization = file;\n    },\n    onPickupAuthUpload(uploadResult) {\n      console.log('Pickup authorization uploaded successfully:', uploadResult);\n      this.showToast('Success', 'Authorization document uploaded successfully', 'success');\n    },\n    onPickupAuthError(error) {\n      console.error('Pickup authorization upload error:', error);\n      this.showToast('Error', 'Failed to upload authorization document: ' + (error.response?.data?.message || error.message), 'error');\n    },\n    onPickupAuthRemoved() {\n      console.log('Pickup authorization file removed');\n      this.uploadedFiles.pickup_authorization = null;\n    },\n    // Address dropdown methods\n    async loadAddressData() {\n      try {\n        this.regions = await addressService.getRegions();\n      } catch (error) {\n        console.error('Error loading address data:', error);\n        this.$toast?.error('Failed to load address data');\n      }\n    },\n    async onRegionChange() {\n      try {\n        this.filteredProvinces = [];\n        this.filteredCities = [];\n        this.filteredBarangays = [];\n\n        // Reset dependent fields\n        this.formData.beneficiary.province_code = '';\n        this.formData.beneficiary.city_code = '';\n        this.formData.beneficiary.barangay_code = '';\n        this.formData.beneficiary.province = '';\n        this.formData.beneficiary.city_municipality = '';\n        this.formData.beneficiary.barangay = '';\n        this.formData.beneficiary.region = '';\n        if (this.formData.beneficiary.region_code) {\n          this.filteredProvinces = await addressService.getProvincesByRegion(this.formData.beneficiary.region_code);\n\n          // Set region name\n          const selectedRegion = this.regions.find(r => r.region_code === this.formData.beneficiary.region_code);\n          if (selectedRegion) {\n            this.formData.beneficiary.region = selectedRegion.region_name;\n          }\n        }\n      } catch (error) {\n        console.error('Error loading provinces:', error);\n        this.$toast?.error('Failed to load provinces');\n      }\n    },\n    async onProvinceChange() {\n      try {\n        this.filteredCities = [];\n        this.filteredBarangays = [];\n\n        // Reset dependent fields\n        this.formData.beneficiary.city_code = '';\n        this.formData.beneficiary.barangay_code = '';\n        this.formData.beneficiary.city_municipality = '';\n        this.formData.beneficiary.barangay = '';\n        if (this.formData.beneficiary.province_code) {\n          this.filteredCities = await addressService.getCitiesByProvince(this.formData.beneficiary.province_code);\n\n          // Set province name\n          const selectedProvince = this.filteredProvinces.find(p => p.province_code === this.formData.beneficiary.province_code);\n          if (selectedProvince) {\n            this.formData.beneficiary.province = selectedProvince.province_name;\n          }\n        }\n      } catch (error) {\n        console.error('Error loading cities:', error);\n        this.$toast?.error('Failed to load cities');\n      }\n    },\n    async onCityChange() {\n      try {\n        this.filteredBarangays = [];\n\n        // Reset dependent fields\n        this.formData.beneficiary.barangay_code = '';\n        this.formData.beneficiary.barangay = '';\n        if (this.formData.beneficiary.city_code) {\n          this.filteredBarangays = await addressService.getBarangaysByCity(this.formData.beneficiary.city_code);\n\n          // Set city name\n          const selectedCity = this.filteredCities.find(c => c.city_code === this.formData.beneficiary.city_code);\n          if (selectedCity) {\n            this.formData.beneficiary.city_municipality = selectedCity.city_name;\n          }\n        }\n      } catch (error) {\n        console.error('Error loading barangays:', error);\n        this.$toast?.error('Failed to load barangays');\n      }\n    },\n    onBarangayChange() {\n      // Set barangay name\n      if (this.formData.beneficiary.barangay_code) {\n        const selectedBarangay = this.filteredBarangays.find(b => b.brgy_code === this.formData.beneficiary.barangay_code);\n        if (selectedBarangay) {\n          this.formData.beneficiary.barangay = selectedBarangay.brgy_name;\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["documentRequestService","clientAuthService","paymentService","addressService","FileUpload","name","components","data","currentStep","submitting","purposeCategories","paymentMethods","originalPaymentMethods","processingFee","basicTax","familyRelationshipError","formData","document_type_id","purpose_category_id","purpose_details","is_third_party_request","beneficiary","first_name","middle_name","last_name","suffix","birth_date","gender","civil_status_id","nationality","phone_number","email","house_number","street","subdivision","barangay","city_municipality","province","postal_code","years_of_residency","months_of_residency","relationship_to_requestor","region_code","province_code","city_code","barangay_code","authorized_pickup","relationship_to_beneficiary","annual_income","income_source","business_name","business_address","business_nature","has_real_property","property_value","property_location","has_personal_property","personal_property_value","has_business","business_gross_receipts","business_type","payment_method_id","agree_to_terms","pickupOption","uploadedFiles","beneficiary_verification","pickup_id_image","pickup_authorization","civilStatuses","clientData","regions","provinces","cities","barangays","filteredProvinces","filteredCities","filteredBarangays","isValidating","computed","cachedClientData","getCurrentUser","shouldShowPurposeDetails","familyVerificationPlaceholder","familyVerificationText","submitButtonDisabled","disabled","console","log","incomeTax","income","additionalTax","Math","floor","min","propertyTax","tax","realValue","personalValue","businessTax","receipts","totalTax","convenienceFee","baseTotal","paymongoMinimum","max","totalFee","mounted","migrateLegacyAuth","token","localStorage","getItem","parsedData","JSON","parse","e","error","loadFormData","methods","profileResponse","getProfile","success","purposeResponse","paymentResponse","Promise","all","getPurposeCategories","getPaymentMethods","loadCivilStatuses","loadAddressData","groupPaymentMethods","showToast","onPurposeChange","sanitizeRequestData","sanitized","key","value","Object","entries","undefined","getFullName","profile","trim","getFullAddress","parts","city","filter","Boolean","length","join","formatGender","charAt","toUpperCase","slice","getCivilStatusName","statusId","statuses","getResidencyDisplay","years","months","push","formatDate","dateString","Date","toLocaleDateString","formatCurrency","amount","parseFloat","toFixed","calculateTax","$forceUpdate","canProceedToNextStep","result","basicValidation","validateBeneficiaryData","paymentValid","validateAuthorizedPickup","nextStep","canProceed","previousStep","selectPaymentMethod","methodId","getActualPaymentMethodId","getPaymentIcon","methodCode","icons","getPurposeCategoryName","category","find","c","id","category_name","getPaymentMethodName","method","m","method_name","getPaymentMethodDisplayName","handlePhoneInput","event","section","target","digitsOnly","replace","limitedValue","substring","handleRequestTypeChange","resetBeneficiaryData","handleGenderChange","validateFamilyRelationship","relationship","allowedRelationships","includes","toLowerCase","handlePickupOptionChange","resetAuthorizedPickupData","region","status_name","required","field","showErrors","setTimeout","handleSubmitClick","handleSubmit","stringify","requestData","parseInt","delivery_method","priority","requestor_notes","monthly_income","property_assessed_value","business_income","occupation","employer_name","employer_address","tin_number","previous_ctc_number","previous_ctc_date_issued","previous_ctc_place_issued","computed_tax","total_fee","total_document_fee","response","submitRequest","uploadBeneficiaryVerification","uploadPickupFiles","$router","params","errorMessage","message","requestId","api","default","requestResponse","get","Error","beneficiaryId","FormData","append","uploadResponse","post","headers","pickupResponse","pickupPersonId","pickup_person","idFormData","idResponse","authFormData","authResponse","goBack","updateProfile","showTerms","title","type","toast","document","createElement","className","innerHTML","getElementById","styles","textContent","head","appendChild","body","parentElement","style","animation","remove","handleBeneficiaryVerificationFile","file","onBeneficiaryVerificationUpload","uploadResult","onBeneficiaryVerificationError","onBeneficiaryVerificationRemoved","handlePickupIdFile","onPickupIdUpload","onPickupIdError","onPickupIdRemoved","handlePickupAuthFile","onPickupAuthUpload","onPickupAuthError","onPickupAuthRemoved","getRegions","$toast","onRegionChange","getProvincesByRegion","selectedRegion","r","region_name","onProvinceChange","getCitiesByProvince","selectedProvince","p","province_name","onCityChange","getBarangaysByCity","selectedCity","city_name","onBarangayChange","selectedBarangay","b","brgy_code","brgy_name"],"sources":["D:\\brgy_docu_hub\\BOSFDR\\src\\components\\client\\CedulaRequest.vue"],"sourcesContent":["<template>\n  <div class=\"cedula-request\">\n    <!-- Header -->\n    <div class=\"page-header\">\n      <div class=\"header-content\">\n        <div class=\"header-main\">\n          <h1 class=\"page-title\">\n            <i class=\"fas fa-id-card\"></i>\n            Cedula (Community Tax Certificate) Request\n          </h1>\n          <p class=\"page-description\">\n            Apply for your Community Tax Certificate online\n          </p>\n        </div>\n        <button class=\"back-btn\" @click=\"goBack\">\n          <i class=\"fas fa-arrow-left\"></i>\n          Back\n        </button>\n      </div>\n    </div>\n\n    <!-- Page Content -->\n    <div class=\"page-content\">\n      <!-- Progress Steps -->\n    <div class=\"progress-steps\">\n      <div class=\"step\" :class=\"{ active: currentStep >= 1, completed: currentStep > 1 }\">\n        <div class=\"step-number\">1</div>\n        <span class=\"step-label\">Personal Info</span>\n      </div>\n      <div class=\"step\" :class=\"{ active: currentStep >= 2, completed: currentStep > 2 }\">\n        <div class=\"step-number\">2</div>\n        <span class=\"step-label\">Income & Assets</span>\n      </div>\n      <div class=\"step\" :class=\"{ active: currentStep >= 3, completed: currentStep > 3 }\">\n        <div class=\"step-number\">3</div>\n        <span class=\"step-label\">Payment</span>\n      </div>\n      <div class=\"step\" :class=\"{ active: currentStep >= 4 }\">\n        <div class=\"step-number\">4</div>\n        <span class=\"step-label\">Review & Submit</span>\n      </div>\n    </div>\n\n    <!-- Form Container -->\n    <div class=\"form-container\">\n      <form @submit.prevent=\"handleSubmit\">\n        \n        <!-- Step 1: Personal Information -->\n        <div v-if=\"currentStep === 1\" class=\"form-step\">\n          <div class=\"step-header\">\n            <h2>Personal Information</h2>\n            <p>Choose who this document is for</p>\n          </div>\n\n          <!-- Request Type Selection -->\n          <div class=\"form-section\">\n            <h3>Who is this document for?</h3>\n            <div class=\"request-type-options\">\n              <label class=\"radio-option\">\n                <input\n                  type=\"radio\"\n                  v-model=\"formData.is_third_party_request\"\n                  :value=\"false\"\n                  @change=\"handleRequestTypeChange\"\n                >\n                <span class=\"radio-custom\"></span>\n                <div class=\"option-content\">\n                  <strong>For myself</strong>\n                  <p>Request document using my profile information</p>\n                </div>\n              </label>\n\n              <label class=\"radio-option\">\n                <input\n                  type=\"radio\"\n                  v-model=\"formData.is_third_party_request\"\n                  :value=\"true\"\n                  @change=\"handleRequestTypeChange\"\n                >\n                <span class=\"radio-custom\"></span>\n                <div class=\"option-content\">\n                  <strong>For someone else</strong>\n                  <p>Request document on behalf of another person</p>\n                </div>\n              </label>\n            </div>\n          </div>\n\n          <!-- Profile Preview (shown when requesting for self) -->\n          <div v-if=\"!formData.is_third_party_request\" class=\"profile-preview\">\n            <div class=\"profile-card\">\n              <div class=\"profile-info\">\n                <h3>{{ getFullName() }}</h3>\n                <div class=\"info-grid\">\n                  <div class=\"info-item\">\n                    <label>Email:</label>\n                    <span>{{ (clientData?.email || clientData?.profile?.email) || 'Not provided' }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Phone:</label>\n                    <span>{{ (clientData?.phone_number || clientData?.profile?.phone_number) || 'Not provided' }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Address:</label>\n                    <span>{{ getFullAddress() }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Date of Birth:</label>\n                    <span>{{ formatDate(clientData?.birth_date || clientData?.profile?.birth_date) }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Gender:</label>\n                    <span>{{ formatGender(clientData?.gender || clientData?.profile?.gender) || 'Not provided' }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Civil Status:</label>\n                    <span>{{ getCivilStatusName(clientData?.civil_status_id || clientData?.profile?.civil_status_id) }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Nationality:</label>\n                    <span>{{ (clientData?.nationality || clientData?.profile?.nationality) || 'Not provided' }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Years of Residency:</label>\n                    <span>{{ getResidencyDisplay() }}</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <label>Citizenship:</label>\n                    <span>{{ clientData?.profile?.citizenship || 'Filipino' }}</span>\n                  </div>\n                </div>\n              </div>\n\n              <!-- ill comment this status because I dont use this -->\n              <!-- <div class=\"profile-actions\">\n                <button type=\"button\" class=\"update-profile-btn\" @click=\"updateProfile\">\n                  <i class=\"fas fa-edit\"></i>\n                  Update Profile\n                </button>\n              </div> -->\n            </div>\n          </div>\n\n          <!-- Beneficiary Information Form (shown when third-party is selected) -->\n          <div v-if=\"formData.is_third_party_request\" class=\"beneficiary-section\">\n            <h3>Person this document is for</h3>\n\n            <div class=\"form-grid\">\n              <div class=\"form-group\">\n                <label>First Name *</label>\n                <input\n                  type=\"text\"\n                  v-model=\"formData.beneficiary.first_name\"\n                  required\n                  class=\"form-control\"\n                >\n              </div>\n\n              <div class=\"form-group\">\n                <label>Middle Name</label>\n                <input\n                  type=\"text\"\n                  v-model=\"formData.beneficiary.middle_name\"\n                  class=\"form-control\"\n                >\n              </div>\n\n              <div class=\"form-group\">\n                <label>Last Name *</label>\n                <input\n                  type=\"text\"\n                  v-model=\"formData.beneficiary.last_name\"\n                  required\n                  class=\"form-control\"\n                >\n              </div>\n\n              <div class=\"form-group\">\n                <label>Date of Birth *</label>\n                <input\n                  type=\"date\"\n                  v-model=\"formData.beneficiary.birth_date\"\n                  required\n                  class=\"form-control\"\n                >\n              </div>\n\n              <div class=\"form-group\">\n                <label>Gender *</label>\n                <select v-model=\"formData.beneficiary.gender\" required class=\"form-control\" @change=\"handleGenderChange\">\n                  <option value=\"\">Select Gender</option>\n                  <option value=\"male\">Male</option>\n                  <option value=\"female\">Female</option>\n                </select>\n              </div>\n\n              <div class=\"form-group\" v-if=\"formData.beneficiary.gender === 'male'\">\n                <label>Suffix</label>\n                <select v-model=\"formData.beneficiary.suffix\" class=\"form-control\">\n                  <option value=\"\">None</option>\n                  <option value=\"Jr\">Jr</option>\n                  <option value=\"Sr\">Sr</option>\n                  <option value=\"II\">II</option>\n                  <option value=\"III\">III</option>\n                </select>\n              </div>\n\n              <div class=\"form-group\">\n                <label>Civil Status *</label>\n                <select v-model=\"formData.beneficiary.civil_status_id\" required class=\"form-control\">\n                  <option value=\"\">Select Status</option>\n                  <option v-for=\"status in civilStatuses\" :key=\"status.id\" :value=\"status.id\">\n                    {{ status.status_name }}\n                  </option>\n                </select>\n              </div>\n\n              <div class=\"form-group\">\n                <label>Relationship to You *</label>\n                <select v-model=\"formData.beneficiary.relationship_to_requestor\" required class=\"form-control\" @change=\"validateFamilyRelationship\">\n                  <option value=\"\">Select Relationship</option>\n                  <option value=\"spouse\">Spouse</option>\n                  <option value=\"child\">Child</option>\n                  <option value=\"parent\">Parent</option>\n                  <option value=\"sibling\">Sibling</option>\n                </select>\n                <small class=\"form-text text-muted\">\n                  Note: You can only request documents on behalf of immediate family members (spouse, children, parents, siblings).\n                </small>\n                <div v-if=\"familyRelationshipError\" class=\"alert alert-danger mt-2\">\n                  {{ familyRelationshipError }}\n                </div>\n              </div>\n            </div>\n\n            <!-- Family Member Verification -->\n            <div class=\"verification-section\">\n              <h4>Family Member Verification</h4>\n              <div class=\"alert alert-info\">\n                <i class=\"fas fa-info-circle\"></i>\n                {{ familyVerificationText }}\n              </div>\n\n              <FileUpload\n                label=\"Family Member Verification Image\"\n                :placeholder=\"familyVerificationPlaceholder\"\n                :required=\"true\"\n                accepted-types=\"image/*\"\n                accepted-types-text=\"Accepted: JPEG, PNG, GIF (Max 5MB)\"\n                help-text=\"Upload a clear photo of the family member's valid government-issued ID for verification purposes.\"\n                @file-selected=\"handleBeneficiaryVerificationFile\"\n                @upload-success=\"onBeneficiaryVerificationUpload\"\n                @upload-error=\"onBeneficiaryVerificationError\"\n                @file-removed=\"onBeneficiaryVerificationRemoved\"\n              />\n            </div>\n\n            <!-- Address Information -->\n            <h4>Address Information</h4>\n            <div class=\"form-grid\">\n              <div class=\"form-group\">\n                <label>House Number</label>\n                <input type=\"text\" v-model=\"formData.beneficiary.house_number\" class=\"form-control\">\n              </div>\n\n              <div class=\"form-group\">\n                <label>Street</label>\n                <input type=\"text\" v-model=\"formData.beneficiary.street\" class=\"form-control\">\n              </div>\n\n              <!-- Hidden address fields with default values -->\n              <input type=\"hidden\" v-model=\"formData.beneficiary.region_code\">\n              <input type=\"hidden\" v-model=\"formData.beneficiary.province_code\">\n              <input type=\"hidden\" v-model=\"formData.beneficiary.city_code\">\n              <input type=\"hidden\" v-model=\"formData.beneficiary.barangay_code\">\n\n              <!-- Display current address -->\n              <div class=\"form-group col-span-2\">\n                <div class=\"alert alert-info\">\n                  <h6><i class=\"fas fa-map-marker-alt me-2\"></i>Address Information</h6>\n                  <p class=\"mb-0\">\n                    <strong>Region:</strong> Region XII (SOCCSKSARGEN)<br>\n                    <strong>Province:</strong> South Cotabato<br>\n                    <strong>City/Municipality:</strong> General Santos City (Dadiangas)<br>\n                    <strong>Barangay:</strong> Bula\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <!-- Contact Information -->\n            <h4>Contact Information</h4>\n            <div class=\"form-grid\">\n              <div class=\"form-group\">\n                <label>Phone Number</label>\n                <input\n                  type=\"tel\"\n                  v-model=\"formData.beneficiary.phone_number\"\n                  class=\"form-control\"\n                  @input=\"handlePhoneInput($event, 'beneficiary')\"\n                  placeholder=\"09123456789\"\n                  maxlength=\"11\"\n                  pattern=\"[0-9]*\"\n                >\n              </div>\n\n              <div class=\"form-group\">\n                <label>Email Address</label>\n                <input type=\"email\" v-model=\"formData.beneficiary.email\" class=\"form-control\">\n              </div>\n            </div>\n\n\n          </div>\n\n          <!-- Purpose Information -->\n          <div class=\"form-section\">\n            <h3>Purpose of Cedula</h3>\n            <div class=\"form-group\">\n              <label for=\"purpose_category\">Purpose Category *</label>\n              <select\n                id=\"purpose_category\"\n                v-model=\"formData.purpose_category_id\"\n                required\n                @change=\"onPurposeChange\"\n              >\n                <option value=\"\">Select purpose</option>\n                <option\n                  v-for=\"category in purposeCategories\"\n                  :key=\"category.id\"\n                  :value=\"category.id\"\n                >\n                  {{ category.category_name }}\n                </option>\n              </select>\n            </div>\n\n            <div v-if=\"shouldShowPurposeDetails\" class=\"form-group\">\n              <label for=\"purpose_details\">Purpose Details *</label>\n              <textarea\n                id=\"purpose_details\"\n                v-model=\"formData.purpose_details\"\n                rows=\"3\"\n                required\n                placeholder=\"Please provide specific details about the purpose of this cedula\"\n              ></textarea>\n            </div>\n          </div>\n        </div>\n\n        <!-- Step 2: Income and Assets Information -->\n        <div v-if=\"currentStep === 2\" class=\"form-step\">\n          <div class=\"step-header\">\n            <h2>Income and Assets Information</h2>\n            <p>Please provide accurate information for tax computation</p>\n          </div>\n\n          <!-- Income Information -->\n          <div class=\"form-section\">\n            <h3>Income Information</h3>\n            <div class=\"form-grid\">\n              <div class=\"form-group\">\n                <label for=\"annual_income\">Annual Income (‚Ç±) *</label>\n                <input\n                  id=\"annual_income\"\n                  v-model.number=\"formData.annual_income\"\n                  type=\"number\"\n                  min=\"0\"\n                  step=\"0.01\"\n                  required\n                  placeholder=\"0.00\"\n                  @input=\"calculateTax\"\n                />\n              </div>\n              <div class=\"form-group\">\n                <label for=\"income_source\">Primary Income Source *</label>\n                <select\n                  id=\"income_source\"\n                  v-model=\"formData.income_source\"\n                  required\n                >\n                  <option value=\"\">Select income source</option>\n                  <option value=\"Employment\">Employment/Salary</option>\n                  <option value=\"Business\">Business</option>\n                  <option value=\"Professional\">Professional Practice</option>\n                  <option value=\"Agriculture\">Agriculture</option>\n                  <option value=\"Pension\">Pension</option>\n                  <option value=\"Investment\">Investment</option>\n                  <!-- <option value=\"Other\">Other</option> -->\n                </select>\n              </div>\n            </div>\n          </div>\n\n          <!-- Business Information (if applicable) -->\n          <div v-if=\"formData.income_source === 'Business' || formData.income_source === 'Professional'\" class=\"form-section\">\n            <h3>Business/Professional Information</h3>\n            <div class=\"form-grid\">\n              <div class=\"form-group\">\n                <label for=\"business_name\">Business/Practice Name</label>\n                <input\n                  id=\"business_name\"\n                  v-model=\"formData.business_name\"\n                  type=\"text\"\n                  placeholder=\"Name of business or professional practice\"\n                />\n              </div>\n              <div class=\"form-group\">\n                <label for=\"business_address\">Business Address</label>\n                <textarea\n                  id=\"business_address\"\n                  v-model=\"formData.business_address\"\n                  rows=\"2\"\n                  placeholder=\"Complete business address\"\n                ></textarea>\n              </div>\n              <div class=\"form-group\">\n                <label for=\"business_nature\">Nature of Business/Profession</label>\n                <input\n                  id=\"business_nature\"\n                  v-model=\"formData.business_nature\"\n                  type=\"text\"\n                  placeholder=\"e.g., Retail, Consulting, Medical Practice\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <!-- Property Information -->\n          <div class=\"form-section\">\n            <h3>Property Information</h3>\n            <div class=\"form-group\">\n              <label for=\"has_real_property\">Do you own real property? *</label>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input\n                    type=\"radio\"\n                    v-model=\"formData.has_real_property\"\n                    :value=\"false\"\n                    required\n                  />\n                  <span class=\"radio-custom\"></span>\n                  No\n                </label>\n                <label class=\"radio-option\">\n                  <input\n                    type=\"radio\"\n                    v-model=\"formData.has_real_property\"\n                    :value=\"true\"\n                    required\n                  />\n                  <span class=\"radio-custom\"></span>\n                  Yes\n                </label>\n              </div>\n            </div>\n\n            <div v-if=\"formData.has_real_property\" class=\"form-grid\">\n              <div class=\"form-group\">\n                <label for=\"property_value\">Assessed Property Value (‚Ç±) *</label>\n                <input\n                  id=\"property_value\"\n                  v-model.number=\"formData.property_value\"\n                  type=\"number\"\n                  min=\"0\"\n                  step=\"0.01\"\n                  required\n                  placeholder=\"0.00\"\n                  @input=\"calculateTax\"\n                />\n              </div>\n              <div class=\"form-group\">\n                <label for=\"property_location\">Property Location</label>\n                <textarea\n                  id=\"property_location\"\n                  v-model=\"formData.property_location\"\n                  rows=\"2\"\n                  placeholder=\"Complete property address\"\n                ></textarea>\n              </div>\n            </div>\n          </div>\n\n          <!-- Personal Property Information -->\n          <div class=\"form-section\">\n            <h3>Personal Property Information</h3>\n            <div class=\"form-group\">\n              <label for=\"has_personal_property\">Do you own personal property worth ‚Ç±1,000 or more? *</label>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input\n                    type=\"radio\"\n                    v-model=\"formData.has_personal_property\"\n                    :value=\"false\"\n                    required\n                  />\n                  <span class=\"radio-custom\"></span>\n                  No\n                </label>\n                <label class=\"radio-option\">\n                  <input\n                    type=\"radio\"\n                    v-model=\"formData.has_personal_property\"\n                    :value=\"true\"\n                    required\n                  />\n                  <span class=\"radio-custom\"></span>\n                  Yes\n                </label>\n              </div>\n            </div>\n\n            <div v-if=\"formData.has_personal_property\" class=\"form-group\">\n              <label for=\"personal_property_value\">Personal Property Value (‚Ç±) *</label>\n              <input\n                id=\"personal_property_value\"\n                v-model.number=\"formData.personal_property_value\"\n                type=\"number\"\n                min=\"1000\"\n                step=\"0.01\"\n                required\n                placeholder=\"1000.00\"\n                @input=\"calculateTax\"\n              />\n              <small class=\"field-note\">Include vehicles, jewelry, equipment, etc. worth ‚Ç±1,000 or more</small>\n            </div>\n          </div>\n\n          <!-- Business/Professional Information -->\n          <div class=\"form-section\">\n            <h3>Business/Professional Information</h3>\n            <div class=\"form-group\">\n              <label for=\"has_business\">Do you own a business or practice a profession? *</label>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input\n                    type=\"radio\"\n                    v-model=\"formData.has_business\"\n                    :value=\"false\"\n                    required\n                  />\n                  <span class=\"radio-custom\"></span>\n                  No\n                </label>\n                <label class=\"radio-option\">\n                  <input\n                    type=\"radio\"\n                    v-model=\"formData.has_business\"\n                    :value=\"true\"\n                    required\n                  />\n                  <span class=\"radio-custom\"></span>\n                  Yes\n                </label>\n              </div>\n            </div>\n\n            <div v-if=\"formData.has_business\" class=\"form-grid\">\n              <div class=\"form-group\">\n                <label for=\"business_gross_receipts\">Annual Gross Receipts/Professional Fees (‚Ç±) *</label>\n                <input\n                  id=\"business_gross_receipts\"\n                  v-model.number=\"formData.business_gross_receipts\"\n                  type=\"number\"\n                  min=\"0\"\n                  step=\"0.01\"\n                  required\n                  placeholder=\"0.00\"\n                  @input=\"calculateTax\"\n                />\n              </div>\n              <div class=\"form-group\">\n                <label for=\"business_type\">Type of Business/Profession</label>\n                <select\n                  id=\"business_type\"\n                  v-model=\"formData.business_type\"\n                >\n                  <option value=\"\">Select type</option>\n                  <option value=\"retail\">Retail Business</option>\n                  <option value=\"wholesale\">Wholesale Business</option>\n                  <option value=\"manufacturing\">Manufacturing</option>\n                  <option value=\"services\">Service Business</option>\n                  <option value=\"professional\">Professional Practice</option>\n                  <!-- <option value=\"other\">Other</option> -->\n                </select>\n              </div>\n            </div>\n          </div>\n\n          <!-- Tax Computation -->\n          <div class=\"tax-computation\">\n            <div class=\"tax-card\">\n              <h3>Tax Computation</h3>\n              <div class=\"tax-breakdown\">\n                <!-- Basic Community Tax removed - now included in bracket calculation -->\n                <div class=\"tax-item\">\n                  <span>Income Tax (‚Ç±1 per ‚Ç±1,000):</span>\n                  <span>‚Ç±{{ formatCurrency(incomeTax) }}</span>\n                </div>\n                <div v-if=\"formData.has_real_property || formData.has_personal_property\" class=\"tax-item\">\n                  <span>Property Tax:</span>\n                  <span>‚Ç±{{ formatCurrency(propertyTax) }}</span>\n                </div>\n                <div v-if=\"formData.has_business\" class=\"tax-item\">\n                  <span>Business Tax (‚Ç±1 per ‚Ç±1,000):</span>\n                  <span>‚Ç±{{ formatCurrency(businessTax) }}</span>\n                </div>\n                <div class=\"tax-item total\">\n                  <span>Total Cedula Tax:</span>\n                  <span>‚Ç±{{ formatCurrency(totalTax) }}</span>\n                </div>\n              </div>\n              <div class=\"tax-note\">\n                <i class=\"fas fa-info-circle\"></i>\n                <p>Tax computation is based on current rates and may be subject to verification.</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Step 3: Payment Method -->\n        <div v-if=\"currentStep === 3\" class=\"form-step\">\n          <div class=\"step-header\">\n            <h2>Payment Information</h2>\n            <p>Choose your preferred payment method</p>\n          </div>\n\n          <!-- Fee Summary -->\n          <div class=\"fee-summary\">\n            <div class=\"fee-card\">\n              <h3>Fee Breakdown</h3>\n              <div class=\"fee-items\">\n                <div class=\"fee-item\">\n                  <span>Cedula Tax</span>\n                  <span>‚Ç±{{ formatCurrency(totalTax) }}</span>\n                </div>\n                <div class=\"fee-item\">\n                  <span>Processing Fee</span>\n                  <span>‚Ç±{{ formatCurrency(processingFee) }}</span>\n                </div>\n                <div class=\"fee-item\" v-if=\"convenienceFee > 0\">\n                  <span>Convenience Fee</span>\n                  <small class=\"text-muted d-block\">PayMongo minimum payment requirement</small>\n                  <span>‚Ç±{{ formatCurrency(convenienceFee) }}</span>\n                </div>\n                <div class=\"fee-item total\">\n                  <span>Total Amount</span>\n                  <span>‚Ç±{{ formatCurrency(totalFee) }}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- Payment Methods -->\n          <div class=\"form-section\">\n            <h3>Select Payment Method</h3>\n            <div class=\"payment-methods\">\n              <div\n                v-for=\"method in paymentMethods\"\n                :key=\"method.id\"\n                class=\"payment-option\"\n                :class=\"{ selected: formData.payment_method_id === method.id }\"\n                @click=\"selectPaymentMethod(method.id)\"\n              >\n                <div class=\"payment-icon\">\n                  <i :class=\"getPaymentIcon(method.method_code)\"></i>\n                </div>\n                <div class=\"payment-info\">\n                  <h4>{{ method.method_name }}</h4>\n                  <p v-if=\"method.description\">{{ method.description }}</p>\n                  <div v-if=\"method.group_type === 'group' && method.grouped_methods\" class=\"grouped-methods-preview\">\n                    <small class=\"text-muted\">\n                      Includes: {{ method.grouped_methods.map(m => getPaymentMethodDisplayName(m.method_code)).join(', ') }}\n                    </small>\n                  </div>\n                </div>\n                <div class=\"payment-radio\">\n                  <input\n                    type=\"radio\"\n                    :value=\"method.id\"\n                    v-model=\"formData.payment_method_id\"\n                    required\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- Pickup Options -->\n          <div class=\"form-section\">\n            <h3>Document Pickup</h3>\n\n            <div class=\"pickup-options\">\n              <label class=\"radio-option\">\n                <input\n                  type=\"radio\"\n                  v-model=\"pickupOption\"\n                  value=\"self\"\n                  @change=\"handlePickupOptionChange\"\n                >\n                <span class=\"radio-custom\"></span>\n                <div class=\"option-content\">\n                  <strong>I will pick up personally</strong>\n                  <p>{{ formData.is_third_party_request ? 'You (the requestor)' : 'You' }} will collect the document</p>\n                </div>\n              </label>\n\n              <label class=\"radio-option\">\n                <input\n                  type=\"radio\"\n                  v-model=\"pickupOption\"\n                  value=\"authorized\"\n                  @change=\"handlePickupOptionChange\"\n                >\n                <span class=\"radio-custom\"></span>\n                <div class=\"option-content\">\n                  <strong>Someone else will pick up</strong>\n                  <p>Authorize another person to collect the document</p>\n                </div>\n              </label>\n            </div>\n\n            <!-- Authorized Pickup Person Form -->\n            <div v-if=\"pickupOption === 'authorized'\" class=\"authorized-pickup-form\">\n              <h4>Authorized Pickup Person</h4>\n              <div class=\"alert alert-info\">\n                <i class=\"fas fa-info-circle\"></i>\n                You will need to upload an authorization letter and valid ID after submitting this request.\n              </div>\n\n              <div class=\"form-grid\">\n                <div class=\"form-group\">\n                  <label>First Name *</label>\n                  <input\n                    type=\"text\"\n                    v-model=\"formData.authorized_pickup.first_name\"\n                    required\n                    class=\"form-control\"\n                  >\n                </div>\n\n                <div class=\"form-group\">\n                  <label>Middle Name</label>\n                  <input\n                    type=\"text\"\n                    v-model=\"formData.authorized_pickup.middle_name\"\n                    class=\"form-control\"\n                  >\n                </div>\n\n                <div class=\"form-group\">\n                  <label>Last Name *</label>\n                  <input\n                    type=\"text\"\n                    v-model=\"formData.authorized_pickup.last_name\"\n                    required\n                    class=\"form-control\"\n                  >\n                </div>\n\n                <div class=\"form-group\">\n                  <label>Phone Number *</label>\n                  <input\n                    type=\"tel\"\n                    v-model=\"formData.authorized_pickup.phone_number\"\n                    required\n                    class=\"form-control\"\n                    @input=\"handlePhoneInput($event, 'authorized_pickup')\"\n                    placeholder=\"09123456789\"\n                    maxlength=\"11\"\n                    pattern=\"[0-9]*\"\n                  >\n                </div>\n\n                <!-- Valid ID Image Upload -->\n                <div class=\"form-group\">\n                  <FileUpload\n                    label=\"Valid ID Image\"\n                    placeholder=\"Click to upload pickup person's valid ID\"\n                    :required=\"true\"\n                    accepted-types=\"image/*\"\n                    accepted-types-text=\"Accepted: JPEG, PNG, GIF (Max 5MB)\"\n                    help-text=\"Upload a clear photo of the pickup person's valid government-issued ID.\"\n                    @file-selected=\"handlePickupIdFile\"\n                    @upload-success=\"onPickupIdUpload\"\n                    @upload-error=\"onPickupIdError\"\n                    @file-removed=\"onPickupIdRemoved\"\n                  />\n                </div>\n\n                <!-- Authorization Letter Upload -->\n                <div class=\"form-group\">\n                  <FileUpload\n                    label=\"Authorization Letter\"\n                    placeholder=\"Click to upload authorization letter\"\n                    :required=\"true\"\n                    accepted-types=\"image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\n                    accepted-types-text=\"Accepted: Images, PDF, Word documents (Max 5MB)\"\n                    help-text=\"Upload the authorization letter allowing this person to pick up the document on your behalf.\"\n                    @file-selected=\"handlePickupAuthFile\"\n                    @upload-success=\"onPickupAuthUpload\"\n                    @upload-error=\"onPickupAuthError\"\n                    @file-removed=\"onPickupAuthRemoved\"\n                  />\n                </div>\n\n                <div class=\"form-group\">\n                  <label>Relationship to {{ formData.is_third_party_request ? 'Beneficiary' : 'You' }} *</label>\n                  <select v-model=\"formData.authorized_pickup.relationship_to_beneficiary\" required class=\"form-control\">\n                    <option value=\"\">Select Relationship</option>\n                    <option value=\"spouse\">Spouse</option>\n                    <option value=\"child\">Child</option>\n                    <option value=\"parent\">Parent</option>\n                    <option value=\"sibling\">Sibling</option>\n                    <option value=\"relative\">Other Relative</option>\n                    <option value=\"friend\">Friend</option>\n                    <option value=\"colleague\">Colleague</option>\n                    <!-- <option value=\"other\">Other</option> -->\n                  </select>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Step 4: Review and Submit -->\n        <div v-if=\"currentStep === 4\" class=\"form-step\">\n          <div class=\"step-header\">\n            <h2>Review Your Request</h2>\n            <p>Please review all information before submitting</p>\n          </div>\n\n          <div class=\"review-sections\">\n            <!-- Personal Information Review -->\n            <div class=\"review-section\">\n              <h3>Personal Information</h3>\n              <div class=\"review-grid\">\n                <div class=\"review-item\">\n                  <label>Full Name:</label>\n                  <span>{{ getFullName() }}</span>\n                </div>\n                <div class=\"review-item\">\n                  <label>Purpose:</label>\n                  <span>{{ getPurposeCategoryName() }}</span>\n                </div>\n                <div v-if=\"shouldShowPurposeDetails && formData.purpose_details\" class=\"review-item\">\n                  <label>Purpose Details:</label>\n                  <span>{{ formData.purpose_details }}</span>\n                </div>\n              </div>\n            </div>\n\n            <!-- Income & Assets Review -->\n            <div class=\"review-section\">\n              <h3>Income & Assets Information</h3>\n              <div class=\"review-grid\">\n                <div class=\"review-item\">\n                  <label>Annual Income:</label>\n                  <span>‚Ç±{{ formatCurrency(formData.annual_income) }}</span>\n                </div>\n                <div class=\"review-item\">\n                  <label>Income Source:</label>\n                  <span>{{ formData.income_source }}</span>\n                </div>\n                <div v-if=\"formData.business_name\" class=\"review-item\">\n                  <label>Business/Practice:</label>\n                  <span>{{ formData.business_name }}</span>\n                </div>\n                <div class=\"review-item\">\n                  <label>Real Property:</label>\n                  <span>{{ formData.has_real_property ? 'Yes' : 'No' }}</span>\n                </div>\n                <div v-if=\"formData.has_real_property\" class=\"review-item\">\n                  <label>Property Value:</label>\n                  <span>‚Ç±{{ formatCurrency(formData.property_value) }}</span>\n                </div>\n              </div>\n            </div>\n\n            <!-- Tax Computation Review -->\n            <div class=\"review-section\">\n              <h3>Tax Computation</h3>\n              <div class=\"review-grid\">\n                <!-- Basic Community Tax removed - now included in bracket calculation -->\n                <div class=\"review-item\">\n                  <label>Income Tax:</label>\n                  <span>‚Ç±{{ formatCurrency(incomeTax) }}</span>\n                </div>\n                <div v-if=\"formData.has_real_property\" class=\"review-item\">\n                  <label>Property Tax:</label>\n                  <span>‚Ç±{{ formatCurrency(propertyTax) }}</span>\n                </div>\n                <div class=\"review-item\">\n                  <label>Cedula Tax:</label>\n                  <span class=\"amount\">‚Ç±{{ formatCurrency(totalTax) }}</span>\n                </div>\n              </div>\n            </div>\n\n            <!-- Payment Review -->\n            <div class=\"review-section\">\n              <h3>Payment Information</h3>\n              <div class=\"review-grid\">\n                <div class=\"review-item\">\n                  <label>Payment Method:</label>\n                  <span>{{ getPaymentMethodName() }}</span>\n                </div>\n                <div class=\"review-item\">\n                  <label>Total Amount:</label>\n                  <span class=\"amount\">‚Ç±{{ formatCurrency(totalFee) }}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- Terms and Conditions -->\n          <div class=\"terms-section\">\n            <label class=\"checkbox-option\">\n              <input\n                type=\"checkbox\"\n                v-model=\"formData.agree_to_terms\"\n                required\n              />\n              <span class=\"checkbox-custom\"></span>\n              I certify that all information provided is true and accurate to the best of my knowledge, and I agree to the <a href=\"#\" @click.prevent=\"showTerms\">terms and conditions</a>.\n            </label>\n          </div>\n        </div>\n\n        <!-- Form Actions -->\n        <div class=\"form-actions\">\n          <button\n            v-if=\"currentStep > 1\"\n            type=\"button\"\n            class=\"btn-secondary\"\n            @click=\"previousStep\"\n          >\n            <i class=\"fas fa-chevron-left\"></i>\n            Previous\n          </button>\n          \n          <button\n            v-if=\"currentStep < 4\"\n            type=\"button\"\n            class=\"btn-primary\"\n            @click=\"nextStep\"\n            :disabled=\"!canProceedToNextStep()\"\n          >\n            Next\n            <i class=\"fas fa-chevron-right\"></i>\n          </button>\n          \n          <button\n            v-if=\"currentStep === 4\"\n            type=\"submit\"\n            class=\"btn-submit\"\n            :disabled=\"submitButtonDisabled\"\n            @click=\"handleSubmitClick\"\n          >\n            <template v-if=\"submitting\">\n              <i class=\"fas fa-spinner fa-spin\"></i>\n              Submitting...\n            </template>\n            <template v-else>\n              <i class=\"fas fa-paper-plane\"></i>\n              Submit Request\n            </template>\n          </button>\n        </div>\n      </form>\n    </div>\n    </div> <!-- End page-content -->\n  </div>\n</template>\n\n<script>\nimport documentRequestService from '@/services/documentRequestService';\nimport clientAuthService from '@/services/clientAuthService';\nimport paymentService from '@/services/paymentService';\nimport addressService from '@/services/addressService';\nimport FileUpload from '@/components/common/FileUpload.vue';\n\nexport default {\n  name: 'CedulaRequest',\n  components: {\n    FileUpload\n  },\n  data() {\n    return {\n      currentStep: 1,\n      submitting: false,\n      purposeCategories: [],\n      paymentMethods: [], // Grouped payment methods for display\n      originalPaymentMethods: [], // Original payment methods from backend\n      processingFee: 5.00, // Processing fee\n      basicTax: 5.00, // Basic community tax\n      familyRelationshipError: null,\n      formData: {\n        document_type_id: 1, // Cedula\n        purpose_category_id: '',\n        purpose_details: '',\n        is_third_party_request: false,\n\n        beneficiary: {\n          first_name: '',\n          middle_name: '',\n          last_name: '',\n          suffix: '',\n          birth_date: '',\n          gender: '',\n          civil_status_id: '',\n          nationality: 'Filipino',\n          phone_number: '',\n          email: '',\n          house_number: '',\n          street: '',\n          subdivision: '',\n          barangay: 'Bula',\n          city_municipality: 'General Santos City (Dadiangas)',\n          province: 'South Cotabato',\n          postal_code: '',\n          years_of_residency: null,\n          months_of_residency: null,\n          relationship_to_requestor: '',\n          region_code: '12',\n          province_code: '1263',\n          city_code: '126303',\n          barangay_code: '126303005'\n        },\n\n        authorized_pickup: {\n          first_name: '',\n          middle_name: '',\n          last_name: '',\n          suffix: '',\n          phone_number: '',\n          email: '',\n          relationship_to_beneficiary: ''\n        },\n\n        annual_income: 0,\n        income_source: '',\n        business_name: '',\n        business_address: '',\n        business_nature: '',\n        has_real_property: false,\n        property_value: 0,\n        property_location: '',\n        has_personal_property: false,\n        personal_property_value: 0,\n        has_business: false,\n        business_gross_receipts: 0,\n        business_type: '',\n        payment_method_id: '',\n        agree_to_terms: false\n      },\n\n      pickupOption: 'self', // 'self' or 'authorized'\n      uploadedFiles: {\n        beneficiary_verification: null,\n        pickup_id_image: null,\n        pickup_authorization: null\n      },\n      civilStatuses: [],\n      clientData: null, // Fresh profile data\n\n      // Address dropdown data\n      regions: [],\n      provinces: [],\n      cities: [],\n      barangays: [],\n      filteredProvinces: [],\n      filteredCities: [],\n      filteredBarangays: [],\n\n      // Validation control\n      isValidating: false\n    };\n  },\n  computed: {\n    // Keep the old method as fallback\n    cachedClientData() {\n      return clientAuthService.getCurrentUser();\n    },\n\n    shouldShowPurposeDetails() {\n      // Show purpose details only when \"Other\" category (id=10) is selected\n      return this.formData.purpose_category_id === 10;\n    },\n\n    familyVerificationPlaceholder() {\n      // Dynamic placeholder based on relationship selection\n      if (this.formData.beneficiary.relationship_to_requestor === 'spouse') {\n        return 'Click to upload spouse verification image';\n      }\n      return 'Click to upload family Member Verification Image';\n    },\n\n    familyVerificationText() {\n      // Dynamic verification text based on relationship selection\n      if (this.formData.beneficiary.relationship_to_requestor === 'spouse') {\n        return 'To verify that this person is indeed your spouse, please upload a clear photo of Marriage Application.';\n      }\n      return 'To verify that this person is indeed your family member, please upload a clear photo of their valid ID (Driver\\'s License, National ID, Passport, etc.).';\n    },\n\n    // Debug computed property for submit button state\n    submitButtonDisabled() {\n      const disabled = this.submitting || !this.formData.agree_to_terms;\n      console.log('üîò Submit button disabled:', disabled, {\n        submitting: this.submitting,\n        agree_to_terms: this.formData.agree_to_terms,\n        currentStep: this.currentStep\n      });\n      return disabled;\n    },\n    incomeTax() {\n      const income = this.formData.annual_income || 0;\n\n      // Official Philippine Community Tax Formula (2024)\n      // Source: Local Government Code, MoneyMax 2024 guide\n      // Additional tax: ‚Ç±1 for every ‚Ç±1,000 of gross earnings\n      const additionalTax = Math.floor(income / 1000) * 1.00;\n\n      return Math.min(additionalTax, 5000); // Maximum additional tax ‚Ç±5,000\n    },\n    propertyTax() {\n      let tax = 0;\n\n      // Real property tax - FIXED: Use ‚Ç±1 per ‚Ç±1,000 formula (Philippine Community Tax Law)\n      if (this.formData.has_real_property) {\n        const realValue = this.formData.property_value || 0;\n        tax += Math.floor(realValue / 1000) * 1.00;\n      }\n\n      // Personal property tax - FIXED: Use ‚Ç±1 per ‚Ç±1,000 formula (Philippine Community Tax Law)\n      if (this.formData.has_personal_property) {\n        const personalValue = this.formData.personal_property_value || 0;\n        tax += Math.floor(personalValue / 1000) * 1.00;\n      }\n\n      return Math.min(tax, 5000); // Maximum property tax\n    },\n    businessTax() {\n      if (!this.formData.has_business) return 0;\n      const receipts = this.formData.business_gross_receipts || 0;\n      // FIXED: Use ‚Ç±1 per ‚Ç±1,000 formula (Philippine Community Tax Law)\n      const tax = Math.floor(receipts / 1000) * 1.00;\n      return Math.min(tax, 5000); // Maximum business tax\n    },\n    totalTax() {\n      // Official Philippine Community Tax Formula (2024)\n      const basicTax = 5.00; // Basic community tax minimum ‚Ç±5\n      const additionalTax = this.incomeTax + this.propertyTax + this.businessTax;\n      return basicTax + additionalTax;\n    },\n    convenienceFee() {\n      // PayMongo minimum payment requirement: ‚Ç±100.00 (confirmed by API testing)\n      const baseTotal = this.totalTax + this.processingFee;\n      const paymongoMinimum = 100.00;\n      return Math.max(0, paymongoMinimum - baseTotal);\n    },\n    totalFee() {\n      return this.totalTax + this.processingFee + this.convenienceFee;\n    }\n  },\n  async mounted() {\n    console.log('üéØ CedulaRequest component mounted');\n\n    // Migrate legacy auth if needed\n    clientAuthService.migrateLegacyAuth();\n\n    // Check authentication status (unified auth system)\n    const token = localStorage.getItem('auth_token') || localStorage.getItem('clientToken');\n    const clientData = localStorage.getItem('auth_user') || localStorage.getItem('clientData');\n    console.log('üîë Auth token exists:', !!token);\n    console.log('üë§ Client data exists:', !!clientData);\n\n    if (clientData) {\n      try {\n        const parsedData = JSON.parse(clientData);\n        console.log('üë§ Client data:', parsedData);\n      } catch (e) {\n        console.error('‚ùå Error parsing client data:', e);\n      }\n    }\n\n    await this.loadFormData();\n  },\n  methods: {\n    async loadFormData() {\n      try {\n        // Load fresh profile data first\n        console.log('Loading fresh profile data...');\n        const profileResponse = await clientAuthService.getProfile();\n        if (profileResponse.success) {\n          this.clientData = profileResponse.data;\n          console.log('Fresh profile data loaded:', this.clientData);\n        } else {\n          // Fallback to cached data\n          this.clientData = this.cachedClientData;\n          console.log('Using cached profile data:', this.clientData);\n        }\n\n        const [purposeResponse, paymentResponse] = await Promise.all([\n          documentRequestService.getPurposeCategories(),\n          documentRequestService.getPaymentMethods(),\n          this.loadCivilStatuses(),\n          this.loadAddressData()\n        ]);\n\n        this.purposeCategories = purposeResponse.data || [];\n        this.originalPaymentMethods = paymentResponse.data || [];\n        this.paymentMethods = paymentService.groupPaymentMethods(this.originalPaymentMethods);\n\n      } catch (error) {\n        console.error('Error loading form data:', error);\n        // Fallback to cached data on error\n        this.clientData = this.cachedClientData;\n        this.showToast('Error', 'Failed to load some form data', 'error');\n      }\n    },\n\n    onPurposeChange() {\n      // Clear purpose details if not \"Other\" category (id=10)\n      if (!this.shouldShowPurposeDetails) {\n        this.formData.purpose_details = '';\n      }\n    },\n\n    sanitizeRequestData(data) {\n      // Convert undefined values to null to prevent MySQL binding errors\n      const sanitized = {};\n      for (const [key, value] of Object.entries(data)) {\n        if (value === undefined) {\n          sanitized[key] = null;\n        } else if (value === '') {\n          sanitized[key] = null;\n        } else if (typeof value === 'object' && value !== null) {\n          // Recursively sanitize nested objects\n          sanitized[key] = this.sanitizeRequestData(value);\n        } else {\n          sanitized[key] = value;\n        }\n      }\n      return sanitized;\n    },\n\n    getFullName() {\n      // Try fresh data first, then fallback to cached data structure\n      const profile = this.clientData || this.clientData?.profile;\n      if (!profile) return 'N/A';\n      return `${profile.first_name || ''} ${profile.middle_name || ''} ${profile.last_name || ''}`.trim();\n    },\n\n    getFullAddress() {\n      // Try fresh data first, then fallback to cached data structure\n      const profile = this.clientData || this.clientData?.profile;\n      if (!profile) return 'Not provided';\n\n      const parts = [\n        profile.house_number,\n        profile.street,\n        profile.subdivision,\n        profile.barangay,\n        profile.city_municipality || profile.city,\n        profile.province\n      ].filter(Boolean);\n\n      return parts.length > 0 ? parts.join(', ') : 'Not provided';\n    },\n\n    formatGender(gender) {\n      if (!gender) return 'Not provided';\n      return gender.charAt(0).toUpperCase() + gender.slice(1);\n    },\n\n    getCivilStatusName(statusId) {\n      const statuses = {\n        1: 'Single',\n        2: 'Married',\n        3: 'Divorced',\n        4: 'Widowed',\n        5: 'Separated'\n      };\n      return statuses[statusId] || 'Not provided';\n    },\n\n    getResidencyDisplay() {\n      // Try fresh data first, then fallback to cached data structure\n      const profile = this.clientData || this.clientData?.profile;\n      if (!profile) return 'Not provided';\n\n      const years = profile.years_of_residency;\n      const months = profile.months_of_residency;\n\n      if (!years && !months) return 'Not provided';\n\n      const parts = [];\n      if (years) parts.push(`${years} year${years > 1 ? 's' : ''}`);\n      if (months) parts.push(`${months} month${months > 1 ? 's' : ''}`);\n\n      return parts.join(' and ');\n    },\n\n    formatDate(dateString) {\n      if (!dateString) return 'Not provided';\n      return new Date(dateString).toLocaleDateString();\n    },\n\n    formatCurrency(amount) {\n      return parseFloat(amount || 0).toFixed(2);\n    },\n\n    // REMOVED: Incorrect percentage-based rate methods\n    // Philippine Community Tax Law uses ‚Ç±1 per ‚Ç±1,000 formula for all categories\n    // These methods were causing the calculation bug\n\n    calculateTax() {\n      // Tax calculation is handled by computed properties\n      this.$forceUpdate();\n    },\n\n    canProceedToNextStep() {\n      const result = (() => {\n        switch (this.currentStep) {\n          case 1: {\n            let basicValidation = this.formData.purpose_category_id;\n\n            // Only require purpose details if the field is shown (Other category, id=10)\n            if (this.shouldShowPurposeDetails) {\n              basicValidation = basicValidation &&\n                               this.formData.purpose_details &&\n                               this.formData.purpose_details.length >= 10;\n            }\n\n            if (!basicValidation) return false;\n\n            // Additional validation for third-party requests\n            if (this.formData.is_third_party_request) {\n              return this.validateBeneficiaryData();\n            }\n\n            return true;\n          }\n          case 2:\n            return this.formData.annual_income >= 0 &&\n                   this.formData.income_source &&\n                   this.formData.has_real_property !== null &&\n                   this.formData.has_personal_property !== null &&\n                   this.formData.has_business !== null;\n          case 3: {\n            const paymentValid = this.formData.payment_method_id;\n            if (!paymentValid) return false;\n\n            // Additional validation for authorized pickup\n            if (this.pickupOption === 'authorized') {\n              return this.validateAuthorizedPickup();\n            }\n\n            return true;\n          }\n          default:\n            return true;\n        }\n      })();\n\n      console.log(`üîç canProceedToNextStep (step ${this.currentStep}):`, result);\n      if (this.currentStep === 1) {\n        console.log('  - purpose_category_id:', this.formData.purpose_category_id);\n        console.log('  - purpose_details:', this.formData.purpose_details);\n      } else if (this.currentStep === 2) {\n        console.log('  - annual_income:', this.formData.annual_income);\n        console.log('  - income_source:', this.formData.income_source);\n        console.log('  - has_real_property:', this.formData.has_real_property);\n        console.log('  - has_personal_property:', this.formData.has_personal_property);\n        console.log('  - has_business:', this.formData.has_business);\n      } else if (this.currentStep === 3) {\n        console.log('  - payment_method_id:', this.formData.payment_method_id);\n      }\n\n      return result;\n    },\n\n    nextStep() {\n      console.log('üîÑ nextStep called, current step:', this.currentStep);\n      const canProceed = this.canProceedToNextStep();\n      console.log('üîç Can proceed:', canProceed);\n\n      if (canProceed && this.currentStep < 4) {\n        this.currentStep++;\n        console.log('‚úÖ Moved to step:', this.currentStep);\n      } else {\n        console.log('‚ùå Cannot proceed to next step');\n      }\n    },\n\n    previousStep() {\n      if (this.currentStep > 1) {\n        this.currentStep--;\n      }\n    },\n\n    selectPaymentMethod(methodId) {\n      this.formData.payment_method_id = methodId;\n    },\n\n    getActualPaymentMethodId() {\n      return paymentService.getActualPaymentMethodId(\n        this.formData.payment_method_id,\n        this.originalPaymentMethods\n      );\n    },\n\n    getPaymentIcon(methodCode) {\n      const icons = {\n        'CASH': 'fas fa-money-bill',\n        'ONLINE_PAYMENT_GROUP': 'fas fa-credit-card',\n        'PAYMONGO_CARD': 'fas fa-credit-card',\n        'PAYMONGO_GCASH': 'fab fa-google-pay',\n        'PAYMONGO_GRABPAY': 'fas fa-mobile-alt',\n        'PAYMONGO_PAYMAYA': 'fas fa-wallet',\n        'PAYMONGO_BANK': 'fas fa-university'\n      };\n      return icons[methodCode] || 'fas fa-credit-card';\n    },\n\n    getPurposeCategoryName() {\n      const category = this.purposeCategories.find(c => c.id === this.formData.purpose_category_id);\n      return category?.category_name || '';\n    },\n\n    getPaymentMethodName() {\n      const method = this.paymentMethods.find(m => m.id === this.formData.payment_method_id);\n      return method?.method_name || '';\n    },\n\n    getPaymentMethodDisplayName(methodCode) {\n      return paymentService.getPaymentMethodDisplayName(methodCode);\n    },\n\n    // Handle phone number input to restrict to digits only\n    handlePhoneInput(event, section) {\n      const value = event.target.value;\n      // Remove any non-digit characters\n      const digitsOnly = value.replace(/\\D/g, '');\n      // Limit to 11 digits\n      const limitedValue = digitsOnly.substring(0, 11);\n\n      if (section === 'beneficiary') {\n        this.formData.beneficiary.phone_number = limitedValue;\n      } else if (section === 'authorized_pickup') {\n        this.formData.authorized_pickup.phone_number = limitedValue;\n      }\n    },\n\n    // New methods for third-party requests\n    handleRequestTypeChange() {\n      if (!this.formData.is_third_party_request) {\n        // Reset beneficiary data when switching back to self\n        this.resetBeneficiaryData();\n        this.familyRelationshipError = null;\n      }\n    },\n\n    handleGenderChange() {\n      // Clear suffix when male is not selected since suffix field will be hidden\n      if (this.formData.beneficiary.gender !== 'male') {\n        this.formData.beneficiary.suffix = '';\n      }\n    },\n\n    validateFamilyRelationship() {\n      this.familyRelationshipError = null;\n\n      if (!this.formData.is_third_party_request) {\n        return true;\n      }\n\n      const relationship = this.formData.beneficiary.relationship_to_requestor;\n      if (!relationship) {\n        return true; // Will be caught by required validation\n      }\n\n      // Define allowed immediate family relationships\n      const allowedRelationships = [\n        'spouse', 'husband', 'wife', 'child', 'son', 'daughter',\n        'parent', 'father', 'mother', 'sibling', 'brother', 'sister'\n      ];\n\n      if (!allowedRelationships.includes(relationship.toLowerCase())) {\n        this.familyRelationshipError = 'You can only request documents on behalf of immediate family members (spouse, children, parents, siblings).';\n        return false;\n      }\n\n      return true;\n    },\n\n    handlePickupOptionChange() {\n      if (this.pickupOption !== 'authorized') {\n        // Reset authorized pickup data\n        this.resetAuthorizedPickupData();\n      }\n    },\n\n    resetBeneficiaryData() {\n      this.formData.beneficiary = {\n        first_name: '',\n        middle_name: '',\n        last_name: '',\n        suffix: '',\n        birth_date: '',\n        gender: '',\n        civil_status_id: '',\n        nationality: 'Filipino',\n        phone_number: '',\n        email: '',\n        house_number: '',\n        street: '',\n        subdivision: '',\n        barangay: 'Bula',\n        city_municipality: 'General Santos City (Dadiangas)',\n        province: 'South Cotabato',\n        postal_code: '',\n        years_of_residency: null,\n        months_of_residency: null,\n        relationship_to_requestor: '',\n        region: 'Region XII (SOCCSKSARGEN)',\n        region_code: '12',\n        province_code: '1263',\n        city_code: '126303',\n        barangay_code: '126303005'\n      };\n    },\n\n    resetAuthorizedPickupData() {\n      this.formData.authorized_pickup = {\n        first_name: '',\n        middle_name: '',\n        last_name: '',\n        suffix: '',\n        phone_number: '',\n        email: '',\n        relationship_to_beneficiary: ''\n      };\n      // Also reset the uploaded files\n      this.uploadedFiles.pickup_id_image = null;\n      this.uploadedFiles.pickup_authorization = null;\n    },\n\n    async loadCivilStatuses() {\n      try {\n        // For now, use a static list. In production, this would be an API call\n        this.civilStatuses = [\n          { id: 1, status_name: 'Single' },\n          { id: 2, status_name: 'Married' },\n          { id: 3, status_name: 'Widowed' },\n          { id: 4, status_name: 'Divorced' },\n          { id: 5, status_name: 'Separated' }\n        ];\n      } catch (error) {\n        console.error('Error loading civil statuses:', error);\n      }\n    },\n\n    validateBeneficiaryData() {\n      if (!this.formData.is_third_party_request) return true;\n\n      const required = [\n        'first_name', 'last_name', 'birth_date', 'gender',\n        'civil_status_id', 'region_code', 'province_code',\n        'city_code', 'barangay_code', 'relationship_to_requestor'\n      ];\n\n      for (const field of required) {\n        if (!this.formData.beneficiary[field]) {\n          this.showToast('Error', `Please fill in the beneficiary's ${field.replace('_', ' ')}`, 'error');\n          return false;\n        }\n      }\n\n      // Validate family relationship\n      if (!this.validateFamilyRelationship()) {\n        this.showToast('Error', this.familyRelationshipError, 'error');\n        return false;\n      }\n\n      // Check for required verification image\n      if (!this.uploadedFiles.beneficiary_verification) {\n        this.showToast('Error', 'Please upload the family member\\'s verification ID image', 'error');\n        return false;\n      }\n\n      return true;\n    },\n\n    validateAuthorizedPickup(showErrors = false) {\n      console.log('üîç validateAuthorizedPickup called with showErrors:', showErrors);\n      console.log('üîç pickupOption:', this.pickupOption);\n      console.log('üîç authorized_pickup data:', this.formData.authorized_pickup);\n\n      if (this.pickupOption !== 'authorized') {\n        console.log('‚úÖ Not authorized pickup, validation passed');\n        return true;\n      }\n\n      // Prevent multiple validation calls in quick succession\n      if (this.isValidating) {\n        console.log('‚ö†Ô∏è Validation already in progress, skipping');\n        return false;\n      }\n\n      if (showErrors) {\n        this.isValidating = true;\n        setTimeout(() => { this.isValidating = false; }, 1000); // Reset after 1 second\n      }\n\n      const required = [\n        'first_name', 'last_name', 'phone_number', 'relationship_to_beneficiary'\n      ];\n\n      for (const field of required) {\n        const value = this.formData.authorized_pickup[field];\n        console.log(`üîç Checking field ${field}:`, value);\n\n        if (!value || value.trim() === '') {\n          if (showErrors) {\n            console.log(`‚ùå Field ${field} is missing`);\n            this.showToast('Error', `Please fill in the pickup person's ${field.replace('_', ' ')}`, 'error');\n          }\n          return false;\n        }\n      }\n\n      // Check for required file uploads\n      if (!this.uploadedFiles.pickup_id_image) {\n        if (showErrors) {\n          console.log('‚ùå Missing pickup ID image');\n          this.showToast('Error', 'Please upload the pickup person\\'s valid ID image', 'error');\n        }\n        return false;\n      }\n\n      if (!this.uploadedFiles.pickup_authorization) {\n        if (showErrors) {\n          console.log('‚ùå Missing pickup authorization');\n          this.showToast('Error', 'Please upload the authorization letter', 'error');\n        }\n        return false;\n      }\n\n      console.log('‚úÖ Authorized pickup validation passed');\n      return true;\n    },\n\n    handleSubmitClick(event) {\n      console.log('üî• Submit button clicked!', event);\n      console.log('üìã Form data:', this.formData);\n      console.log('‚úÖ Agree to terms:', this.formData.agree_to_terms);\n      console.log('üîÑ Current step:', this.currentStep);\n      console.log('üö´ Button disabled:', this.submitting || !this.formData.agree_to_terms);\n\n      // Don't prevent default here, let the form submission happen naturally\n    },\n\n    async handleSubmit() {\n      console.log('üöÄ handleSubmit called');\n      console.log('üìã Form data:', this.formData);\n      console.log('‚úÖ Agree to terms:', this.formData.agree_to_terms);\n\n      if (!this.formData.agree_to_terms) {\n        console.log('‚ùå Terms not agreed to');\n        this.showToast('Error', 'Please agree to the terms and conditions', 'error');\n        return;\n      }\n\n      // Debug pickup option and form data\n      console.log('üîç DEBUG: pickupOption =', this.pickupOption);\n      console.log('üîç DEBUG: authorized_pickup data =', JSON.stringify(this.formData.authorized_pickup, null, 2));\n      console.log('üîç DEBUG: uploadedFiles =', this.uploadedFiles);\n\n      // Final validation with error messages for authorized pickup\n      if (this.pickupOption === 'authorized') {\n        console.log('üîç Running final validation for authorized pickup...');\n        if (!this.validateAuthorizedPickup(true)) {\n          console.log('‚ùå Validation failed, stopping submission');\n          this.submitting = false;\n          return;\n        }\n        console.log('‚úÖ Validation passed, continuing with submission');\n      }\n\n      try {\n        console.log('üîÑ Starting submission process...');\n        this.submitting = true;\n\n        // Check authentication (unified auth system)\n        const token = localStorage.getItem('auth_token') || localStorage.getItem('clientToken');\n        console.log('üîë Auth token exists:', !!token);\n\n        if (!token) {\n          this.showToast('Error', 'Please log in to submit a request', 'error');\n          this.submitting = false;\n          return;\n        }\n\n        // Ensure required fields are properly formatted and sanitize undefined values\n        const requestData = this.sanitizeRequestData({\n          // Core document request fields\n          document_type_id: parseInt(this.formData.document_type_id),\n          purpose_category_id: parseInt(this.formData.purpose_category_id),\n          purpose_details: this.shouldShowPurposeDetails && this.formData.purpose_details && this.formData.purpose_details.length >= 10\n            ? this.formData.purpose_details\n            : null,\n          payment_method_id: this.getActualPaymentMethodId(),\n          delivery_method: 'pickup',\n          priority: 'normal',\n\n          // Third-party request data\n          is_third_party_request: this.formData.is_third_party_request || false,\n          requestor_notes: null,\n          beneficiary: this.formData.is_third_party_request ? this.formData.beneficiary : null,\n          authorized_pickup: this.pickupOption === 'authorized' ? this.formData.authorized_pickup : null,\n\n          // Cedula-specific fields - ensure numeric fields are numbers\n          annual_income: parseFloat(this.formData.annual_income) || 0,\n          monthly_income: parseFloat(this.formData.monthly_income) || 0,\n          property_assessed_value: parseFloat(this.formData.property_value) || 0,\n          business_income: parseFloat(this.formData.business_gross_receipts) || 0,\n          business_gross_receipts: parseFloat(this.formData.business_gross_receipts) || 0,\n\n          // Optional text fields\n          occupation: this.formData.occupation || null,\n          employer_name: this.formData.employer_name || null,\n          employer_address: this.formData.employer_address || null,\n          business_name: this.formData.business_name || null,\n          business_address: this.formData.business_address || null,\n          business_type: this.formData.business_type || null,\n          property_location: this.formData.property_location || null,\n          tin_number: this.formData.tin_number || null,\n          previous_ctc_number: this.formData.previous_ctc_number || null,\n          previous_ctc_date_issued: this.formData.previous_ctc_date_issued || null,\n          previous_ctc_place_issued: this.formData.previous_ctc_place_issued || null,\n\n          // Boolean fields\n          has_real_property: Boolean(this.formData.has_real_property),\n          has_personal_property: Boolean(this.formData.has_personal_property),\n\n          // Numeric fields with defaults\n          personal_property_value: parseFloat(this.formData.personal_property_value) || 0,\n\n          // Computed values\n          computed_tax: this.totalTax || 0,\n          total_fee: this.totalFee || 0,\n          // CRITICAL: Send exact total_document_fee for PayMongo accuracy\n          total_document_fee: this.totalFee || 0\n        });\n\n        console.log('üì§ Request data to submit:', requestData);\n\n        // Validate required fields\n        if (!requestData.purpose_category_id) {\n          this.showToast('Error', 'Please select a purpose category', 'error');\n          this.submitting = false;\n          return;\n        }\n\n        // Only validate purpose details if the field is shown (Other category, id=10)\n        if (this.shouldShowPurposeDetails && (!requestData.purpose_details || requestData.purpose_details.length < 10)) {\n          this.showToast('Error', 'Purpose details must be at least 10 characters long', 'error');\n          this.submitting = false;\n          return;\n        }\n        if (!requestData.payment_method_id) {\n          this.showToast('Error', 'Please select a payment method', 'error');\n          this.submitting = false;\n          return;\n        }\n\n        console.log('üì° Making API call...');\n        const response = await documentRequestService.submitRequest(requestData);\n        console.log('‚úÖ API response:', response);\n\n        // Upload beneficiary verification if this is a third-party request\n        if (this.formData.is_third_party_request && this.uploadedFiles.beneficiary_verification && response.data.id) {\n          console.log('üì§ Uploading beneficiary verification...');\n          await this.uploadBeneficiaryVerification(response.data.id);\n        }\n\n        // Upload files if this is an authorized pickup request\n        if (this.pickupOption === 'authorized' && response.data.id) {\n          console.log('üì§ Uploading pickup authorization files...');\n          await this.uploadPickupFiles(response.data.id);\n        }\n\n        this.showToast('Success', 'Cedula request submitted successfully!', 'success');\n        this.$router.push({\n          name: 'RequestDetails',\n          params: { id: response.data.id }\n        });\n\n      } catch (error) {\n        console.error('‚ùå Error submitting request:', error);\n        console.error('‚ùå Error response:', error.response);\n        console.error('‚ùå Error data:', error.response?.data);\n\n        let errorMessage = 'Failed to submit request';\n        if (error.response?.data?.message) {\n          errorMessage = error.response.data.message;\n        } else if (error.response?.data?.error) {\n          errorMessage = error.response.data.error;\n        } else if (error.message) {\n          errorMessage = error.message;\n        }\n\n        this.showToast('Error', errorMessage, 'error');\n      } finally {\n        console.log('üèÅ Submission process completed');\n        this.submitting = false;\n      }\n    },\n\n    async uploadBeneficiaryVerification(requestId) {\n      try {\n        console.log('üîç Starting beneficiary verification upload for request:', requestId);\n\n        // First, get the beneficiary ID from the request\n        const api = (await import('@/services/api.js')).default;\n        const requestResponse = await api.get(`/client/document-requests/${requestId}`);\n\n        if (!requestResponse.data.success || !requestResponse.data.data.beneficiary) {\n          throw new Error('Beneficiary information not found');\n        }\n\n        const beneficiaryId = requestResponse.data.data.beneficiary.id;\n        console.log('üìã Found beneficiary ID:', beneficiaryId);\n\n        // Upload the verification image\n        const formData = new FormData();\n        formData.append('verification_image', this.uploadedFiles.beneficiary_verification);\n\n        const uploadResponse = await api.post(\n          `/verification-documents/beneficiary/${beneficiaryId}/verification-image`,\n          formData,\n          {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          }\n        );\n\n        if (uploadResponse.data.success) {\n          console.log('‚úÖ Beneficiary verification uploaded successfully');\n          this.showToast('Success', 'Family member verification uploaded successfully', 'success');\n        } else {\n          throw new Error(uploadResponse.data.message || 'Upload failed');\n        }\n\n      } catch (error) {\n        console.error('‚ùå Error uploading beneficiary verification:', error);\n        console.error('‚ùå Error response:', error.response?.data);\n        // Don't throw the error - the request was already created successfully\n        this.showToast('Warning', 'Request created but verification image failed to upload. You can upload it later.', 'warning');\n      }\n    },\n\n    async uploadPickupFiles(requestId) {\n      try {\n        console.log('üîç Starting file upload for request:', requestId);\n\n        // Import the API service\n        const api = (await import('@/services/api.js')).default;\n\n        // First, get the authorized pickup person ID from the backend\n        const pickupResponse = await api.get(`/client/document-requests/${requestId}/authorization-status`);\n        const pickupPersonId = pickupResponse.data.data?.pickup_person?.id;\n\n        if (!pickupPersonId) {\n          console.error('‚ùå No pickup person ID found');\n          console.error('‚ùå Response data:', pickupResponse.data);\n          return;\n        }\n\n        console.log('‚úÖ Found pickup person ID:', pickupPersonId);\n\n        // Upload ID image if available\n        if (this.uploadedFiles.pickup_id_image) {\n          console.log('üì§ Uploading pickup ID image...');\n          const idFormData = new FormData();\n          idFormData.append('id_image', this.uploadedFiles.pickup_id_image);\n\n          const idResponse = await api.post(`/verification-documents/pickup-person/${pickupPersonId}/id-image`, idFormData, {\n            headers: { 'Content-Type': 'multipart/form-data' }\n          });\n          console.log('‚úÖ ID image uploaded successfully:', idResponse.data);\n        }\n\n        // Upload authorization document if available\n        if (this.uploadedFiles.pickup_authorization) {\n          console.log('üì§ Uploading authorization document...');\n          const authFormData = new FormData();\n          authFormData.append('authorization_document', this.uploadedFiles.pickup_authorization);\n\n          const authResponse = await api.post(`/verification-documents/pickup-person/${pickupPersonId}/authorization-document`, authFormData, {\n            headers: { 'Content-Type': 'multipart/form-data' }\n          });\n          console.log('‚úÖ Authorization document uploaded successfully:', authResponse.data);\n        }\n\n        console.log('üéâ All pickup files uploaded successfully');\n      } catch (error) {\n        console.error('‚ùå Error uploading pickup files:', error);\n        console.error('‚ùå Error response:', error.response?.data);\n        // Don't throw the error - the request was already created successfully\n        this.showToast('Warning', 'Request created but some files failed to upload. You can upload them later.', 'warning');\n      }\n    },\n\n    goBack() {\n      this.$router.push({ name: 'NewDocumentRequest' });\n    },\n\n    updateProfile() {\n      // TODO: Navigate to profile update page\n      console.log('Update profile');\n    },\n\n    showTerms() {\n      // TODO: Show terms and conditions modal\n      console.log('Show terms');\n    },\n\n    showToast(title, message, type = 'info') {\n      // Log to console for debugging\n      console.log(`[${type.toUpperCase()}] ${title}: ${message}`);\n\n      // Create a simple toast notification\n      const toast = document.createElement('div');\n      toast.className = `toast-notification toast-${type}`;\n      toast.innerHTML = `\n        <div class=\"toast-header\">\n          <strong>${title}</strong>\n          <button type=\"button\" class=\"toast-close\" onclick=\"this.parentElement.parentElement.remove()\">√ó</button>\n        </div>\n        <div class=\"toast-body\">${message}</div>\n      `;\n\n      // Add toast styles if not already added\n      if (!document.getElementById('toast-styles')) {\n        const styles = document.createElement('style');\n        styles.id = 'toast-styles';\n        styles.textContent = `\n          .toast-notification {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            min-width: 300px;\n            background: white;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            z-index: 9999;\n            animation: slideIn 0.3s ease;\n          }\n          .toast-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px 8px;\n            border-bottom: 1px solid #e9ecef;\n          }\n          .toast-body {\n            padding: 8px 16px 12px;\n            color: #6c757d;\n          }\n          .toast-close {\n            background: none;\n            border: none;\n            font-size: 18px;\n            cursor: pointer;\n            color: #6c757d;\n          }\n          .toast-success { border-left: 4px solid #28a745; }\n          .toast-error { border-left: 4px solid #dc3545; }\n          .toast-info { border-left: 4px solid #17a2b8; }\n          .toast-warning { border-left: 4px solid #ffc107; }\n          @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n          }\n        `;\n        document.head.appendChild(styles);\n      }\n\n      // Add toast to page\n      document.body.appendChild(toast);\n\n      // Auto-remove after 5 seconds\n      setTimeout(() => {\n        if (toast.parentElement) {\n          toast.style.animation = 'slideIn 0.3s ease reverse';\n          setTimeout(() => toast.remove(), 300);\n        }\n      }, 5000);\n    },\n\n    // Verification file upload handlers\n    handleBeneficiaryVerificationFile(file) {\n      console.log('Beneficiary verification file selected:', file.name);\n      this.uploadedFiles.beneficiary_verification = file;\n    },\n\n    onBeneficiaryVerificationUpload(uploadResult) {\n      console.log('Beneficiary verification uploaded successfully:', uploadResult);\n      this.showToast('Success', 'Family member verification image uploaded successfully', 'success');\n    },\n\n    onBeneficiaryVerificationError(error) {\n      console.error('Beneficiary verification upload error:', error);\n      this.showToast('Error', 'Failed to upload verification image: ' + (error.response?.data?.message || error.message), 'error');\n    },\n\n    onBeneficiaryVerificationRemoved() {\n      console.log('Beneficiary verification file removed');\n      this.uploadedFiles.beneficiary_verification = null;\n    },\n\n    // Pickup person file upload handlers\n    handlePickupIdFile(file) {\n      console.log('Pickup ID file selected:', file.name);\n      this.uploadedFiles.pickup_id_image = file;\n    },\n\n    onPickupIdUpload(uploadResult) {\n      console.log('Pickup ID uploaded successfully:', uploadResult);\n      this.showToast('Success', 'Pickup person ID image uploaded successfully', 'success');\n    },\n\n    onPickupIdError(error) {\n      console.error('Pickup ID upload error:', error);\n      this.showToast('Error', 'Failed to upload ID image: ' + (error.response?.data?.message || error.message), 'error');\n    },\n\n    onPickupIdRemoved() {\n      console.log('Pickup ID file removed');\n      this.uploadedFiles.pickup_id_image = null;\n    },\n\n    handlePickupAuthFile(file) {\n      console.log('Pickup authorization file selected:', file.name);\n      this.uploadedFiles.pickup_authorization = file;\n    },\n\n    onPickupAuthUpload(uploadResult) {\n      console.log('Pickup authorization uploaded successfully:', uploadResult);\n      this.showToast('Success', 'Authorization document uploaded successfully', 'success');\n    },\n\n    onPickupAuthError(error) {\n      console.error('Pickup authorization upload error:', error);\n      this.showToast('Error', 'Failed to upload authorization document: ' + (error.response?.data?.message || error.message), 'error');\n    },\n\n    onPickupAuthRemoved() {\n      console.log('Pickup authorization file removed');\n      this.uploadedFiles.pickup_authorization = null;\n    },\n\n    // Address dropdown methods\n    async loadAddressData() {\n      try {\n        this.regions = await addressService.getRegions();\n      } catch (error) {\n        console.error('Error loading address data:', error);\n        this.$toast?.error('Failed to load address data');\n      }\n    },\n\n    async onRegionChange() {\n      try {\n        this.filteredProvinces = [];\n        this.filteredCities = [];\n        this.filteredBarangays = [];\n\n        // Reset dependent fields\n        this.formData.beneficiary.province_code = '';\n        this.formData.beneficiary.city_code = '';\n        this.formData.beneficiary.barangay_code = '';\n        this.formData.beneficiary.province = '';\n        this.formData.beneficiary.city_municipality = '';\n        this.formData.beneficiary.barangay = '';\n        this.formData.beneficiary.region = '';\n\n        if (this.formData.beneficiary.region_code) {\n          this.filteredProvinces = await addressService.getProvincesByRegion(this.formData.beneficiary.region_code);\n\n          // Set region name\n          const selectedRegion = this.regions.find(r => r.region_code === this.formData.beneficiary.region_code);\n          if (selectedRegion) {\n            this.formData.beneficiary.region = selectedRegion.region_name;\n          }\n        }\n      } catch (error) {\n        console.error('Error loading provinces:', error);\n        this.$toast?.error('Failed to load provinces');\n      }\n    },\n\n    async onProvinceChange() {\n      try {\n        this.filteredCities = [];\n        this.filteredBarangays = [];\n\n        // Reset dependent fields\n        this.formData.beneficiary.city_code = '';\n        this.formData.beneficiary.barangay_code = '';\n        this.formData.beneficiary.city_municipality = '';\n        this.formData.beneficiary.barangay = '';\n\n        if (this.formData.beneficiary.province_code) {\n          this.filteredCities = await addressService.getCitiesByProvince(this.formData.beneficiary.province_code);\n\n          // Set province name\n          const selectedProvince = this.filteredProvinces.find(p => p.province_code === this.formData.beneficiary.province_code);\n          if (selectedProvince) {\n            this.formData.beneficiary.province = selectedProvince.province_name;\n          }\n        }\n      } catch (error) {\n        console.error('Error loading cities:', error);\n        this.$toast?.error('Failed to load cities');\n      }\n    },\n\n    async onCityChange() {\n      try {\n        this.filteredBarangays = [];\n\n        // Reset dependent fields\n        this.formData.beneficiary.barangay_code = '';\n        this.formData.beneficiary.barangay = '';\n\n        if (this.formData.beneficiary.city_code) {\n          this.filteredBarangays = await addressService.getBarangaysByCity(this.formData.beneficiary.city_code);\n\n          // Set city name\n          const selectedCity = this.filteredCities.find(c => c.city_code === this.formData.beneficiary.city_code);\n          if (selectedCity) {\n            this.formData.beneficiary.city_municipality = selectedCity.city_name;\n          }\n        }\n      } catch (error) {\n        console.error('Error loading barangays:', error);\n        this.$toast?.error('Failed to load barangays');\n      }\n    },\n\n    onBarangayChange() {\n      // Set barangay name\n      if (this.formData.beneficiary.barangay_code) {\n        const selectedBarangay = this.filteredBarangays.find(b => b.brgy_code === this.formData.beneficiary.barangay_code);\n        if (selectedBarangay) {\n          this.formData.beneficiary.barangay = selectedBarangay.brgy_name;\n        }\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* Import shared styles from BarangayClearanceRequest */\n.cedula-request {\n  padding: 0;\n  max-width: none;\n  margin: 0;\n  min-height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.page-header {\n  position: sticky;\n  top: 0;\n  z-index: 1000;\n  background: #f7fafc;\n  margin: 0;\n  padding: 2rem 2rem 1.5rem 2rem;\n  border-bottom: 1px solid #e2e8f0;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  flex-shrink: 0;\n}\n\n.page-content {\n  flex: 1;\n  padding: 1.5rem 2rem 2rem 2rem;\n}\n\n.header-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  gap: 2rem;\n}\n\n.page-title {\n  font-size: 1.75rem;\n  font-weight: 700;\n  color: #1a365d;\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.page-title i {\n  color: #3182ce;\n}\n\n.page-description {\n  font-size: 1rem;\n  color: #4a5568;\n  margin: 0;\n}\n\n.back-btn {\n  background: #e2e8f0;\n  border: none;\n  padding: 0.75rem 1.5rem;\n  border-radius: 0.5rem;\n  color: #4a5568;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.back-btn:hover {\n  background: #cbd5e0;\n  color: #2d3748;\n}\n\n.progress-steps {\n  display: flex;\n  justify-content: center;\n  margin-bottom: 3rem;\n  position: relative;\n}\n\n.progress-steps::before {\n  content: '';\n  position: absolute;\n  top: 1.5rem;\n  left: 25%;\n  right: 25%;\n  height: 2px;\n  background: #e2e8f0;\n  z-index: 1;\n}\n\n.step {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  flex: 1;\n  position: relative;\n  z-index: 2;\n}\n\n.step-number {\n  width: 3rem;\n  height: 3rem;\n  border-radius: 50%;\n  background: #e2e8f0;\n  color: #a0aec0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n  transition: all 0.3s;\n}\n\n.step.active .step-number {\n  background: #3182ce;\n  color: white;\n}\n\n.step.completed .step-number {\n  background: #38a169;\n  color: white;\n}\n\n.step-label {\n  font-size: 0.875rem;\n  color: #718096;\n  text-align: center;\n}\n\n.step.active .step-label {\n  color: #3182ce;\n  font-weight: 500;\n}\n\n.form-container {\n  background: white;\n  border-radius: 1rem;\n  padding: 2rem;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);\n}\n\n.form-step {\n  min-height: 400px;\n}\n\n.step-header {\n  text-align: center;\n  margin-bottom: 2rem;\n}\n\n.step-header h2 {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: #1a365d;\n  margin-bottom: 0.5rem;\n}\n\n.step-header p {\n  color: #4a5568;\n  margin: 0;\n}\n\n.profile-preview {\n  margin-bottom: 2rem;\n}\n\n.profile-card {\n  background: #f7fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 0.75rem;\n  padding: 1.5rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n}\n\n.profile-info h3 {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: #1a365d;\n  margin-bottom: 1rem;\n}\n\n.info-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n}\n\n.info-item {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.info-item label {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #718096;\n}\n\n.info-item span {\n  color: #2d3748;\n}\n\n.update-profile-btn {\n  background: #3182ce;\n  color: white;\n  border: none;\n  padding: 0.75rem 1.5rem;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  transition: all 0.2s;\n}\n\n.update-profile-btn:hover {\n  background: #2c5aa0;\n}\n\n.form-section {\n  margin-bottom: 2rem;\n}\n\n.form-section h3 {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #1a365d;\n  margin-bottom: 1rem;\n}\n\n.form-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 1rem;\n}\n\n.form-group {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.form-group label {\n  font-weight: 500;\n  color: #2d3748;\n  font-size: 0.875rem;\n}\n\n.form-group input,\n.form-group select,\n.form-group textarea {\n  padding: 0.75rem;\n  border: 1px solid #e2e8f0;\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n\n.form-group input:focus,\n.form-group select:focus,\n.form-group textarea:focus {\n  outline: none;\n  border-color: #3182ce;\n  box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);\n}\n\n.radio-group {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.radio-option {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  cursor: pointer;\n  padding: 0.5rem;\n  border-radius: 0.5rem;\n  transition: all 0.2s;\n}\n\n.radio-option:hover {\n  background: #f7fafc;\n}\n\n.radio-option input[type=\"radio\"] {\n  display: none;\n}\n\n.radio-custom {\n  width: 1.25rem;\n  height: 1.25rem;\n  border: 2px solid #e2e8f0;\n  border-radius: 50%;\n  position: relative;\n  transition: all 0.2s;\n}\n\n.radio-option input[type=\"radio\"]:checked + .radio-custom {\n  border-color: #3182ce;\n}\n\n.radio-option input[type=\"radio\"]:checked + .radio-custom::after {\n  content: '';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 0.5rem;\n  height: 0.5rem;\n  background: #3182ce;\n  border-radius: 50%;\n}\n\n/* Tax Computation Specific Styles */\n.tax-computation {\n  margin-top: 2rem;\n}\n\n.tax-card {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border-radius: 1rem;\n  padding: 2rem;\n  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);\n}\n\n.tax-card h3 {\n  font-size: 1.25rem;\n  font-weight: 600;\n  margin-bottom: 1.5rem;\n  text-align: center;\n}\n\n.tax-breakdown {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.tax-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 0;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n}\n\n.tax-item:last-child {\n  border-bottom: none;\n}\n\n.tax-item.total {\n  border-top: 2px solid rgba(255, 255, 255, 0.3);\n  padding-top: 1rem;\n  font-weight: 600;\n  font-size: 1.125rem;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 0.5rem;\n  padding: 1rem;\n  margin-top: 0.5rem;\n}\n\n.tax-note {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  background: rgba(255, 255, 255, 0.1);\n  padding: 1rem;\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n}\n\n.tax-note i {\n  color: #ffd700;\n  margin-top: 0.125rem;\n  flex-shrink: 0;\n}\n\n.tax-note p {\n  margin: 0;\n  line-height: 1.4;\n}\n\n.fee-summary {\n  margin-bottom: 2rem;\n}\n\n.fee-card {\n  background: #f7fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 0.75rem;\n  padding: 1.5rem;\n}\n\n.fee-card h3 {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #1a365d;\n  margin-bottom: 1rem;\n}\n\n.fee-items {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.fee-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0;\n}\n\n.fee-item.total {\n  border-top: 1px solid #e2e8f0;\n  padding-top: 1rem;\n  font-weight: 600;\n  font-size: 1.125rem;\n  color: #1a365d;\n}\n\n.payment-methods {\n  display: grid;\n  gap: 1rem;\n}\n\n.payment-option {\n  border: 2px solid #e2e8f0;\n  border-radius: 0.75rem;\n  padding: 1rem;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.payment-option:hover {\n  border-color: #cbd5e0;\n}\n\n.payment-option.selected {\n  border-color: #3182ce;\n  background: #ebf8ff;\n}\n\n.grouped-methods-preview {\n  margin-top: 0.5rem;\n}\n\n.grouped-methods-preview small {\n  color: #6b7280;\n  font-size: 0.875rem;\n  line-height: 1.25rem;\n}\n\n.payment-icon {\n  width: 3rem;\n  height: 3rem;\n  background: #f7fafc;\n  border-radius: 0.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.25rem;\n  color: #4a5568;\n}\n\n.payment-option.selected .payment-icon {\n  background: #3182ce;\n  color: white;\n}\n\n.payment-info {\n  flex: 1;\n}\n\n.payment-info h4 {\n  font-weight: 600;\n  color: #1a365d;\n  margin-bottom: 0.25rem;\n}\n\n.payment-info p {\n  color: #718096;\n  font-size: 0.875rem;\n  margin: 0;\n}\n\n.payment-radio input {\n  width: 1.25rem;\n  height: 1.25rem;\n}\n\n.review-sections {\n  display: flex;\n  flex-direction: column;\n  gap: 2rem;\n  margin-bottom: 2rem;\n}\n\n.review-section {\n  background: #f7fafc;\n  border-radius: 0.75rem;\n  padding: 1.5rem;\n}\n\n.review-section h3 {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #1a365d;\n  margin-bottom: 1rem;\n}\n\n.review-grid {\n  display: grid;\n  gap: 1rem;\n}\n\n.review-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid #e2e8f0;\n}\n\n.review-item:last-child {\n  border-bottom: none;\n}\n\n.review-item label {\n  font-weight: 500;\n  color: #4a5568;\n  min-width: 120px;\n}\n\n.review-item span {\n  color: #2d3748;\n  text-align: right;\n  flex: 1;\n}\n\n.review-item .amount {\n  font-weight: 600;\n  color: #38a169;\n  font-size: 1.125rem;\n}\n\n.terms-section {\n  margin-bottom: 2rem;\n  padding: 1rem;\n  background: #fffaf0;\n  border: 1px solid #fed7aa;\n  border-radius: 0.5rem;\n}\n\n.checkbox-option {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  cursor: pointer;\n  line-height: 1.5;\n}\n\n.checkbox-option input[type=\"checkbox\"] {\n  display: none;\n}\n\n.checkbox-custom {\n  width: 1.25rem;\n  height: 1.25rem;\n  border: 2px solid #e2e8f0;\n  border-radius: 0.25rem;\n  position: relative;\n  flex-shrink: 0;\n  margin-top: 0.125rem;\n  transition: all 0.2s;\n}\n\n.checkbox-option input[type=\"checkbox\"]:checked + .checkbox-custom {\n  border-color: #3182ce;\n  background: #3182ce;\n}\n\n.checkbox-option input[type=\"checkbox\"]:checked + .checkbox-custom::after {\n  content: '‚úì';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  color: white;\n  font-size: 0.875rem;\n  font-weight: bold;\n}\n\n.checkbox-option a {\n  color: #3182ce;\n  text-decoration: underline;\n}\n\n.form-actions {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 1rem;\n  padding-top: 2rem;\n  border-top: 1px solid #e2e8f0;\n}\n\n.btn-secondary,\n.btn-primary,\n.btn-submit {\n  padding: 0.75rem 2rem;\n  border-radius: 0.5rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  border: none;\n}\n\n.btn-secondary {\n  background: #e2e8f0;\n  color: #4a5568;\n}\n\n.btn-secondary:hover {\n  background: #cbd5e0;\n}\n\n.btn-primary {\n  background: #3182ce;\n  color: white;\n}\n\n.btn-primary:hover:not(:disabled) {\n  background: #2c5aa0;\n}\n\n.btn-submit {\n  background: #38a169;\n  color: white;\n}\n\n.btn-submit:hover:not(:disabled) {\n  background: #2f855a;\n}\n\n.btn-primary:disabled,\n.btn-submit:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n/* Third-party request styles */\n.request-type-options {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 2rem;\n}\n\n.radio-option {\n  display: flex;\n  align-items: flex-start;\n  gap: 1rem;\n  padding: 1.5rem;\n  border: 2px solid #e2e8f0;\n  border-radius: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.radio-option:hover {\n  border-color: #cbd5e0;\n  background-color: #f7fafc;\n}\n\n.radio-option input[type=\"radio\"]:checked + .radio-custom + .option-content {\n  color: #3182ce;\n}\n\n.radio-option input[type=\"radio\"]:checked ~ .option-content strong {\n  color: #2c5aa0;\n}\n\n.radio-option input[type=\"radio\"] {\n  display: none;\n}\n\n.radio-custom {\n  width: 20px;\n  height: 20px;\n  border: 2px solid #cbd5e0;\n  border-radius: 50%;\n  position: relative;\n  flex-shrink: 0;\n  margin-top: 2px;\n}\n\n.radio-option input[type=\"radio\"]:checked + .radio-custom {\n  border-color: #3182ce;\n}\n\n.radio-option input[type=\"radio\"]:checked + .radio-custom::after {\n  content: '';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 10px;\n  height: 10px;\n  background-color: #3182ce;\n  border-radius: 50%;\n}\n\n.option-content {\n  flex: 1;\n}\n\n.option-content strong {\n  display: block;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: #2d3748;\n  margin-bottom: 0.25rem;\n}\n\n.option-content p {\n  color: #718096;\n  margin: 0;\n  font-size: 0.875rem;\n  line-height: 1.4;\n}\n\n.beneficiary-section {\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 0.75rem;\n  padding: 2rem;\n  margin-bottom: 2rem;\n}\n\n.beneficiary-section h3 {\n  color: #2d3748;\n  font-size: 1.25rem;\n  font-weight: 600;\n  margin-bottom: 1.5rem;\n}\n\n.beneficiary-section h4 {\n  color: #4a5568;\n  font-size: 1.125rem;\n  font-weight: 600;\n  margin: 2rem 0 1rem 0;\n  padding-top: 1.5rem;\n  border-top: 1px solid #e2e8f0;\n}\n\n.pickup-options {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.authorized-pickup-form {\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 0.75rem;\n  padding: 1.5rem;\n  margin-top: 1rem;\n}\n\n.authorized-pickup-form h4 {\n  color: #2d3748;\n  font-size: 1.125rem;\n  font-weight: 600;\n  margin-bottom: 1rem;\n}\n\n.alert {\n  padding: 1rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1.5rem;\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.alert-info {\n  background-color: #ebf8ff;\n  border: 1px solid #bee3f8;\n  color: #2c5aa0;\n}\n\n.alert-info i {\n  color: #3182ce;\n}\n\n@media (max-width: 768px) {\n  .page-header {\n    padding: 1.5rem 1rem 1.25rem 1rem;\n  }\n\n  .page-content {\n    padding: 1rem 1rem 1rem 1rem;\n  }\n\n  .header-content {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .progress-steps {\n    flex-wrap: wrap;\n    gap: 1rem;\n  }\n\n  .progress-steps::before {\n    display: none;\n  }\n\n  .form-container {\n    padding: 1.5rem;\n  }\n\n  .form-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .info-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .profile-card {\n    flex-direction: column;\n    gap: 1rem;\n  }\n\n  .form-actions {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .review-item {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.25rem;\n  }\n\n  .review-item span {\n    text-align: left;\n  }\n\n  .tax-card {\n    padding: 1.5rem;\n  }\n\n  .tax-breakdown {\n    gap: 0.75rem;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}